{"ast":null,"code":"var _jsxFileName = \"/media/maria/96ae9a87-ebe3-48cb-a2c1-fae5fe76b9e7/maria/Marketplace-JurassicPark/backend/web/src/components/DigitalTwin/DigitalTwinForm.tsx\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$(),\n    _s3 = $RefreshSig$();\n\nimport React, { useState, useCallback } from 'react';\nimport { TextField, Grid, Button, InputLabel, Select, MenuItem, FormControl } from '@material-ui/core';\nimport { useFunctionBlockStyles } from '../FunctionBlocks/FunctionBlock/style';\nimport { Done, Clear } from '@material-ui/icons';\nimport { ConfirmActionStateLabel, ConfirmAction } from '../templates/ConfirmAction/ConfirmAction';\nimport { SmartComponentActions } from '../../redux/actions';\nimport { useStore } from '../templates/Store/Store';\nimport { getOrDownloadSmartComponents } from '../../utils/smartComponents';\nimport { useMountEffect } from '../../utils/main';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport const SmartComponentList = /*#__PURE__*/React.memo(_c = _s(props => {\n  _s();\n\n  const {\n    smartComponents,\n    setSmartComponents,\n    onSmartComponentRemoval,\n    onSmartComponentEdition\n  } = props;\n  const classes = useFunctionBlockStyles();\n  const newSc = {\n    scId: -1,\n    scName: \"\",\n    scAddress: \"\",\n    scPort: -1\n  };\n  const [newSmartComponent, setNewSmartComponent] = useState(newSc);\n  const setSmartComponent = useCallback((smartComponent, index) => {\n    setSmartComponents(prevScs => {\n      const oldSmartComponent = prevScs[index];\n      const newSmartComponents = [...prevScs];\n      newSmartComponents[index] = smartComponent;\n      onSmartComponentEdition(oldSmartComponent, smartComponent);\n      return newSmartComponents;\n    });\n  }, [onSmartComponentEdition, setSmartComponents]);\n  const addSmartComponent = useCallback(scToAdd => {\n    setSmartComponents(prevSmartComponents => [...prevSmartComponents, scToAdd]);\n    setNewSmartComponent(newSc);\n  }, [setSmartComponents, newSc]);\n  const removeSmartComponent = useCallback(smartComponentToRemove => {\n    setSmartComponents(prevSmartComponents => prevSmartComponents.filter((smartComponent, index) => smartComponent !== smartComponentToRemove));\n    onSmartComponentRemoval(smartComponentToRemove);\n  }, [onSmartComponentRemoval, setSmartComponents]);\n  return /*#__PURE__*/_jsxDEV(Grid, {\n    container: true,\n    direction: \"column\",\n    children: [/*#__PURE__*/_jsxDEV(Grid, {\n      item: true,\n      children: props.title\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 64,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Grid, {\n      item: true,\n      className: classes.box,\n      children: [smartComponents.map((variable, index) => /*#__PURE__*/_jsxDEV(VariableRow, {\n        index: index,\n        addRemoveSmartComponent: removeSmartComponent,\n        setSmartComponent: setSmartComponent,\n        smartComponent: smartComponent,\n        newSc: false\n      }, index, false, {\n        fileName: _jsxFileName,\n        lineNumber: 66,\n        columnNumber: 73\n      }, this)), /*#__PURE__*/_jsxDEV(VariableRow, {\n        index: -1,\n        addRemoveVariable: addVariable,\n        setVariable: setNewVariable,\n        variable: newVariable,\n        newVar: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 67,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 65,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 63,\n    columnNumber: 5\n  }, this);\n}, \"nEPT5xElcQIY0XQYnP2j9DCOoCw=\", false, function () {\n  return [useFunctionBlockStyles];\n}));\n_c2 = SmartComponentList;\nconst VariableRow = /*#__PURE__*/React.memo(_c3 = _s2(props => {\n  _s2();\n\n  const classes = useFunctionBlockStyles();\n  const [validName, setValidName] = useState(\"\");\n\n  const action = () => {\n    if (!isValid() && props.newVar) setValidName(\"Mandatory\");else props.addRemoveVariable(props.variable);\n  };\n\n  const isValid = useCallback(() => props.variable.variableName !== '', [props.variable]);\n  const validate = useCallback(() => {\n    !isValid() ? setValidName(\"Mandatory\") : setValidName('');\n  }, [isValid]);\n  useEffect(() => {\n    if (!props.newVar) validate();\n  }, [props.variable.variableName, props.newVar, validate]);\n\n  const updateField = field => event => {\n    setValidName('');\n    props.setVariable({ ...props.variable,\n      [field]: event.target.value\n    }, props.index);\n  };\n\n  return /*#__PURE__*/_jsxDEV(Grid, {\n    item: true,\n    container: true,\n    direction: \"row\",\n    justify: \"space-between\",\n    alignItems: \"center\",\n    children: [props.order ? /*#__PURE__*/_jsxDEV(Grid, {\n      item: true,\n      xs: 1,\n      children: props.order\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 118,\n      columnNumber: 7\n    }, this) : null, /*#__PURE__*/_jsxDEV(Grid, {\n      item: true,\n      xs: 4,\n      children: /*#__PURE__*/_jsxDEV(TextField, {\n        value: props.variable.variableName,\n        onChange: updateField('variableName'),\n        helperText: validName,\n        fullWidth: true,\n        required: true,\n        error: validName !== '',\n        label: \"Name\",\n        type: \"text\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 124,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 123,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Grid, {\n      item: true,\n      xs: 2,\n      children: /*#__PURE__*/_jsxDEV(TextField, {\n        value: props.variable.variableOpcua || '',\n        onChange: updateField('variableOpcua'),\n        helperText: \"\",\n        fullWidth: true,\n        label: \"OPCUA\",\n        type: \"text\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 134,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 133,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Grid, {\n      item: true,\n      xs: 3,\n      children: /*#__PURE__*/_jsxDEV(FormControl, {\n        fullWidth: true,\n        required: true,\n        children: [/*#__PURE__*/_jsxDEV(InputLabel, {\n          id: `data-type-label-${props.variable.variableName}`,\n          children: \"Data Type\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 144,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Select, {\n          labelId: `data-type-label-${props.variable.variableName}`,\n          value: props.variable.variableDataType,\n          onChange: updateField('variableDataType'),\n          children: Object.values(DataType).map((dt, index) => /*#__PURE__*/_jsxDEV(MenuItem, {\n            value: dt,\n            children: dt\n          }, index, false, {\n            fileName: _jsxFileName,\n            lineNumber: 150,\n            columnNumber: 68\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 145,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 143,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 142,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Grid, {\n      item: true,\n      xs: 1,\n      children: /*#__PURE__*/_jsxDEV(Button, {\n        className: classes.varEvButton,\n        size: \"small\",\n        variant: \"contained\",\n        onClick: action,\n        children: props.newVar ? '+' : 'x'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 156,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 155,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 116,\n    columnNumber: 5\n  }, this);\n}, \"Ki16XzEneQsNhUTQv+ig9YkjeRk=\", false, function () {\n  return [useFunctionBlockStyles];\n}), (prevProps, nextProps) => prevProps.variable === nextProps.variable);\n_c4 = VariableRow;\nexport const DigitalTwinForm = props => {\n  _s3();\n\n  var _props$confirmDialog$, _props$confirmDialog$2, _props$confirmDialog$3;\n\n  /**styles */\n  const classes = useFunctionBlockStyles();\n  /**Digital Twin*/\n\n  const {\n    dtName,\n    setDtName\n  } = props.dtName;\n  const [validDtName, setValidDtName] = useState(true);\n  const onChangeDtName = useCallback(event => {\n    setDtName(event.target.value.trim());\n    setValidDtName(true);\n  }, [setDtName]);\n  /* Buttons */\n\n  const onCancel = props.cancel.action;\n  const cancelLabel = props.cancel.label;\n  const confirmLabel = props.confirmDialog.buttonTitle;\n  /* Confirmation */\n\n  const [confirm, setConfirm] = useState(false);\n\n  const validateFields = () => {\n    const cValidDtName = dtName.trim() !== '';\n    if (!cValidDtName) setValidDtName(cValidDtName);\n    return cValidDtName;\n  };\n\n  const confirmButtonAction = () => {\n    if (validateFields()) setConfirm(true);\n  };\n\n  const confirmActionStates = {\n    start: {\n      label: (_props$confirmDialog$ = props.confirmDialog.start) === null || _props$confirmDialog$ === void 0 ? void 0 : _props$confirmDialog$.label,\n      positiveLabel: (_props$confirmDialog$2 = props.confirmDialog.start) === null || _props$confirmDialog$2 === void 0 ? void 0 : _props$confirmDialog$2.positiveLabel,\n      negativeLabel: (_props$confirmDialog$3 = props.confirmDialog.start) === null || _props$confirmDialog$3 === void 0 ? void 0 : _props$confirmDialog$3.negativeLabel,\n      state: ConfirmActionStateLabel.start\n    },\n    executing: {\n      label: '',\n      state: ConfirmActionStateLabel.executing\n    },\n    success: {\n      label: props.confirmDialog.success.label,\n      state: ConfirmActionStateLabel.success,\n      positiveLabel: props.confirmDialog.success.positiveLabel\n    },\n    error: {\n      label: props.confirmDialog.error.label,\n      state: ConfirmActionStateLabel.error,\n      positiveLabel: props.confirmDialog.success.positiveLabel\n    }\n  };\n  const confirmActionProps = {\n    title: props.confirmDialog.title,\n    states: confirmActionStates,\n    currentState: confirmActionStates.executing,\n    onCancel: () => setConfirm(false),\n    onError: () => setConfirm(false),\n    onSuccess: props.confirmDialog.onSuccess,\n    action: props.confirmDialog.action\n  }; // Recuperar diretamente da comunicação OPC-UA os smart_components disponíveis (SmartComponent)\n\n  useMountEffect(() => {\n    setTimeout(() => {\n      setFetching(true);\n      getOrDownloadSmartComponents(smartComponents).then(result => updateSmartComponents(result)).catch(e => setError(e.msg)).finally(() => setFetching(false));\n    }, 0);\n  }); // Associar um SmartComponent pelo frontend\n\n  const [fetching, setFetching] = useState(true);\n  const {\n    data: smartComponents,\n    dispatchAction: dispatchSmartComponentActions\n  } = useStore('smartComponents');\n\n  const updateSmartComponents = scs => dispatchSmartComponentActions(SmartComponentActions.updateSmartComponent(scs));\n\n  const [error, setError] = useState('');\n  const [smartComponentChoice, setSmartComponentChoice] = useState('');\n  const [smartComponentIdChoice, setSmartComponentIdChoice] = useState(0);\n\n  const handleSmartComponentChoice = event => {\n    setSmartComponentChoice(event.target.value);\n    props.associatedSc.setAssociatedSc(event.target.value);\n    let i = 0;\n\n    while (i < smartComponents.length) {\n      if (smartComponents[i].scName === event.target.value) {\n        setSmartComponentIdChoice(smartComponents[i].scId);\n      }\n\n      i++;\n    }\n  };\n\n  const action = () => {// else\n    //props.addRemoveAssociatedSmartComponent(props.associatedSc)\n  };\n\n  return /*#__PURE__*/_jsxDEV(Grid, {\n    className: classes.box,\n    spacing: 2,\n    container: true,\n    direction: \"column\",\n    component: \"form\",\n    children: /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [\" \", confirm ? /*#__PURE__*/_jsxDEV(ConfirmAction, { ...confirmActionProps\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 332,\n        columnNumber: 23\n      }, this) : null, /*#__PURE__*/_jsxDEV(Grid, {\n        spacing: 1,\n        justify: \"space-between\",\n        item: true,\n        xs: true,\n        container: true,\n        direction: \"row\",\n        children: /*#__PURE__*/_jsxDEV(Grid, {\n          item: true,\n          xs: 6,\n          children: /*#__PURE__*/_jsxDEV(TextField, {\n            onChange: onChangeDtName,\n            value: dtName,\n            helperText: \"\",\n            error: !validDtName,\n            fullWidth: true,\n            required: true,\n            label: \"Insert New Digital Twin Name\",\n            id: \"dt-name\",\n            type: \"text\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 335,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 334,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 333,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(Grid, {\n        item: true,\n        container: true,\n        direction: \"row\",\n        justify: \"space-between\",\n        alignItems: \"center\",\n        children: [props.order ? /*#__PURE__*/_jsxDEV(Grid, {\n          item: true,\n          xs: 1,\n          children: props.order\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 348,\n          columnNumber: 13\n        }, this) : null, /*#__PURE__*/_jsxDEV(Grid, {\n          item: true,\n          xs: 3,\n          children: /*#__PURE__*/_jsxDEV(FormControl, {\n            fullWidth: true,\n            required: true,\n            children: [/*#__PURE__*/_jsxDEV(InputLabel, {\n              id: `digital-twin-label-${smartComponents}`,\n              children: \"SmartComponent\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 355,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(Select, {\n              labelId: `digital-twin-label-${smartComponents}`,\n              value: smartComponentChoice,\n              onChange: handleSmartComponentChoice,\n              children: (smartComponents || []).map(smartComponent => {\n                return /*#__PURE__*/_jsxDEV(MenuItem, {\n                  value: smartComponent.scName,\n                  children: smartComponent.scName\n                }, smartComponent.scId, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 361,\n                  columnNumber: 82\n                }, this);\n              })\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 356,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 354,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 353,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(Grid, {\n          item: true,\n          xs: 1,\n          children: /*#__PURE__*/_jsxDEV(Button, {\n            className: classes.varEvButton,\n            size: \"small\",\n            variant: \"contained\" // onClick={action}\n            ,\n            children: props.newSc ? '+' : 'x'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 366,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 365,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 346,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(Grid, {\n        item: true,\n        xs: true,\n        container: true,\n        direction: \"row\",\n        justify: \"space-between\",\n        alignItems: \"center\",\n        children: /*#__PURE__*/_jsxDEV(Grid, {\n          item: true,\n          xs: 6,\n          container: true,\n          direction: \"row\",\n          spacing: 2,\n          alignItems: \"center\",\n          justify: \"flex-end\",\n          children: [/*#__PURE__*/_jsxDEV(Grid, {\n            item: true,\n            children: /*#__PURE__*/_jsxDEV(Button, {\n              onClick: onCancel,\n              color: \"secondary\",\n              variant: \"contained\",\n              children: [/*#__PURE__*/_jsxDEV(Clear, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 384,\n                columnNumber: 84\n              }, this), cancelLabel]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 384,\n              columnNumber: 19\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 383,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(Grid, {\n            children: /*#__PURE__*/_jsxDEV(Button, {\n              onClick: confirmButtonAction,\n              color: \"primary\",\n              variant: \"contained\",\n              children: [/*#__PURE__*/_jsxDEV(Done, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 387,\n                columnNumber: 91\n              }, this), confirmLabel]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 387,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 386,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 382,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 381,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 331,\n    columnNumber: 7\n  }, this);\n};\n\n_s3(DigitalTwinForm, \"TPvxINyGkxrHDn8R4FU31OlmELs=\", false, function () {\n  return [useFunctionBlockStyles, useMountEffect, useStore];\n});\n\n_c5 = DigitalTwinForm;\n\nvar _c, _c2, _c3, _c4, _c5;\n\n$RefreshReg$(_c, \"SmartComponentList$React.memo\");\n$RefreshReg$(_c2, \"SmartComponentList\");\n$RefreshReg$(_c3, \"VariableRow$React.memo\");\n$RefreshReg$(_c4, \"VariableRow\");\n$RefreshReg$(_c5, \"DigitalTwinForm\");","map":{"version":3,"sources":["/media/maria/96ae9a87-ebe3-48cb-a2c1-fae5fe76b9e7/maria/Marketplace-JurassicPark/backend/web/src/components/DigitalTwin/DigitalTwinForm.tsx"],"names":["React","useState","useCallback","TextField","Grid","Button","InputLabel","Select","MenuItem","FormControl","useFunctionBlockStyles","Done","Clear","ConfirmActionStateLabel","ConfirmAction","SmartComponentActions","useStore","getOrDownloadSmartComponents","useMountEffect","SmartComponentList","memo","props","smartComponents","setSmartComponents","onSmartComponentRemoval","onSmartComponentEdition","classes","newSc","scId","scName","scAddress","scPort","newSmartComponent","setNewSmartComponent","setSmartComponent","smartComponent","index","prevScs","oldSmartComponent","newSmartComponents","addSmartComponent","scToAdd","prevSmartComponents","removeSmartComponent","smartComponentToRemove","filter","title","box","map","variable","addVariable","setNewVariable","newVariable","VariableRow","validName","setValidName","action","isValid","newVar","addRemoveVariable","variableName","validate","useEffect","updateField","field","event","setVariable","target","value","order","variableOpcua","variableDataType","Object","values","DataType","dt","varEvButton","prevProps","nextProps","DigitalTwinForm","dtName","setDtName","validDtName","setValidDtName","onChangeDtName","trim","onCancel","cancel","cancelLabel","label","confirmLabel","confirmDialog","buttonTitle","confirm","setConfirm","validateFields","cValidDtName","confirmButtonAction","confirmActionStates","start","positiveLabel","negativeLabel","state","executing","success","error","confirmActionProps","states","currentState","onError","onSuccess","setTimeout","setFetching","then","result","updateSmartComponents","catch","e","setError","msg","finally","fetching","data","dispatchAction","dispatchSmartComponentActions","scs","updateSmartComponent","smartComponentChoice","setSmartComponentChoice","smartComponentIdChoice","setSmartComponentIdChoice","handleSmartComponentChoice","associatedSc","setAssociatedSc","i","length"],"mappings":"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","sourcesContent":["import React, { useState, useCallback } from 'react'\nimport { TextField, Grid, Button, InputLabel, Select, MenuItem, FormControl } from '@material-ui/core'\nimport { AssociatedSmartComponent, SmartComponent } from '../../model'\nimport { useFunctionBlockStyles } from '../FunctionBlocks/FunctionBlock/style'\nimport { Done, Clear } from '@material-ui/icons'\nimport { ConfirmActionProps, ConfirmActionStateLabel, ConfirmActionAction, ConfirmAction } from '../templates/ConfirmAction/ConfirmAction'\nimport { AssociatedSmartComponentActions, SmartComponentActions } from '../../redux/actions'\nimport { useStore } from '../templates/Store/Store'\nimport { getOrDownloadSmartComponents } from '../../utils/smartComponents'\nimport { useMountEffect } from '../../utils/main'\nimport { RequestResponseState } from '../../services/api/api'\n\ninterface SmartComponentProps {\n  setSmartComponents: Function\n  smartComponents: SmartComponent[]\n  title: string\n  onSmartComponentRemoval: (smartComponent: SmartComponent) => void\n  onSmartComponentEdition: (oldSmartComponent: SmartComponent, newSmartComponent: SmartComponent) => void\n}\n\nexport const SmartComponentList = React.memo((props: SmartComponentProps) => {\n  \n  const {smartComponents,setSmartComponents,onSmartComponentRemoval,onSmartComponentEdition} = props\n\n  const classes = useFunctionBlockStyles()\n\n  const newSc : SmartComponent = {\n    scId: -1,\n    scName: \"\",\n    scAddress: \"\",\n    scPort: -1,\n  }\n\n  const [newSmartComponent,setNewSmartComponent] : [SmartComponent,Function] = useState(newSc)\n\n  const setSmartComponent = useCallback((smartComponent: SmartComponent , index:number) => {\n\n    setSmartComponents((prevScs: SmartComponent[]) => {\n\n      const oldSmartComponent : SmartComponent = prevScs[index]\n      const newSmartComponents : SmartComponent[] = [...prevScs]\n      newSmartComponents[index] = smartComponent\n      onSmartComponentEdition(oldSmartComponent,smartComponent)\n      return newSmartComponents\n\n    }) \n\n  },[onSmartComponentEdition, setSmartComponents])\n\n  const addSmartComponent = useCallback((scToAdd: SmartComponent) => {\n    \n    setSmartComponents((prevSmartComponents: SmartComponent[]) =>[...prevSmartComponents, scToAdd])\n    setNewSmartComponent(newSc)\n\n  }, [setSmartComponents,newSc]) \n\n  const removeSmartComponent = useCallback((smartComponentToRemove:SmartComponent) => {\n    setSmartComponents((prevSmartComponents: SmartComponent[]) => prevSmartComponents.filter((smartComponent:SmartComponent,index:number) => smartComponent !== smartComponentToRemove))\n    onSmartComponentRemoval(smartComponentToRemove)\n  },[onSmartComponentRemoval,setSmartComponents]) \n\n  return (\n    <Grid container direction=\"column\">\n      <Grid item>{props.title}</Grid>\n      <Grid item className={classes.box}>\n        {smartComponents.map((variable:SmartComponent, index:number) => <VariableRow key={index} index={index} addRemoveSmartComponent={removeSmartComponent} setSmartComponent={setSmartComponent} smartComponent={smartComponent} newSc={false} />)}\n        <VariableRow index={-1} addRemoveVariable={addVariable} setVariable={setNewVariable} variable={newVariable} newVar={true}  />\n      </Grid> \n    </Grid>\n  )\n})\n\ninterface VariableRowProps {\n  index: number \n  addRemoveVariable: (variable: Variable) => void\n  setVariable:Function\n  variable: Variable\n  newVar: boolean\n  order?: number\n}\n\nconst VariableRow = React.memo((props: VariableRowProps) => {\n\n  const classes = useFunctionBlockStyles()\n\n  const [validName,setValidName] = useState(\"\")\n\n  const action = () => {\n\n    if(!isValid() && props.newVar) \n      setValidName(\"Mandatory\")\n    \n    else\n      props.addRemoveVariable(props.variable)\n    \n  }\n\n  const isValid = useCallback(() => props.variable.variableName !== '', [props.variable])\n\n  const validate = useCallback(() => {\n    \n    !isValid() ? setValidName(\"Mandatory\") : setValidName('')\n\n  },[isValid]) \n\n  useEffect(() => {if(!props.newVar) validate()}, [props.variable.variableName, props.newVar, validate])\n\n  const updateField = (field:string) => (event:any) => {\n\n    setValidName('')\n    props.setVariable({...props.variable, [field]: event.target.value},props.index)\n  \n  }\n\n  return (\n    <Grid item container direction=\"row\" justify=\"space-between\" alignItems=\"center\">\n      { props.order ?\n      <Grid item xs={1}>\n          {props.order}\n      </Grid>\n      : null\n      }\n      <Grid item xs={4}>\n        <TextField \n          value={props.variable.variableName} \n          onChange={updateField('variableName')}\n          helperText={validName} fullWidth \n          required\n          error={validName !== ''} \n          label=\"Name\" \n          type=\"text\" />\n      </Grid>\n      <Grid item xs={2}>\n        <TextField \n          value={props.variable.variableOpcua || ''}\n          onChange={updateField('variableOpcua')} \n          helperText=\"\" \n          fullWidth \n          label=\"OPCUA\" \n          type=\"text\" />\n      </Grid>\n      <Grid item xs={3}>\n        <FormControl fullWidth required>\n          <InputLabel id={`data-type-label-${props.variable.variableName}`}>Data Type</InputLabel>\n          <Select\n            labelId={`data-type-label-${props.variable.variableName}`}\n            value={props.variable.variableDataType}\n            onChange={updateField('variableDataType')}\n          >\n            {Object.values(DataType).map((dt:any, index:number) => <MenuItem key={index} value={dt}>{dt}</MenuItem>)}\n\n          </Select>\n        </FormControl>\n      </Grid>\n      <Grid item xs={1}>\n        <Button \n          className={classes.varEvButton} \n          size=\"small\" \n          variant=\"contained\"\n          onClick={action}\n        >\n        {props.newVar ? '+' : 'x' }</Button>\n      </Grid>\n    </Grid>\n  )\n}\n ,(prevProps:VariableRowProps, nextProps: VariableRowProps) => prevProps.variable === nextProps.variable\n)\n\ninterface DigitalTwinFormProps {\n\n    dtName: {\n        dtName: string\n        setDtName: Function\n    },\n    associatedSc: {\n        associatedSc: string\n        setAssociatedSc: Function\n    }\n    cancel: {\n        label: string\n        action: () => void\n    },\n    confirmDialog: {\n        buttonTitle: string\n        title: string\n        initialState: ConfirmActionStateLabel\n        action: ConfirmActionAction\n        onSuccess : () => void\n        start? : {\n            label: string\n            positiveLabel: string\n            negativeLabel: string\n        }\n        success: {\n            label:string\n            positiveLabel: string\n        }\n        error: {\n            label: string\n            positiveLabel: string\n        }\n    },\n    order?: number,\n    newSc?: boolean,\n    // addRemoveAssociatedSmartComponent: (associatedSc: AssociatedSmartComponent) => void,\n}\n\nexport const DigitalTwinForm = (props: DigitalTwinFormProps) => {\n\n    /**styles */\n    const classes = useFunctionBlockStyles()\n\n    /**Digital Twin*/\n    const {dtName, setDtName} = props.dtName\n    const [validDtName, setValidDtName] = useState(true)\n    const onChangeDtName = useCallback((event:any) => {\n\n        setDtName(event.target.value.trim())\n        setValidDtName(true)\n    \n      },[setDtName])\n\n    /* Buttons */\n\n    const onCancel = props.cancel.action\n    const cancelLabel = props.cancel.label\n\n    const confirmLabel = props.confirmDialog.buttonTitle\n\n    /* Confirmation */\n\n    const [confirm, setConfirm] : [boolean, Function] = useState(false)\n\n    const validateFields = () : boolean => {\n\n        const cValidDtName = dtName.trim() !== ''\n            \n        if(!cValidDtName) setValidDtName(cValidDtName)\n    \n        return cValidDtName \n    \n    }\n\n    const confirmButtonAction = () => {\n\n        if(validateFields())\n          setConfirm(true)\n    }\n\n    const confirmActionStates = {\n        start: {\n            label: props.confirmDialog.start?.label,\n            positiveLabel: props.confirmDialog.start?.positiveLabel,\n            negativeLabel: props.confirmDialog.start?.negativeLabel,\n            state: ConfirmActionStateLabel.start\n        },\n        executing: {\n          label: '',\n          state: ConfirmActionStateLabel.executing,\n        },\n        success: {\n          label: props.confirmDialog.success.label,\n          state: ConfirmActionStateLabel.success,\n          positiveLabel: props.confirmDialog.success.positiveLabel\n        },\n        error: {\n          label: props.confirmDialog.error.label,\n          state: ConfirmActionStateLabel.error,\n          positiveLabel: props.confirmDialog.success.positiveLabel\n        },\n      }\n    \n    const confirmActionProps : ConfirmActionProps = {\n\n        title: props.confirmDialog.title,\n        states: confirmActionStates,\n        currentState: confirmActionStates.executing,\n        onCancel: () => setConfirm(false),\n        onError: () => setConfirm(false),\n        onSuccess: props.confirmDialog.onSuccess,\n        action:props.confirmDialog.action,\n      \n    }\n\n    // Recuperar diretamente da comunicação OPC-UA os smart_components disponíveis (SmartComponent)\n    useMountEffect(() => {\n\n      setTimeout(() => {\n  \n      setFetching(true)\n      getOrDownloadSmartComponents(smartComponents)\n          .then((result: SmartComponent[]) => updateSmartComponents(result))\n          .catch((e:RequestResponseState) => setError(e.msg))\n          .finally(() => setFetching(false))\n      }, 0)\n      })\n  \n    // Associar um SmartComponent pelo frontend\n      \n    const [fetching,setFetching] = useState(true)\n    const {data:smartComponents, dispatchAction:dispatchSmartComponentActions} = useStore('smartComponents')\n    const updateSmartComponents = (scs: SmartComponent[]) => dispatchSmartComponentActions(SmartComponentActions.updateSmartComponent(scs))\n    const [error,setError] = useState('')\n\n    const [smartComponentChoice, setSmartComponentChoice] = useState('')\n    const [smartComponentIdChoice, setSmartComponentIdChoice] = useState(0)\n  \n    const handleSmartComponentChoice = (event: React.ChangeEvent<{ value: unknown }>) => {\n      setSmartComponentChoice(event.target.value as string);\n      props.associatedSc.setAssociatedSc(event.target.value as string)\n      let i = 0;\n      while(i < smartComponents.length)\n      {\n          if( smartComponents[i].scName === (event.target.value as string))\n          {\n              setSmartComponentIdChoice(smartComponents[i].scId)\n          }\n          i++;\n      }\n    };\n\n    const action = () => {\n\n      // else\n      //props.addRemoveAssociatedSmartComponent(props.associatedSc)\n      \n    }\n\n    return (\n      <Grid className={classes.box} spacing={2} container direction=\"column\" component=\"form\">\n        <> {confirm ? <ConfirmAction {...confirmActionProps} /> : null}\n          <Grid spacing={1} justify=\"space-between\" item xs container direction=\"row\">\n            <Grid item xs={6}>\n              <TextField\n                onChange={onChangeDtName} \n                value={dtName}\n                helperText=\"\"\n                error={!validDtName} \n                fullWidth required \n                label=\"Insert New Digital Twin Name\" \n                id=\"dt-name\" \n                type=\"text\" />\n            </Grid>\n          </Grid>\n          <Grid item container direction=\"row\" justify=\"space-between\" alignItems=\"center\">\n            {props.order ?\n            <Grid item xs={1}>\n                {props.order}\n            </Grid>\n            : null\n            }\n            <Grid item xs={3}>\n              <FormControl fullWidth required>\n                <InputLabel id={`digital-twin-label-${smartComponents}`}>SmartComponent</InputLabel>\n                <Select\n                  labelId={`digital-twin-label-${smartComponents}`}\n                  value={smartComponentChoice}\n                  onChange={handleSmartComponentChoice}\n                >\n                   {(smartComponents || []).map((smartComponent: any) => {return <MenuItem key={smartComponent.scId} value={smartComponent.scName}>{smartComponent.scName}</MenuItem>})}\n                </Select>\n              </FormControl>\n            </Grid>\n            <Grid item xs={1}>\n              <Button \n                className={classes.varEvButton} \n                size=\"small\" \n                variant=\"contained\"\n                // onClick={action}\n              >\n              {props.newSc ? '+' : 'x' }</Button>\n            </Grid>\n          </Grid>\n          {/* <Grid  item xs={4}>\n            <InputLabel id={`digital-twin-label-${smartComponents}`}>Choose a Smart Component to associate</InputLabel>\n            <Select labelId={`digital-twin-label-${smartComponents}`} value={smartComponentChoice} onChange={handleSmartComponentChoice}>\n              {(smartComponents || []).map((smartComponent: any) => {return <MenuItem key={smartComponent.scId} value={smartComponent.scName}>{smartComponent.scName}</MenuItem>})}\n            </Select> \n          </Grid> */}\n          <Grid item xs container direction=\"row\" justify=\"space-between\" alignItems=\"center\"> \n            <Grid item xs={6} container direction=\"row\" spacing={2} alignItems=\"center\" justify=\"flex-end\">\n              <Grid item>\n                  <Button onClick={onCancel} color=\"secondary\" variant=\"contained\"><Clear/>{cancelLabel}</Button>\n              </Grid>\n              <Grid>\n                <Button onClick={confirmButtonAction} color=\"primary\" variant=\"contained\"><Done/>{confirmLabel}</Button>\n              </Grid>\n            </Grid>\n          </Grid>\n        </>\n    </Grid>\n  ) \n}"]},"metadata":{},"sourceType":"module"}