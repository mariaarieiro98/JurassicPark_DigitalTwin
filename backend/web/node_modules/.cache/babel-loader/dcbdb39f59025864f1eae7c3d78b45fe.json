{"ast":null,"code":"var _jsxFileName = \"/home/maria/Desktop/Marketplace-JurassicPark/backend/web/src/components/DigitalTwin/DigitalTwinMonitoring.tsx\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nimport React, { useState } from 'react';\nimport { Navigator } from '../templates/Navigator/Navigator';\nimport { ConfirmAction, ConfirmActionStateLabel } from '../templates/ConfirmAction/ConfirmAction';\nimport { LazyComponent } from '../templates/LazyComponent/LazyComponent';\nimport { JPTable } from '../templates/Table/JPTable';\nimport { useMountEffect } from '../../utils/main';\nimport { getOrDownloadDigitalTwins } from '../../utils/digitalTwins';\nimport { useStore } from '../templates/Store/Store';\nimport { FunctionalityActions, DigitalTwinActions } from '../../redux/actions';\nimport { TextField, Grid, Button, Box, Dialog, DialogTitle, CircularProgress } from '@material-ui/core';\nimport { createFunctionality, updateFunctionality } from '../../services/api/digital-twin';\nimport { deleteFunctionality } from '../../services/api/digital-twin';\nimport { useDialogStyles } from '../FunctionBlockCategories/List/style';\nimport { CheckCircle, Error } from '@material-ui/icons';\nimport { useFunctionBlockStyles } from '../FunctionBlocks/FunctionBlock/style';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst NEW_FUNCTIONALITY_RE = /[a-zA-Z0-9]{3,}/;\nlet functionalityId = -1;\n\nconst EditFunctionalityDialog = props => {\n  _s();\n\n  const [newFuncName, setNewFuncName] = useState(props.func.funcName);\n  const classes = useDialogStyles();\n  const [sending, setSending] = useState(false);\n  const [result, setResult] = useState({\n    done: false\n  });\n\n  const action = () => {\n    if (props.func.funcId) {\n      if (!result.done) {\n        setSending(true);\n        updateFunctionality(props.func.funcId, newFuncName).then(response => {\n          setResult({\n            done: true,\n            good: true,\n            message: response.msg\n          });\n        }).catch(error => {\n          setResult({\n            done: true,\n            good: false,\n            message: error.msg\n          });\n        }).finally(() => setSending(false));\n      } else {\n        if (result.good) props.onGood({ ...props.func,\n          funcName: newFuncName\n        });else props.onError();\n      }\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(Dialog, {\n    open: true,\n    children: [/*#__PURE__*/_jsxDEV(DialogTitle, {\n      children: \"Edit Functionality\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 71,\n      columnNumber: 11\n    }, this), /*#__PURE__*/_jsxDEV(Box, {\n      className: classes.box,\n      children: !result.done ? /*#__PURE__*/_jsxDEV(TextField, {\n        disabled: sending,\n        value: newFuncName,\n        onChange: event => setNewFuncName(event.target.value)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 76,\n        columnNumber: 27\n      }, this) : /*#__PURE__*/_jsxDEV(Grid, {\n        container: true,\n        justify: \"center\",\n        children: [/*#__PURE__*/_jsxDEV(Grid, {\n          item: true,\n          children: result.good ? /*#__PURE__*/_jsxDEV(CheckCircle, {\n            color: \"primary\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 85,\n            columnNumber: 47\n          }, this) : /*#__PURE__*/_jsxDEV(Error, {\n            color: \"error\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 86,\n            columnNumber: 47\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 82,\n          columnNumber: 31\n        }, this), /*#__PURE__*/_jsxDEV(Grid, {\n          item: true,\n          children: /*#__PURE__*/_jsxDEV(Box, {\n            className: result.good ? classes.good : classes.error,\n            textAlign: \"center\",\n            children: result.message\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 90,\n            columnNumber: 35\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 89,\n          columnNumber: 31\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 81,\n        columnNumber: 28\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 72,\n      columnNumber: 11\n    }, this), /*#__PURE__*/_jsxDEV(Grid, {\n      className: classes.buttons,\n      container: true,\n      direction: \"row\",\n      justify: \"space-between\",\n      children: [/*#__PURE__*/_jsxDEV(Grid, {\n        item: true,\n        children: sending ? /*#__PURE__*/_jsxDEV(CircularProgress, {\n          color: \"primary\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 98,\n          columnNumber: 25\n        }, this) : /*#__PURE__*/_jsxDEV(Button, {\n          onClick: action,\n          children: \"Ok\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 99,\n          columnNumber: 25\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 96,\n        columnNumber: 15\n      }, this), /*#__PURE__*/_jsxDEV(Grid, {\n        item: true,\n        children: /*#__PURE__*/_jsxDEV(Button, {\n          disabled: sending,\n          onClick: props.onCancel,\n          children: \"Cancel\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 103,\n          columnNumber: 19\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 102,\n        columnNumber: 15\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 95,\n      columnNumber: 11\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 70,\n    columnNumber: 7\n  }, this);\n};\n\n_s(EditFunctionalityDialog, \"pa6Sqs49YPMvA2bR1UMOpZZcg98=\", false, function () {\n  return [useDialogStyles];\n});\n\n_c = EditFunctionalityDialog;\nexport const DigitalTwinMonitoring = () => {\n  _s2();\n\n  const classes = useFunctionBlockStyles();\n  const [fetching, setFetching] = useState(true);\n  const [error, setError] = useState('');\n  const [newFunc, setNewFunc] = useState('');\n  const [confirmAddFunc, setConfirmAddFunc] = useState(false);\n  const [validNewFunc, setValidNewFunc] = useState(true);\n  const errorFetchingFunctionalityState = {\n    label: error,\n    state: ConfirmActionStateLabel.error,\n    positiveLabel: 'Ok'\n  };\n  const {\n    data: functionalities,\n    dispatchAction: dispatchFunctionalityActions\n  } = useStore('functionalities');\n  const {\n    data: digitalTwins,\n    dispatchAction: dispatchDigitalTwinActions\n  } = useStore('digitalTwins');\n\n  const onCancel = () => setError('');\n\n  const updateFunctionalities = funcs => dispatchFunctionalityActions(FunctionalityActions.updateFunctionalities(funcs));\n\n  const updateDigitalTwins = dts => dispatchDigitalTwinActions(DigitalTwinActions.updateDigitalTwins(dts));\n\n  const addFunc = () => dispatchFunctionalityActions(FunctionalityActions.addFunctionality({\n    funcId: functionalityId,\n    funcUserId: 1,\n    funcName: newFunc,\n    funcdtId: 1\n  }));\n\n  const [editingFunc, setEditingFunc] = useState(null);\n  const indexes = [{\n    label: 'Functionality',\n    key: 'funcName'\n  }, {\n    label: 'Digital Twin',\n    key: 'dt'\n  } //{label: 'State', key: 'dtDescription'},\n  //{label: 'AssociatedSmartComponents', key: 'dtSmartComponents'},\n  //{label: 'Monitored Variables/Events', key: 'dtMonitoredVariableEvent'},\n  //{label: 'Add Variables/Events', key: 'dtAddVariableEvent'},\n  //{label: 'Details', key: 'dtDetails'},\n  ];\n  useMountEffect(() => {\n    setTimeout(() => {\n      setFetching(true);\n      getOrDownloadDigitalTwins(digitalTwins).then(result => updateDigitalTwins(result)).catch(e => setError(e.msg)).finally(() => setFetching(false));\n    }, 0);\n  });\n  console.log(digitalTwins);\n\n  const isFunctionalityValid = func => NEW_FUNCTIONALITY_RE.test(func);\n\n  const validateAndCreate = () => {\n    const validFunc = isFunctionalityValid(newFunc);\n    if (!validFunc) setValidNewFunc(false);else setConfirmAddFunc(true);\n  };\n\n  const addNewFunctionalityAction = () => {\n    return new Promise((res, rej) => {\n      createFunctionality(newFunc.trim()).then(result => {\n        functionalityId = result.extra.lastInsertedId;\n        res('Functionality created');\n      }).catch(e => rej(e.msg));\n    });\n  };\n\n  const confirmFunctionalityCreationActionStates = {\n    start: {\n      label: `Confirm creation of new functionality: ${newFunc} ?`,\n      positiveLabel: 'Ok',\n      negativeLabel: 'Cancel',\n      state: ConfirmActionStateLabel.start\n    },\n    executing: {\n      label: '',\n      state: ConfirmActionStateLabel.executing\n    },\n    success: {\n      label: 'Functionality Created',\n      state: ConfirmActionStateLabel.success,\n      positiveLabel: 'Ok'\n    },\n    error: {\n      label: 'Error Creating Functionality',\n      state: ConfirmActionStateLabel.error,\n      positiveLabel: 'Ok'\n    }\n  };\n  const confirmActionProps = {\n    title: 'Add Functionality',\n    states: confirmFunctionalityCreationActionStates,\n    currentState: confirmFunctionalityCreationActionStates.start,\n    onCancel: () => setConfirmAddFunc(false),\n    onError: () => setConfirmAddFunc(false),\n    onSuccess: () => {\n      addFunc();\n      setNewFunc('');\n    },\n    action: addNewFunctionalityAction\n  };\n\n  const getDataFunctionality = () => functionalities.map(functionality => {\n    return { ...functionality\n    };\n  });\n\n  const getDataDigitalTwin = () => digitalTwins.map(digitalTwin => {\n    return { ...digitalTwin\n    };\n  });\n\n  const deleteFunctionalityAction = func => {\n    return new Promise(async (res, rej) => {\n      if (!func.funcId) {\n        rej('Error');\n        return;\n      }\n\n      try {\n        const response = await deleteFunctionality(func.funcId);\n        res(response);\n      } catch (err) {\n        rej(err);\n      }\n    });\n  };\n\n  const cancelEditing = () => setEditingFunc(null);\n\n  const showEditing = func => setEditingFunc(func);\n\n  const onGoodEditing = editingFunctionality => {\n    const newFunctionalities = functionalities.map(func => {\n      if (func.funcId === editingFunctionality.funcId) return { ...func,\n        funcName: editingFunctionality.funcName,\n        funcdtId: editingFunctionality.funcdtId\n      };\n      return func;\n    });\n    cancelEditing();\n    dispatchFunctionalityActions(FunctionalityActions.updateFunctionalities(newFunctionalities));\n  };\n\n  return /*#__PURE__*/_jsxDEV(Navigator, {\n    title: \"New Digital Twin Functionality\",\n    children: /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [error !== '' ? /*#__PURE__*/_jsxDEV(ConfirmAction, {\n        title: \"Fetching Functionalities\",\n        currentState: errorFetchingFunctionalityState,\n        states: {\n          error: errorFetchingFunctionalityState\n        },\n        onCancel: onCancel\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 286,\n        columnNumber: 19\n      }, this) : null, /*#__PURE__*/_jsxDEV(LazyComponent, {\n        loaded: !fetching,\n        children: /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [confirmAddFunc ? /*#__PURE__*/_jsxDEV(ConfirmAction, { ...confirmActionProps\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 292,\n            columnNumber: 24\n          }, this) : editingFunc ? /*#__PURE__*/_jsxDEV(EditFunctionalityDialog, {\n            onGood: onGoodEditing,\n            func: editingFunc,\n            onError: cancelEditing,\n            onCancel: cancelEditing\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 294,\n            columnNumber: 29\n          }, this) : null, /*#__PURE__*/_jsxDEV(Grid, {\n            container: true,\n            direction: \"column\",\n            spacing: 2,\n            children: [/*#__PURE__*/_jsxDEV(Grid, {\n              item: true,\n              children: /*#__PURE__*/_jsxDEV(JPTable, {\n                sortedkey: \"funcName\",\n                data: getDataFunctionality(),\n                updateData: updateFunctionalities,\n                indexes: indexes,\n                tName: \"Functionality\",\n                extra: {\n                  delete: {\n                    action: deleteFunctionalityAction,\n                    labelKey: 'funcName',\n                    onSuccessDelete: () => {}\n                  },\n                  edit: {\n                    action: showEditing\n                  }\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 303,\n                columnNumber: 25\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 302,\n              columnNumber: 23\n            }, this), /*#__PURE__*/_jsxDEV(Grid, {\n              item: true,\n              xs: true,\n              children: \"New Functionality\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 321,\n              columnNumber: 21\n            }, this), /*#__PURE__*/_jsxDEV(Grid, {\n              item: true,\n              children: [/*#__PURE__*/_jsxDEV(Grid, {\n                container: true,\n                item: true,\n                xs: true,\n                children: /*#__PURE__*/_jsxDEV(Grid, {\n                  className: classes.box,\n                  spacing: 1,\n                  item: true,\n                  container: true,\n                  direction: \"row\",\n                  children: /*#__PURE__*/_jsxDEV(Grid, {\n                    item: true,\n                    xs: 4,\n                    children: /*#__PURE__*/_jsxDEV(TextField, {\n                      helperText: !validNewFunc ? NEW_FUNCTIONALITY_RE.toString() : '',\n                      error: !validNewFunc,\n                      label: \"Insert new functionality name\",\n                      required: true,\n                      onChange: event => {\n                        setNewFunc(event.target.value);\n                        if (!validNewFunc) setValidNewFunc(isFunctionalityValid(event.target.value.trim()));\n                      },\n                      fullWidth: true,\n                      value: newFunc\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 328,\n                      columnNumber: 33\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 327,\n                    columnNumber: 29\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 326,\n                  columnNumber: 29\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 325,\n                columnNumber: 25\n              }, this), /*#__PURE__*/_jsxDEV(Grid, {\n                container: true,\n                justify: \"flex-end\",\n                spacing: 1,\n                children: /*#__PURE__*/_jsxDEV(Grid, {\n                  item: true,\n                  children: /*#__PURE__*/_jsxDEV(Button, {\n                    color: \"primary\",\n                    variant: \"contained\",\n                    onClick: validateAndCreate,\n                    children: \"Add Functionality\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 359,\n                    columnNumber: 34\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 358,\n                  columnNumber: 30\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 357,\n                columnNumber: 26\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 324,\n              columnNumber: 22\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 301,\n            columnNumber: 18\n          }, this)]\n        }, void 0, true)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 289,\n        columnNumber: 10\n      }, this)]\n    }, void 0, true)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 283,\n    columnNumber: 5\n  }, this);\n};\n\n_s2(DigitalTwinMonitoring, \"Nr7yCcixMT+QXsN7KZ9+WaviqY0=\", false, function () {\n  return [useFunctionBlockStyles, useStore, useStore, useMountEffect];\n});\n\n_c2 = DigitalTwinMonitoring;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"EditFunctionalityDialog\");\n$RefreshReg$(_c2, \"DigitalTwinMonitoring\");","map":{"version":3,"sources":["/home/maria/Desktop/Marketplace-JurassicPark/backend/web/src/components/DigitalTwin/DigitalTwinMonitoring.tsx"],"names":["React","useState","Navigator","ConfirmAction","ConfirmActionStateLabel","LazyComponent","JPTable","useMountEffect","getOrDownloadDigitalTwins","useStore","FunctionalityActions","DigitalTwinActions","TextField","Grid","Button","Box","Dialog","DialogTitle","CircularProgress","createFunctionality","updateFunctionality","deleteFunctionality","useDialogStyles","CheckCircle","Error","useFunctionBlockStyles","NEW_FUNCTIONALITY_RE","functionalityId","EditFunctionalityDialog","props","newFuncName","setNewFuncName","func","funcName","classes","sending","setSending","result","setResult","done","action","funcId","then","response","good","message","msg","catch","error","finally","onGood","onError","box","event","target","value","buttons","onCancel","DigitalTwinMonitoring","fetching","setFetching","setError","newFunc","setNewFunc","confirmAddFunc","setConfirmAddFunc","validNewFunc","setValidNewFunc","errorFetchingFunctionalityState","label","state","positiveLabel","data","functionalities","dispatchAction","dispatchFunctionalityActions","digitalTwins","dispatchDigitalTwinActions","updateFunctionalities","funcs","updateDigitalTwins","dts","addFunc","addFunctionality","funcUserId","funcdtId","editingFunc","setEditingFunc","indexes","key","setTimeout","e","console","log","isFunctionalityValid","test","validateAndCreate","validFunc","addNewFunctionalityAction","Promise","res","rej","trim","extra","lastInsertedId","confirmFunctionalityCreationActionStates","start","negativeLabel","executing","success","confirmActionProps","title","states","currentState","onSuccess","getDataFunctionality","map","functionality","getDataDigitalTwin","digitalTwin","deleteFunctionalityAction","err","cancelEditing","showEditing","onGoodEditing","editingFunctionality","newFunctionalities","delete","labelKey","onSuccessDelete","edit","toString"],"mappings":"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","sourcesContent":["import React, { useState } from 'react'\r\nimport { Navigator } from '../templates/Navigator/Navigator'\r\nimport { ConfirmAction, ConfirmActionState, ConfirmActionStateLabel, ConfirmActionProps } from '../templates/ConfirmAction/ConfirmAction'\r\nimport { LazyComponent } from '../templates/LazyComponent/LazyComponent'\r\nimport { JPTable } from '../templates/Table/JPTable'\r\nimport { Functionality, DigitalTwin} from '../../model'\r\nimport { useMountEffect } from '../../utils/main'\r\nimport { getOrDownloadDigitalTwins, getOrDownloadFunctionalities} from '../../utils/digitalTwins'\r\nimport { useStore } from '../templates/Store/Store'\r\nimport { FunctionalityActions , DigitalTwinActions} from '../../redux/actions'\r\nimport { RequestResponseState } from '../../services/api/api'\r\nimport { TextField, Grid, Button, Box, Dialog, DialogTitle, CircularProgress , FormControl, InputLabel, Select , MenuItem } from '@material-ui/core'\r\nimport { createFunctionality, updateFunctionality } from '../../services/api/digital-twin'\r\nimport { deleteFunctionality} from '../../services/api/digital-twin'\r\nimport { useDialogStyles } from '../FunctionBlockCategories/List/style'\r\nimport { CheckCircle, Error } from '@material-ui/icons'\r\nimport { useFunctionBlockStyles } from '../FunctionBlocks/FunctionBlock/style'\r\n\r\nconst NEW_FUNCTIONALITY_RE = /[a-zA-Z0-9]{3,}/\r\n\r\nlet functionalityId = -1\r\n\r\nconst EditFunctionalityDialog = (props: {func: Functionality, onGood: (newFunc: Functionality) => void, onError: () => void, onCancel: () => void}) => {\r\n\r\n  const [newFuncName, setNewFuncName] : [string,Function] = useState(props.func.funcName)\r\n\r\n  const classes = useDialogStyles()\r\n\r\n  const [sending, setSending] : [boolean, Function] = useState(false)\r\n\r\n  const [result, setResult] : [{done: boolean, good?: boolean, message?: string},Function] = useState({done:false})\r\n\r\n  const action = () => {\r\n\r\n      if(props.func.funcId) {\r\n\r\n          if(!result.done) {\r\n\r\n              setSending(true)\r\n  \r\n              updateFunctionality(props.func.funcId, newFuncName)\r\n\r\n                  .then((response: RequestResponseState) => {\r\n                      setResult({done:true, good: true, message: response.msg})\r\n                  })\r\n\r\n                  .catch((error: RequestResponseState) => {\r\n                      setResult({done: true, good: false, message: error.msg})\r\n                  })\r\n\r\n                  .finally(() => setSending(false))\r\n\r\n          }\r\n\r\n          else {\r\n\r\n              if(result.good)\r\n                  props.onGood({...props.func, funcName: newFuncName})\r\n              \r\n              else\r\n                  props.onError()\r\n\r\n          }\r\n\r\n      }\r\n\r\n  }\r\n\r\n  return (\r\n      <Dialog open={true}>\r\n          <DialogTitle>Edit Functionality</DialogTitle>\r\n          <Box className={classes.box}>\r\n              {\r\n                  !result.done \r\n                      ?\r\n                          <TextField \r\n                              disabled={sending}\r\n                              value={newFuncName}\r\n                              onChange={(event) => setNewFuncName(event.target.value)}\r\n                          />\r\n                      :    <Grid container justify=\"center\">\r\n                              <Grid item>\r\n                                  {\r\n                                      result.good \r\n                                          ?   <CheckCircle color=\"primary\" />\r\n                                          :   <Error color=\"error\" />\r\n                                  }\r\n                              </Grid>\r\n                              <Grid item>\r\n                                  <Box className={result.good ? classes.good : classes.error} textAlign=\"center\">{result.message}</Box>\r\n                              </Grid>\r\n                          </Grid> \r\n              }\r\n          </Box>\r\n          <Grid className={classes.buttons} container direction=\"row\" justify=\"space-between\">\r\n              <Grid item>\r\n                  {sending \r\n                      ? <CircularProgress color=\"primary\" />\r\n                      : <Button onClick={action}>Ok</Button>\r\n                  }\r\n              </Grid>\r\n              <Grid item>\r\n                  <Button disabled={sending} onClick={props.onCancel}>Cancel</Button>\r\n              </Grid>\r\n          </Grid>\r\n      </Dialog>\r\n  )\r\n\r\n}\r\n\r\nexport const DigitalTwinMonitoring = () => {\r\n    \r\n  const classes = useFunctionBlockStyles()\r\n\r\n  const [fetching,setFetching] = useState(true)\r\n  const [error,setError] = useState('')\r\n  const [newFunc,setNewFunc] = useState('')\r\n\r\n  const [confirmAddFunc,setConfirmAddFunc] : [boolean, Function] = useState(false)\r\n\r\n  const [validNewFunc, setValidNewFunc] : [boolean,Function] = useState(true)\r\n\r\n  const errorFetchingFunctionalityState : ConfirmActionState = {\r\n    label: error,\r\n    state: ConfirmActionStateLabel.error,\r\n    positiveLabel: 'Ok'\r\n  }\r\n\r\n  const {data:functionalities, dispatchAction:dispatchFunctionalityActions} = useStore('functionalities')\r\n  const {data:digitalTwins, dispatchAction:dispatchDigitalTwinActions} = useStore('digitalTwins')\r\n\r\n  const onCancel = () => setError('')\r\n\r\n  const updateFunctionalities = (funcs: Functionality[]) => dispatchFunctionalityActions(FunctionalityActions.updateFunctionalities(funcs))\r\n  const updateDigitalTwins = (dts: DigitalTwin[]) => dispatchDigitalTwinActions(DigitalTwinActions.updateDigitalTwins(dts))\r\n  const addFunc = () => dispatchFunctionalityActions(FunctionalityActions.addFunctionality({funcId: functionalityId, funcUserId: 1 , funcName: newFunc, funcdtId: 1}))\r\n \r\n  const [editingFunc, setEditingFunc] : [Functionality | null,Function] = useState(null)\r\n\r\n  const indexes = [\r\n    {label: 'Functionality', key: 'funcName'},\r\n    {label: 'Digital Twin', key: 'dt'},\r\n    //{label: 'State', key: 'dtDescription'},\r\n    //{label: 'AssociatedSmartComponents', key: 'dtSmartComponents'},\r\n    //{label: 'Monitored Variables/Events', key: 'dtMonitoredVariableEvent'},\r\n    //{label: 'Add Variables/Events', key: 'dtAddVariableEvent'},\r\n    //{label: 'Details', key: 'dtDetails'},\r\n  ]\r\n  \r\n  useMountEffect(() => {\r\n\r\n    setTimeout(() => {\r\n\r\n    setFetching(true)\r\n    getOrDownloadDigitalTwins(digitalTwins)\r\n        .then((result: DigitalTwin[]) => updateDigitalTwins(result))\r\n        .catch((e:RequestResponseState) => setError(e.msg))\r\n        .finally(() => setFetching(false))\r\n    }, 0)\r\n  })\r\n\r\n  console.log(digitalTwins)\r\n\r\n  const isFunctionalityValid = (func:string) => NEW_FUNCTIONALITY_RE.test(func)\r\n\r\n  const validateAndCreate = () => {\r\n\r\n  const validFunc= isFunctionalityValid(newFunc)\r\n\r\n    if(!validFunc)\r\n      setValidNewFunc(false)\r\n    else\r\n      setConfirmAddFunc(true)\r\n\r\n  }\r\n\r\n  const addNewFunctionalityAction = () : Promise<string> => {\r\n\r\n    return new Promise<string>((res:Function, rej:Function)  => {\r\n\r\n        createFunctionality(newFunc.trim())\r\n\r\n            .then((result: RequestResponseState) => {\r\n            functionalityId= result.extra.lastInsertedId\r\n                res('Functionality created')\r\n            })\r\n\r\n            .catch((e:RequestResponseState) => rej(e.msg))\r\n\r\n    })\r\n  }\r\n\r\n  const confirmFunctionalityCreationActionStates = {\r\n    start: {\r\n      label: `Confirm creation of new functionality: ${newFunc} ?`,\r\n      positiveLabel: 'Ok',\r\n      negativeLabel: 'Cancel',\r\n      state: ConfirmActionStateLabel.start\r\n    },\r\n    executing: {\r\n      label: '',\r\n      state: ConfirmActionStateLabel.executing,\r\n    },\r\n    success: {\r\n      label: 'Functionality Created',\r\n      state: ConfirmActionStateLabel.success,\r\n      positiveLabel: 'Ok'\r\n    },\r\n    error: {\r\n      label: 'Error Creating Functionality',\r\n      state: ConfirmActionStateLabel.error,\r\n      positiveLabel: 'Ok'\r\n    },\r\n  }\r\n\r\n  const confirmActionProps : ConfirmActionProps = {\r\n\r\n    title: 'Add Functionality',\r\n    states: confirmFunctionalityCreationActionStates,\r\n    currentState: confirmFunctionalityCreationActionStates.start,\r\n    onCancel: () => setConfirmAddFunc(false),\r\n    onError: () => setConfirmAddFunc(false),\r\n    onSuccess: () => {\r\n        addFunc()\r\n        setNewFunc('')\r\n    },\r\n    action: addNewFunctionalityAction,\r\n  }\r\n\r\n  const getDataFunctionality = () => functionalities.map((functionality: Functionality) => {\r\n\r\n    return {\r\n          ...functionality,\r\n    }\r\n  })\r\n\r\n  const getDataDigitalTwin = () => digitalTwins.map((digitalTwin: DigitalTwin) => {\r\n\r\n    return {\r\n          ...digitalTwin,\r\n    }\r\n  })\r\n\r\n\r\n  const deleteFunctionalityAction = (func: Functionality) : Promise<any> => {\r\n\r\n    return new Promise(async(res:Function,rej:Function) => {\r\n\r\n        if(!func.funcId) {\r\n            rej('Error')\r\n            return\r\n        }\r\n\r\n        try {\r\n            const response : RequestResponseState = await deleteFunctionality(func.funcId)\r\n            res(response)\r\n          }\r\n\r\n        catch(err) {\r\n            rej(err)\r\n        }\r\n    })\r\n  }\r\n\r\n  const cancelEditing = () => setEditingFunc(null)\r\n  const showEditing = (func: Functionality) => setEditingFunc(func)\r\n\r\n  const onGoodEditing = (editingFunctionality: Functionality) => {\r\n      \r\n    const newFunctionalities = functionalities.map((func: Functionality) => {\r\n\r\n    if(func.funcId === editingFunctionality.funcId)\r\n        return {...func, funcName: editingFunctionality.funcName, funcdtId: editingFunctionality.funcdtId}\r\n    return func\r\n\r\n    })\r\n  \r\n    cancelEditing()\r\n    dispatchFunctionalityActions(FunctionalityActions.updateFunctionalities(newFunctionalities))\r\n  }\r\n\r\n  return (\r\n    <Navigator title=\"New Digital Twin Functionality\">\r\n     <> \r\n        {error !== ''\r\n                ? <ConfirmAction title='Fetching Functionalities' currentState={errorFetchingFunctionalityState} states={{error: errorFetchingFunctionalityState}} onCancel={onCancel}/>\r\n                : null \r\n        }\r\n         <LazyComponent loaded={!fetching}>\r\n             <>\r\n                 {confirmAddFunc \r\n                     ? <ConfirmAction {...confirmActionProps} /> \r\n                     : editingFunc\r\n                         ?  <EditFunctionalityDialog\r\n                             onGood={onGoodEditing}\r\n                             func={editingFunc}\r\n                             onError={cancelEditing}\r\n                             onCancel={cancelEditing} />\r\n                         : null\r\n                 }\r\n                 <Grid container direction=\"column\" spacing={2}>\r\n                      <Grid item>\r\n                        <JPTable\r\n                            sortedkey=\"funcName\"\r\n                            data={getDataFunctionality()} \r\n                            updateData={updateFunctionalities} \r\n                            indexes={indexes} \r\n                            tName='Functionality'\r\n                            extra={{\r\n                                delete: {\r\n                                    action: deleteFunctionalityAction,\r\n                                    labelKey: 'funcName',\r\n                                    onSuccessDelete: () => {}\r\n                                },\r\n                                edit: {\r\n                                    action: showEditing\r\n                                }\r\n                              }} \r\n                        />\r\n                      </Grid>\r\n                    <Grid item xs>\r\n                        New Functionality\r\n                    </Grid>\r\n                     <Grid item>\r\n                        <Grid container item xs>\r\n                            <Grid className={classes.box} spacing={1} item container direction=\"row\">\r\n                            <Grid item xs={4}>\r\n                                <TextField\r\n                                    helperText={!validNewFunc ? NEW_FUNCTIONALITY_RE.toString() : ''}\r\n                                    error={!validNewFunc}\r\n                                    label=\"Insert new functionality name\" \r\n                                    required\r\n                                    onChange={(event) => {\r\n                                        setNewFunc(event.target.value)\r\n                                        if(!validNewFunc)\r\n                                            setValidNewFunc(isFunctionalityValid(event.target.value.trim()))\r\n                                    }}\r\n                                    fullWidth\r\n                                    value={newFunc}\r\n                                />\r\n                             </Grid>\r\n                             {/* <Grid item xs={3}>\r\n                                <FormControl fullWidth required>\r\n                                <InputLabel id={`data-type-label-${props.variable.variableName}`}>Digital Twin</InputLabel>\r\n                                <Select\r\n                                    labelId={`data-type-label-${props.variable.variableName}`}\r\n                                    value={props.variable.variableDataType}\r\n                                    onChange={updateField('variableDataType')}\r\n                                >\r\n                                    {Object.values(DataType).map((dt:any, index:number) => <MenuItem key={index} value={dt}>{dt}</MenuItem>)}\r\n\r\n                                </Select>\r\n                                </FormControl>\r\n                            </Grid> */}\r\n                        </Grid>\r\n                        </Grid>\r\n                         <Grid container justify=\"flex-end\" spacing={1}>\r\n                             <Grid item>\r\n                                 <Button\r\n                                    color=\"primary\"\r\n                                    variant=\"contained\"\r\n                                    onClick={validateAndCreate}\r\n                                 >\r\n                                    Add Functionality\r\n                                 </Button>\r\n                             </Grid>\r\n                         </Grid>\r\n                     </Grid>\r\n                 </Grid>\r\n             </>\r\n         </LazyComponent>\r\n     </>\r\n </Navigator>\r\n )\r\n}"]},"metadata":{},"sourceType":"module"}