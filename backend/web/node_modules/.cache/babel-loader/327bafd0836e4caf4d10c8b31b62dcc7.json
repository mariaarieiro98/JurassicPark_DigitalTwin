{"ast":null,"code":"var _jsxFileName = \"/home/maria/Desktop/Marketplace-JurassicPark/backend/web/src/components/FunctionBlocks/FunctionBlock/FunctionBlockForm.tsx\";\nimport React, { useState, useCallback, useEffect } from 'react';\nimport { FormControl, InputLabel, TextField, Grid, Select, MenuItem, Box, Button, Typography, Chip } from '@material-ui/core';\nimport { FBGeneralCategory, InOutType } from '../../../model';\nimport { useFunctionBlockStyles } from './style';\nimport { VariableList } from './Variable';\nimport { setSimpleField, useMountEffect } from '../../../utils/main';\nimport { EventList } from './Event';\nimport { Done, Clear } from '@material-ui/icons';\nimport { ReactComponent as UploadIcon } from \"@svgr/webpack?-svgo,+titleProp,+ref!../../../icons/Upload.svg\";\nimport { getFBfromFbtFile, getOrDownloadFunctionBlockCategories } from '../../../utils/functionBlock';\nimport { ConfirmActionStateLabel, ConfirmAction } from '../../templates/ConfirmAction/ConfirmAction';\nimport { useStore } from '../../templates/Store/Store';\nimport { FunctionBlockCategoriesActions } from '../../../redux/actions';\nconst DEFAULT_VALUES = {\n  eventType: 'Event'\n};\n\nconst updateEventVariablesOnRemoveVariable = (events, variableToRemove) => {\n  const newEvents = [...events];\n  newEvents.forEach(event => {\n    event.eventVariables = event.eventVariables.filter(ev => ev.evVariableName !== variableToRemove.variableName);\n  });\n  return newEvents;\n};\n\nconst updateEventVariablesOnUpdateVariable = (events, oldVariable, variableEdited) => {\n  const newEvents = [...events];\n  newEvents.forEach(event => {\n    event.eventVariables = event.eventVariables.map(ev => {\n      if (ev.evVariableName === oldVariable.variableName) return {\n        evVariableName: variableEdited.variableName,\n        evEventName: event.eventName\n      };else return ev;\n    });\n  });\n  return newEvents;\n};\n\nexport const FunctionBlockForm = props => {\n  var _props$confirmDialog$, _props$confirmDialog$2, _props$confirmDialog$3, _props$byPassFields2;\n\n  /**styles */\n  const classes = useFunctionBlockStyles();\n  /**list of categories */\n\n  const {\n    data: functionBlockCategories,\n    dispatchAction: dispatchFunctionBlockCategoriesActions\n  } = useStore('functionBlockCategories');\n  const [validCategory, setValidCategory] = useState(true);\n  /**Fb type */\n\n  const {\n    fbType,\n    setFbType\n  } = props.fbType;\n  const [validType, setValidType] = useState(true);\n  const onChangeFBType = useCallback(event => {\n    setFbType(event.target.value.trim());\n    setValidType(true);\n  }, [setFbType]);\n  /**FB General Category */\n\n  const {\n    fbGeneralCategory,\n    setfbGeneralCategory\n  } = props.fbGeneralCategory;\n  const [validGeneralCategory, setValidGeneralCategory] = useState(true);\n  const [generalCategoryNames, setGeneralCategoryNames] = useState([...Object.values(FBGeneralCategory), '']);\n  /**Db Description */\n\n  const {\n    fbCategory,\n    setFbCategory\n  } = props.fbCategory;\n  /**Db Description */\n\n  const {\n    fbDescription,\n    setFbDescription\n  } = props.fbDescription;\n  const [validDescription, setValidDescription] = useState(true);\n  /* Variables and Events */\n\n  const {\n    fbInputVariables,\n    setFbInputVariables\n  } = props.fbInputVariables;\n  const {\n    fbOutputVariables,\n    setFbOutputVariables\n  } = props.fbOutputVariables;\n\n  const getEmptyEvent = type => ({\n    eventId: -1,\n    eventOpcua: \"\",\n    eventInoutType: type,\n    eventName: '',\n    eventType: DEFAULT_VALUES.eventType,\n    eventVariables: []\n  });\n\n  const [newInputEvent, setNewInputEvent] = useState(getEmptyEvent(InOutType.in));\n  const [newOutputEvent, setNewOutputEvent] = useState(getEmptyEvent(InOutType.out));\n  const {\n    fbInputEvents,\n    setFbInputEvents\n  } = props.fbInputEvents;\n  const {\n    fbOutputEvents,\n    setFbOutputEvents\n  } = props.fbOutputEvents;\n  /** Variable Update and Edition */\n\n  const onInputVariableRemoval = useCallback(variableToRemove => {\n    setFbInputEvents(prevEvents => updateEventVariablesOnRemoveVariable(prevEvents, variableToRemove));\n    setNewInputEvent(prevEvent => updateEventVariablesOnRemoveVariable([prevEvent], variableToRemove)[0]);\n  }, [setFbInputEvents]);\n  const onOutputVariableRemoval = useCallback(variableToRemove => {\n    setFbOutputEvents(prevEvents => updateEventVariablesOnRemoveVariable(prevEvents, variableToRemove));\n    setNewOutputEvent(prevEvent => updateEventVariablesOnRemoveVariable([prevEvent], variableToRemove)[0]);\n  }, [setFbOutputEvents]);\n  const onInputVariableEdition = useCallback((oldVariable, newVariable) => {\n    setFbInputEvents(prevEvents => updateEventVariablesOnUpdateVariable(prevEvents, oldVariable, newVariable));\n    setNewInputEvent(prevNewEvent => updateEventVariablesOnUpdateVariable([prevNewEvent], oldVariable, newVariable)[0]);\n  }, [setFbInputEvents]);\n  const onOutputVariableEdition = useCallback((oldVariable, newVariable) => {\n    setFbOutputEvents(prevEvents => updateEventVariablesOnUpdateVariable(prevEvents, oldVariable, newVariable));\n    setNewOutputEvent(pevEvent => updateEventVariablesOnUpdateVariable([pevEvent], oldVariable, newVariable)[0]);\n  }, [setFbOutputEvents]);\n  /* Event edition */\n\n  const addNewInputEvent = useCallback(() => {\n    setFbInputEvents(prevEvents => [...prevEvents, newInputEvent]);\n    setNewInputEvent(getEmptyEvent(InOutType.in));\n  }, [newInputEvent, setFbInputEvents]);\n  const addNewOutputEvent = useCallback(() => {\n    setFbOutputEvents(prevEvents => [...prevEvents, newOutputEvent]);\n    setNewOutputEvent(getEmptyEvent(InOutType.out));\n  }, [newOutputEvent, setFbOutputEvents]);\n  const removeInputEvent = useCallback(eventToRemove => setFbInputEvents(prevEvents => prevEvents.filter(event => event !== eventToRemove)), [setFbInputEvents]);\n  const removeOutputEvent = useCallback(eventToRemove => setFbOutputEvents(prevEvents => prevEvents.filter(event => event !== eventToRemove)), [setFbOutputEvents]);\n\n  const setEvent = type => (event, index) => {\n    const setFunction = type === InOutType.in ? setFbInputEvents : setFbOutputEvents;\n    setFunction(prevEvents => {\n      const newEvents = [...prevEvents];\n      newEvents[index] = event;\n      return newEvents;\n    });\n  };\n\n  const setInputEvent = useCallback(setEvent(InOutType.in), []);\n  const setOutputEvent = useCallback(setEvent(InOutType.out), []);\n  /* Dependencies */\n\n  const {\n    fbExternalDependencies,\n    setFbExternalDependencies\n  } = props.fbExternalDependencies;\n  const [currentDependency, setCurrentDependency] = useState('');\n  const addDependency = useCallback(() => {\n    setFbExternalDependencies(prevDependencies => {\n      const name = currentDependency.trim();\n      setCurrentDependency('');\n      if (name === '' || prevDependencies.filter(ed => ed.edName === name).length) return prevDependencies;\n      return [...prevDependencies, {\n        edName: currentDependency\n      }];\n    });\n  }, [setFbExternalDependencies, currentDependency]);\n  const deleteDependency = useCallback(ed => () => {\n    setFbExternalDependencies(prevDependencies => prevDependencies.filter(cEd => cEd.edName !== ed.edName));\n  }, [setFbExternalDependencies]);\n  const onChangeCurrentDependency = useCallback(event => setCurrentDependency(event.target.value), []);\n  /* Implementation File */\n\n  const {\n    fbImplFile,\n    setFbImplFile\n  } = props.fbImplFile;\n  const [validFile, setValidFile] = useState(true);\n\n  const changeImplFile = event => {\n    if (event.target.files.length > 0) {\n      setFbImplFile(event.target.files[0]);\n      setValidFile(true);\n    }\n  };\n  /* FBT file reading */\n\n\n  const [errorReadingFBT, setErrorReadingFBT] = useState({\n    msg: '',\n    err: false,\n    file: false\n  });\n  const loadFiles = useCallback(fileList => {\n    if (fileList.length > 0) {\n      let fbt = undefined;\n      let py = undefined;\n\n      for (let i = 0; i < fileList.length; i++) {\n        let file = fileList[i];\n        if (/.*.(fbt|xml)$/.test(file.name)) fbt = file;else if (/.*.py$/.test(file.name)) py = file;\n        if (fbt && py) break;\n      }\n\n      if (!fbt && !py) {\n        setErrorReadingFBT({\n          file: true,\n          err: true,\n          msg: 'Only .fbt and .xml files for fb definition or .py files for fb implementation'\n        });\n        return;\n      } else {\n        if (fbt) {\n          getFBfromFbtFile(fbt).then(result => {\n            setFbType(result.fbType);\n            setFbDescription(result.fbType);\n            setfbGeneralCategory(result.fbGeneralCategory);\n            setFbInputVariables(result.fbInputVariables);\n            setFbOutputVariables(result.fbOutputVariables);\n            setFbInputEvents(result.fbInputEvents);\n            setFbOutputEvents(result.fbOutputEvents);\n            setValidType(true);\n            setValidDescription(true);\n            setValidGeneralCategory(!!result.fbGeneralCategory);\n            setErrorReadingFBT({\n              err: false,\n              msg: '',\n              file: true\n            });\n          }).catch(error => {\n            console.error(error);\n            setErrorReadingFBT({\n              file: true,\n              err: true,\n              msg: error.toString()\n            });\n          });\n        }\n\n        if (py) {\n          setFbImplFile(py);\n          setValidFile(true);\n        }\n      }\n    }\n  }, [setFbDescription, setFbImplFile, setFbInputEvents, setFbInputVariables, setFbOutputEvents, setFbOutputVariables, setFbType, setfbGeneralCategory]);\n  const onChangeFBTFile = useCallback(event => loadFiles(event.target.files), [loadFiles]);\n  /* Dropping Files */\n\n  const addPreventWindowToOpenFile = () => {\n    window.addEventListener('dragover', preventDefaultAction);\n    window.addEventListener('drop', preventDefaultAction);\n  };\n\n  const removePreventWindowToOpenFile = () => {\n    window.removeEventListener('dragover', preventDefaultAction);\n    window.removeEventListener('drop', preventDefaultAction);\n  };\n\n  const preventDefaultAction = event => event.preventDefault();\n\n  const changeGeneralCategory = useCallback(category => {\n    const valid = category !== '';\n    if (valid) setGeneralCategoryNames(Object.values(FBGeneralCategory));\n    setfbGeneralCategory(category);\n    setValidGeneralCategory(true);\n  }, [setfbGeneralCategory]);\n  useMountEffect(() => {\n    addPreventWindowToOpenFile();\n    getOrDownloadFunctionBlockCategories(functionBlockCategories).then(result => {\n      dispatchFunctionBlockCategoriesActions(FunctionBlockCategoriesActions.updateFunctionBlockCategories(result));\n    }).catch(err => console.error(err));\n  }, removePreventWindowToOpenFile);\n  useEffect(() => changeGeneralCategory(fbGeneralCategory), [changeGeneralCategory, fbGeneralCategory]);\n  const onDropFiles = useCallback(event => loadFiles(event.dataTransfer.files), [loadFiles]);\n  /* Buttons */\n\n  const onCancel = props.cancel.action;\n  const cancelLabel = props.cancel.label;\n  const confirmLabel = props.confirmDialog.buttonTitle;\n  /* Confirmation */\n\n  const [confirm, setConfirm] = useState(false);\n\n  const validateFields = () => {\n    var _props$byPassFields;\n\n    const cValidType = fbType.trim() !== '';\n    const cValidDescription = fbDescription.trim() !== '';\n    const cValidGeneralCategory = !!fbGeneralCategory;\n    const cValidCategory = fbCategory.fbcId !== -1;\n    const cValidFile = !!((_props$byPassFields = props.byPassFields) === null || _props$byPassFields === void 0 ? void 0 : _props$byPassFields.fbImplFile) || fbImplFile.name !== '';\n    if (!cValidType) setValidType(cValidType);\n    if (!cValidDescription) setValidDescription(cValidDescription);\n    if (!cValidGeneralCategory) setValidGeneralCategory(cValidGeneralCategory);\n    if (!cValidCategory) setValidCategory(cValidCategory);\n    if (!cValidFile) setValidFile(cValidFile);\n    return cValidType && cValidGeneralCategory && cValidCategory && cValidDescription && cValidFile;\n  };\n\n  const confirmButtonAction = () => {\n    if (validateFields()) setConfirm(true);\n  };\n\n  const confirmActionStates = {\n    start: {\n      label: (_props$confirmDialog$ = props.confirmDialog.start) === null || _props$confirmDialog$ === void 0 ? void 0 : _props$confirmDialog$.label,\n      positiveLabel: (_props$confirmDialog$2 = props.confirmDialog.start) === null || _props$confirmDialog$2 === void 0 ? void 0 : _props$confirmDialog$2.positiveLabel,\n      negativeLabel: (_props$confirmDialog$3 = props.confirmDialog.start) === null || _props$confirmDialog$3 === void 0 ? void 0 : _props$confirmDialog$3.negativeLabel,\n      state: ConfirmActionStateLabel.start\n    },\n    executing: {\n      label: '',\n      state: ConfirmActionStateLabel.executing\n    },\n    success: {\n      label: props.confirmDialog.success.label,\n      state: ConfirmActionStateLabel.success,\n      positiveLabel: props.confirmDialog.success.positiveLabel\n    },\n    error: {\n      label: props.confirmDialog.error.label,\n      state: ConfirmActionStateLabel.error,\n      positiveLabel: props.confirmDialog.success.positiveLabel\n    }\n  };\n  const confirmActionProps = {\n    title: props.confirmDialog.title,\n    states: confirmActionStates,\n    currentState: confirmActionStates.executing,\n    onCancel: () => setConfirm(false),\n    onError: () => setConfirm(false),\n    onSuccess: props.confirmDialog.onSuccess,\n    action: props.confirmDialog.action\n  };\n  return /*#__PURE__*/React.createElement(React.Fragment, null, \" \", confirm ? /*#__PURE__*/React.createElement(ConfirmAction, Object.assign({}, confirmActionProps, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 462,\n      columnNumber: 23\n    }\n  })) : null, /*#__PURE__*/React.createElement(Grid, {\n    onDrop: onDropFiles,\n    spacing: 2,\n    container: true,\n    direction: \"column\",\n    component: \"form\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 463,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    container: true,\n    alignItems: \"center\",\n    justify: errorReadingFBT.file ? 'space-between' : 'flex-end',\n    direction: \"row\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 464,\n      columnNumber: 13\n    }\n  }, errorReadingFBT.file ? /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 466,\n      columnNumber: 15\n    }\n  }, errorReadingFBT.err ? /*#__PURE__*/React.createElement(Typography, {\n    color: \"error\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 467,\n      columnNumber: 40\n    }\n  }, errorReadingFBT.msg) : /*#__PURE__*/React.createElement(Done, {\n    fontSize: \"small\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 467,\n      columnNumber: 103\n    }\n  })) : null, /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 470,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"input\", {\n    onChange: onChangeFBTFile,\n    value: \"\",\n    accept: \".xml,.fbt\",\n    type: \"file\",\n    id: \"raised-button-file\",\n    hidden: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 471,\n      columnNumber: 17\n    }\n  }), /*#__PURE__*/React.createElement(\"label\", {\n    htmlFor: \"raised-button-file\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 472,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    variant: \"outlined\",\n    component: \"span\",\n    size: \"small\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 473,\n      columnNumber: 21\n    }\n  }, \"Choose fbt file for form auto completion\")))), /*#__PURE__*/React.createElement(Grid, {\n    spacing: 1,\n    justify: \"space-between\",\n    item: true,\n    xs: true,\n    container: true,\n    direction: \"row\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 479,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 6,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 480,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(TextField, {\n    onChange: onChangeFBType,\n    value: fbType,\n    helperText: \"\",\n    error: !validType,\n    fullWidth: true,\n    required: true,\n    label: \"Type\",\n    id: \"fb-type\",\n    type: \"text\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 481,\n      columnNumber: 17\n    }\n  })), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 491,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(FormControl, {\n    fullWidth: true,\n    required: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 492,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(InputLabel, {\n    error: !validCategory,\n    id: \"category-label\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 493,\n      columnNumber: 19\n    }\n  }, \"Category\"), /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Select, {\n    error: !validCategory,\n    labelId: \"category-label\",\n    value: fbCategory.fbcName,\n    onChange: event => {\n      setValidCategory(true);\n      setFbCategory(functionBlockCategories.filter(cat => event.target.value === cat.fbcName)[0]);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 495,\n      columnNumber: 21\n    }\n  }, functionBlockCategories.map((cat, index) => /*#__PURE__*/React.createElement(MenuItem, {\n    key: index,\n    value: cat.fbcName,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 504,\n      columnNumber: 86\n    }\n  }, cat.fbcName)))))), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 510,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(FormControl, {\n    fullWidth: true,\n    required: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 511,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(InputLabel, {\n    error: !validGeneralCategory,\n    id: \"gen-category-label\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 512,\n      columnNumber: 19\n    }\n  }, \"General Category\"), /*#__PURE__*/React.createElement(Select, {\n    error: !validGeneralCategory,\n    labelId: \"gen-category-label\",\n    value: fbGeneralCategory || '',\n    onChange: event => {\n      setValidGeneralCategory(true);\n      changeGeneralCategory(event.target.value);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 513,\n      columnNumber: 19\n    }\n  }, generalCategoryNames.map((cat, index) => /*#__PURE__*/React.createElement(MenuItem, {\n    key: index,\n    value: cat,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 522,\n      columnNumber: 74\n    }\n  }, cat)))))), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 527,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(TextField, {\n    helperText: \"\",\n    variant: \"standard\",\n    fullWidth: true,\n    required: true,\n    multiline: true,\n    rowsMax: \"4\",\n    label: \"Description\",\n    id: \"description\",\n    type: \"text\",\n    error: !validDescription,\n    onChange: setSimpleField(setFbDescription, () => setValidDescription(true)),\n    value: fbDescription,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 528,\n      columnNumber: 15\n    }\n  })), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 542,\n      columnNumber: 13\n    }\n  }, \"Variables\"), /*#__PURE__*/React.createElement(Grid, {\n    container: true,\n    item: true,\n    xs: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 545,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    className: classes.box,\n    spacing: 1,\n    item: true,\n    container: true,\n    direction: \"row\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 546,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 6,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 547,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(VariableList, {\n    onVariableEdition: onInputVariableEdition,\n    onVariableRemoval: onInputVariableRemoval,\n    setVariables: setFbInputVariables,\n    inOutType: InOutType.in,\n    title: \"Input\",\n    variables: fbInputVariables,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 548,\n      columnNumber: 19\n    }\n  })), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 6,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 550,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(VariableList, {\n    onVariableEdition: onOutputVariableEdition,\n    onVariableRemoval: onOutputVariableRemoval,\n    setVariables: setFbOutputVariables,\n    inOutType: InOutType.out,\n    title: \"Output\",\n    variables: fbOutputVariables,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 551,\n      columnNumber: 19\n    }\n  })))), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 555,\n      columnNumber: 13\n    }\n  }, \"Events\"), /*#__PURE__*/React.createElement(Grid, {\n    container: true,\n    item: true,\n    xs: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 558,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    className: classes.box,\n    spacing: 1,\n    item: true,\n    container: true,\n    direction: \"row\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 559,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 6,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 560,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(EventList, {\n    setEvent: setInputEvent,\n    removeEvent: removeInputEvent,\n    addNewEvent: addNewInputEvent,\n    setEvents: setFbInputEvents,\n    newEvent: newInputEvent,\n    setNewEvent: setNewInputEvent,\n    variables: fbInputVariables,\n    inOutType: InOutType.in,\n    title: \"Input\",\n    events: fbInputEvents,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 561,\n      columnNumber: 19\n    }\n  })), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 6,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 563,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(EventList, {\n    setEvent: setOutputEvent,\n    removeEvent: removeOutputEvent,\n    addNewEvent: addNewOutputEvent,\n    setEvents: setFbOutputEvents,\n    newEvent: newOutputEvent,\n    setNewEvent: setNewOutputEvent,\n    variables: fbOutputVariables,\n    inOutType: InOutType.out,\n    title: \"Output\",\n    events: fbOutputEvents,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 564,\n      columnNumber: 19\n    }\n  })))), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 568,\n      columnNumber: 13\n    }\n  }, \"Dependencies\"), /*#__PURE__*/React.createElement(Grid, {\n    container: true,\n    xs: true,\n    item: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 571,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    container: true,\n    className: classes.box,\n    alignItems: \"center\",\n    justify: \"space-between\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 572,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    container: true,\n    direction: \"row\",\n    spacing: 1,\n    alignItems: \"flex-end\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 573,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 6,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 574,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(TextField, {\n    onChange: onChangeCurrentDependency,\n    value: currentDependency,\n    helperText: \"\",\n    fullWidth: true,\n    label: \"New Dependency\",\n    id: \"fb-new-dependency\",\n    type: \"text\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 575,\n      columnNumber: 21\n    }\n  })), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 584,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    onClick: addDependency,\n    className: classes.varEvButton,\n    size: \"small\",\n    variant: \"contained\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 585,\n      columnNumber: 21\n    }\n  }, \"+\"))), /*#__PURE__*/React.createElement(Grid, {\n    container: true,\n    className: `${classes.box} ${classes.dependenciesBox}`,\n    item: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 588,\n      columnNumber: 17\n    }\n  }, fbExternalDependencies.length ? fbExternalDependencies.map((ed, index) => /*#__PURE__*/React.createElement(Chip, {\n    key: index,\n    className: classes.dependency,\n    label: ed.edName,\n    onDelete: deleteDependency(ed),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 591,\n      columnNumber: 23\n    }\n  })) : 'No Dependencies'))), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: true,\n    container: true,\n    direction: \"row\",\n    justify: \"space-between\",\n    alignItems: \"center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 597,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 6,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 598,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"input\", {\n    onChange: changeImplFile,\n    value: \"\",\n    required: true,\n    accept: \".py\",\n    type: \"file\",\n    id: \"button-file\",\n    hidden: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 599,\n      columnNumber: 19\n    }\n  }), /*#__PURE__*/React.createElement(\"label\", {\n    htmlFor: \"button-file\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 600,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(TextField, {\n    className: classes.tfFile,\n    label: \"Implementation File\",\n    required: !((_props$byPassFields2 = props.byPassFields) === null || _props$byPassFields2 === void 0 ? void 0 : _props$byPassFields2.fbImplFile),\n    error: !validFile,\n    disabled: true,\n    value: fbImplFile.name,\n    InputProps: {\n      startAdornment: /*#__PURE__*/React.createElement(Box, {\n        pb: 1,\n        mr: 1,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 610,\n          columnNumber: 27\n        }\n      }, /*#__PURE__*/React.createElement(Button, {\n        variant: \"outlined\",\n        component: \"span\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 611,\n          columnNumber: 29\n        }\n      }, /*#__PURE__*/React.createElement(UploadIcon, {\n        className: classes.icon,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 612,\n          columnNumber: 31\n        }\n      })))\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 601,\n      columnNumber: 21\n    }\n  }))), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 6,\n    container: true,\n    direction: \"row\",\n    spacing: 2,\n    alignItems: \"center\",\n    justify: \"flex-end\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 619,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 620,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    onClick: onCancel,\n    color: \"secondary\",\n    variant: \"contained\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 621,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(Clear, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 621,\n      columnNumber: 86\n    }\n  }), cancelLabel)), /*#__PURE__*/React.createElement(Grid, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 623,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    onClick: confirmButtonAction,\n    color: \"primary\",\n    variant: \"contained\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 624,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(Done, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 624,\n      columnNumber: 93\n    }\n  }), confirmLabel))))));\n};","map":{"version":3,"sources":["/home/maria/Desktop/Marketplace-JurassicPark/backend/web/src/components/FunctionBlocks/FunctionBlock/FunctionBlockForm.tsx"],"names":["React","useState","useCallback","useEffect","FormControl","InputLabel","TextField","Grid","Select","MenuItem","Box","Button","Typography","Chip","FBGeneralCategory","InOutType","useFunctionBlockStyles","VariableList","setSimpleField","useMountEffect","EventList","Done","Clear","getFBfromFbtFile","getOrDownloadFunctionBlockCategories","ConfirmActionStateLabel","ConfirmAction","useStore","FunctionBlockCategoriesActions","DEFAULT_VALUES","eventType","updateEventVariablesOnRemoveVariable","events","variableToRemove","newEvents","forEach","event","eventVariables","filter","ev","evVariableName","variableName","updateEventVariablesOnUpdateVariable","oldVariable","variableEdited","map","evEventName","eventName","FunctionBlockForm","props","classes","data","functionBlockCategories","dispatchAction","dispatchFunctionBlockCategoriesActions","validCategory","setValidCategory","fbType","setFbType","validType","setValidType","onChangeFBType","target","value","trim","fbGeneralCategory","setfbGeneralCategory","validGeneralCategory","setValidGeneralCategory","generalCategoryNames","setGeneralCategoryNames","Object","values","fbCategory","setFbCategory","fbDescription","setFbDescription","validDescription","setValidDescription","fbInputVariables","setFbInputVariables","fbOutputVariables","setFbOutputVariables","getEmptyEvent","type","eventId","eventOpcua","eventInoutType","newInputEvent","setNewInputEvent","in","newOutputEvent","setNewOutputEvent","out","fbInputEvents","setFbInputEvents","fbOutputEvents","setFbOutputEvents","onInputVariableRemoval","prevEvents","prevEvent","onOutputVariableRemoval","onInputVariableEdition","newVariable","prevNewEvent","onOutputVariableEdition","pevEvent","addNewInputEvent","addNewOutputEvent","removeInputEvent","eventToRemove","removeOutputEvent","setEvent","index","setFunction","setInputEvent","setOutputEvent","fbExternalDependencies","setFbExternalDependencies","currentDependency","setCurrentDependency","addDependency","prevDependencies","name","ed","edName","length","deleteDependency","cEd","onChangeCurrentDependency","fbImplFile","setFbImplFile","validFile","setValidFile","changeImplFile","files","errorReadingFBT","setErrorReadingFBT","msg","err","file","loadFiles","fileList","fbt","undefined","py","i","test","then","result","catch","error","console","toString","onChangeFBTFile","addPreventWindowToOpenFile","window","addEventListener","preventDefaultAction","removePreventWindowToOpenFile","removeEventListener","preventDefault","changeGeneralCategory","category","valid","updateFunctionBlockCategories","onDropFiles","dataTransfer","onCancel","cancel","action","cancelLabel","label","confirmLabel","confirmDialog","buttonTitle","confirm","setConfirm","validateFields","cValidType","cValidDescription","cValidGeneralCategory","cValidCategory","fbcId","cValidFile","byPassFields","confirmButtonAction","confirmActionStates","start","positiveLabel","negativeLabel","state","executing","success","confirmActionProps","title","states","currentState","onError","onSuccess","fbcName","cat","box","varEvButton","dependenciesBox","dependency","tfFile","startAdornment","icon"],"mappings":"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","sourcesContent":["import React, { useState, useCallback, useEffect } from 'react'\nimport { FormControl, InputLabel, TextField, Grid, Select, MenuItem, Box, Button,Typography, Chip } from '@material-ui/core'\nimport { FBGeneralCategory, Variable, InOutType, Event, EventVariable, FunctionBlock, FBCategory, ExternalDependency } from '../../../model'\nimport { useFunctionBlockStyles } from './style'\nimport { VariableList } from './Variable'\nimport { setSimpleField, useMountEffect } from '../../../utils/main'\nimport { EventList } from './Event'\nimport { Done, Clear } from '@material-ui/icons'\nimport { ReactComponent as UploadIcon } from '../../../icons/Upload.svg'\nimport { getFBfromFbtFile, getOrDownloadFunctionBlockCategories } from '../../../utils/functionBlock'\nimport { ConfirmActionProps, ConfirmActionStateLabel, ConfirmActionAction, ConfirmAction } from '../../templates/ConfirmAction/ConfirmAction'\nimport { useStore } from '../../templates/Store/Store'\nimport { FunctionBlockCategoriesActions } from '../../../redux/actions'\n\nconst DEFAULT_VALUES = {\n    eventType: 'Event'\n}\n\nconst updateEventVariablesOnRemoveVariable = (events:Event[],variableToRemove:Variable, ) : Event[] => {\n\n    const newEvents : Event[] = [...events]\n    newEvents.forEach((event: Event) => {\n\n        event.eventVariables = event.eventVariables.filter((ev: EventVariable) => ev.evVariableName !== variableToRemove.variableName)\n\n    })\n\n    return newEvents\n\n}\n\nconst updateEventVariablesOnUpdateVariable = (events:Event[], oldVariable:Variable,variableEdited:Variable) : Event[] => {\n\n    const newEvents : Event[] = [...events]\n    newEvents.forEach((event: Event) => {\n\n      event.eventVariables = event.eventVariables.map((ev: EventVariable) => {\n        if(ev.evVariableName === oldVariable.variableName)\n          return {\n            evVariableName: variableEdited.variableName,\n            evEventName: event.eventName\n          }\n        else\n          return ev\n      }) \n\n    })\n\n    return newEvents\n\n}\n\ninterface FunctionBlockFormProps {\n\n    fbType: {\n        fbType: string\n        setFbType: Function\n    },\n    fbGeneralCategory: {\n        fbGeneralCategory: '' | FBGeneralCategory\n        setfbGeneralCategory: Function\n    },\n    fbCategory: {\n      fbCategory: FBCategory\n      setFbCategory: Function\n    }\n    fbDescription: {\n        fbDescription: string\n        setFbDescription: Function\n    },\n    fbInputVariables: {\n        fbInputVariables: Variable[]\n        setFbInputVariables: Function\n    }\n    fbOutputVariables: {\n        fbOutputVariables: Variable[]\n        setFbOutputVariables: Function\n    },\n    fbInputEvents: {\n        fbInputEvents: Event[]\n        setFbInputEvents: Function\n    }\n    fbOutputEvents: {\n        fbOutputEvents: Event[]\n        setFbOutputEvents: Function\n    },\n    fbExternalDependencies: {\n      fbExternalDependencies: ExternalDependency[]\n      setFbExternalDependencies: Function\n    }\n    fbImplFile: {\n        fbImplFile: File\n        setFbImplFile: Function\n    },\n    cancel: {\n        label: string\n        action: () => void\n    },\n    confirmDialog: {\n        buttonTitle: string\n        title: string\n        initialState: ConfirmActionStateLabel\n        action: ConfirmActionAction\n        onSuccess : () => void\n        start? : {\n            label: string\n            positiveLabel: string\n            negativeLabel: string\n        }\n        success: {\n            label:string\n            positiveLabel: string\n        }\n        error: {\n            label: string\n            positiveLabel: string\n        }\n    },\n    byPassFields?: {\n      fbImplFile: boolean\n    }\n}\n\nexport const FunctionBlockForm = (props: FunctionBlockFormProps) => {\n\n    /**styles */\n    const classes = useFunctionBlockStyles()\n\n    /**list of categories */\n    const {data: functionBlockCategories, dispatchAction:dispatchFunctionBlockCategoriesActions} = useStore('functionBlockCategories')\n\n    const [validCategory,setValidCategory] : [boolean, Function] = useState(true)\n\n    /**Fb type */\n    const {fbType, setFbType} = props.fbType\n    const [validType, setValidType] = useState(true)\n    const onChangeFBType = useCallback((event:any) => {\n\n        setFbType(event.target.value.trim())\n        setValidType(true)\n    \n      },[setFbType])\n\n    /**FB General Category */\n    const {fbGeneralCategory, setfbGeneralCategory} = props.fbGeneralCategory\n    const [validGeneralCategory, setValidGeneralCategory] = useState(true)\n    const [generalCategoryNames,setGeneralCategoryNames] : [string[],Function] = useState([...Object.values(FBGeneralCategory), ''])\n    \n    /**Db Description */\n    const {fbCategory,setFbCategory} = props.fbCategory\n\n    /**Db Description */\n    const {fbDescription,setFbDescription} = props.fbDescription\n    const [validDescription, setValidDescription] = useState(true)\n\n    /* Variables and Events */\n    const {fbInputVariables, setFbInputVariables} = props.fbInputVariables\n    const {fbOutputVariables, setFbOutputVariables} = props.fbOutputVariables\n    \n    const getEmptyEvent = (type:InOutType) : Event => ({\n        eventId: -1,\n        eventOpcua: \"\",\n        eventInoutType: type,\n        eventName: '',\n        eventType:DEFAULT_VALUES.eventType,\n        eventVariables: []\n    })\n\n    const [newInputEvent,setNewInputEvent] : [Event,Function] = useState(getEmptyEvent(InOutType.in))\n    const [newOutputEvent,setNewOutputEvent] : [Event,Function] = useState(getEmptyEvent(InOutType.out))\n\n    const {fbInputEvents, setFbInputEvents} = props.fbInputEvents\n    const {fbOutputEvents, setFbOutputEvents} = props.fbOutputEvents\n\n    /** Variable Update and Edition */\n    \n    const onInputVariableRemoval = useCallback((variableToRemove: Variable) => {\n\n        setFbInputEvents((prevEvents: Event[]) => updateEventVariablesOnRemoveVariable(prevEvents,variableToRemove))\n        setNewInputEvent((prevEvent:Event) => updateEventVariablesOnRemoveVariable([prevEvent],variableToRemove)[0])\n\n    }, [setFbInputEvents])\n\n    const onOutputVariableRemoval = useCallback((variableToRemove: Variable) => {\n\n        setFbOutputEvents((prevEvents: Event[]) => updateEventVariablesOnRemoveVariable(prevEvents,variableToRemove))\n        setNewOutputEvent((prevEvent: Event) => updateEventVariablesOnRemoveVariable([prevEvent],variableToRemove)[0])\n    \n    }, [setFbOutputEvents])\n\n\n    const onInputVariableEdition = useCallback((oldVariable:Variable, newVariable: Variable) => {\n\n        setFbInputEvents((prevEvents: Event[]) => updateEventVariablesOnUpdateVariable(prevEvents,oldVariable,newVariable))\n        setNewInputEvent((prevNewEvent: Event) => updateEventVariablesOnUpdateVariable([prevNewEvent],oldVariable,newVariable)[0])\n    \n    },[setFbInputEvents])\n    \n      const onOutputVariableEdition = useCallback((oldVariable:Variable, newVariable: Variable) => {\n    \n        setFbOutputEvents((prevEvents: Event[]) => updateEventVariablesOnUpdateVariable(prevEvents,oldVariable,newVariable))\n        setNewOutputEvent((pevEvent: Event) => updateEventVariablesOnUpdateVariable([pevEvent],oldVariable,newVariable)[0])\n    \n    },[setFbOutputEvents])\n\n\n    /* Event edition */\n\n    const addNewInputEvent = useCallback(() => {\n\n        setFbInputEvents((prevEvents: Event[]) => [...prevEvents, newInputEvent])\n        setNewInputEvent(getEmptyEvent(InOutType.in))\n    \n    },[newInputEvent, setFbInputEvents])\n    \n    const addNewOutputEvent = useCallback(() => {\n\n        setFbOutputEvents((prevEvents: Event[]) => [...prevEvents, newOutputEvent])\n        setNewOutputEvent(getEmptyEvent(InOutType.out))\n\n    },[newOutputEvent, setFbOutputEvents])\n    \n    const removeInputEvent = useCallback((eventToRemove: Event) => setFbInputEvents((prevEvents:Event[]) => prevEvents.filter((event:Event) => event !== eventToRemove)), [setFbInputEvents]) \n    const removeOutputEvent = useCallback((eventToRemove: Event) => setFbOutputEvents((prevEvents:Event[]) => prevEvents.filter((event:Event) => event !== eventToRemove)), [setFbOutputEvents]) \n    \n    const setEvent = (type:InOutType) => (event:Event,index:number) => {\n    \n        const setFunction = type === InOutType.in ? setFbInputEvents : setFbOutputEvents\n    \n        setFunction((prevEvents:Event[]) => {\n    \n          const newEvents : Event[] = [...prevEvents]\n          newEvents[index] = event\n          return newEvents\n        \n        })\n    \n    }\n\n    const setInputEvent = useCallback(setEvent(InOutType.in),[])\n    const setOutputEvent = useCallback(setEvent(InOutType.out),[])\n\n    /* Dependencies */\n\n    const {fbExternalDependencies, setFbExternalDependencies} = props.fbExternalDependencies\n    const [currentDependency, setCurrentDependency] : [string,Function] = useState('')\n\n    const addDependency = useCallback(() => {\n\n      setFbExternalDependencies((prevDependencies: ExternalDependency[]) => {\n\n        const name = currentDependency.trim()\n        setCurrentDependency('')\n        if(name === '' || prevDependencies.filter((ed: ExternalDependency) => ed.edName === name).length)\n          return prevDependencies\n        return [...prevDependencies, {edName: currentDependency}]\n      })\n\n    }, [setFbExternalDependencies, currentDependency])\n\n    const deleteDependency = useCallback((ed: ExternalDependency) => () => {\n\n      setFbExternalDependencies((prevDependencies: ExternalDependency[]) => prevDependencies.filter((cEd:ExternalDependency) => cEd.edName !== ed.edName))\n\n    }, [setFbExternalDependencies])\n\n    const onChangeCurrentDependency = useCallback((event: any) => setCurrentDependency(event.target.value), [])\n\n    /* Implementation File */\n\n    const {fbImplFile, setFbImplFile} = props.fbImplFile\n    const [validFile, setValidFile] = useState(true)\n\n    const changeImplFile = (event:any) => {\n\n        if(event.target.files.length > 0) {\n          setFbImplFile(event.target.files[0])\n          setValidFile(true)\n        }\n    \n    }\n\n    /* FBT file reading */\n\n    const [errorReadingFBT,setErrorReadingFBT] : [{msg:string, err: boolean, file:boolean},Function] = useState({msg:'', err: false, file:false})\n    \n    const loadFiles = useCallback((fileList: FileList) => {\n\n        if(fileList.length > 0) {\n    \n          let fbt: File | undefined = undefined\n          let py : File | undefined = undefined\n    \n          for(let i = 0; i < fileList.length; i++) {\n    \n            let file = fileList[i]\n    \n            if(/.*.(fbt|xml)$/.test(file.name)) \n              fbt = file\n            else if (/.*.py$/.test(file.name))\n              py = file\n             \n            if(fbt && py)\n              break\n          }\n\n          if(!fbt && !py) {\n            setErrorReadingFBT({file:true, err:true, msg:'Only .fbt and .xml files for fb definition or .py files for fb implementation'})\n            return\n          }\n    \n          else {\n    \n            if(fbt) {\n    \n              getFBfromFbtFile(fbt)\n                .then((result: FunctionBlock) => {\n        \n                  setFbType(result.fbType)\n                  setFbDescription(result.fbType)\n                  setfbGeneralCategory(result.fbGeneralCategory)\n                  setFbInputVariables(result.fbInputVariables)\n                  setFbOutputVariables(result.fbOutputVariables)\n                  setFbInputEvents(result.fbInputEvents)\n                  setFbOutputEvents(result.fbOutputEvents)\n        \n                  setValidType(true)\n                  setValidDescription(true)\n                  setValidGeneralCategory(!!result.fbGeneralCategory)\n                  setErrorReadingFBT({err:false,msg:'',file:true})\n        \n                })\n                .catch((error) => {\n                  console.error(error)\n                  setErrorReadingFBT({file:true,err: true, msg:error.toString()})\n        \n                })\n            }\n    \n            if(py) {\n              setFbImplFile(py)\n              setValidFile(true)\n    \n            }\n    \n          }\n        }\n    \n    }, [setFbDescription,setFbImplFile,setFbInputEvents,setFbInputVariables,setFbOutputEvents,setFbOutputVariables,setFbType,setfbGeneralCategory])\n\n    const onChangeFBTFile = useCallback((event:any) => loadFiles(event.target.files),[loadFiles])\n\n    /* Dropping Files */\n    const addPreventWindowToOpenFile = () => {\n        window.addEventListener('dragover', preventDefaultAction)\n        window.addEventListener('drop',preventDefaultAction)\n    }\n    \n    const removePreventWindowToOpenFile = () => {\n        window.removeEventListener('dragover', preventDefaultAction)\n        window.removeEventListener('drop',preventDefaultAction)\n    } \n     \n    const preventDefaultAction = (event:any) => event.preventDefault()\n    const changeGeneralCategory = useCallback((category: FBGeneralCategory | \"\") => {\n\n      const valid = category !== ''\n\n      if(valid)  \n        setGeneralCategoryNames(Object.values(FBGeneralCategory))\n      \n      setfbGeneralCategory(category)\n      setValidGeneralCategory(true)\n\n    },[setfbGeneralCategory])\n      \n    useMountEffect(() => {\n      \n      addPreventWindowToOpenFile()\n      getOrDownloadFunctionBlockCategories(functionBlockCategories)\n        .then((result: FBCategory[]) => {\n          dispatchFunctionBlockCategoriesActions(FunctionBlockCategoriesActions.updateFunctionBlockCategories(result))\n        })\n        .catch((err) => console.error(err))\n\n    },removePreventWindowToOpenFile)\n    useEffect(() => changeGeneralCategory(fbGeneralCategory),[changeGeneralCategory,fbGeneralCategory])\n\n    const onDropFiles = useCallback((event:any) => loadFiles(event.dataTransfer.files),[loadFiles])\n\n    /* Buttons */\n\n    const onCancel = props.cancel.action\n    const cancelLabel = props.cancel.label\n\n    const confirmLabel = props.confirmDialog.buttonTitle\n\n    /* Confirmation */\n\n    const [confirm, setConfirm] : [boolean, Function] = useState(false)\n\n    const validateFields = () : boolean => {\n\n        const cValidType = fbType.trim() !== ''\n        const cValidDescription = fbDescription.trim() !== ''\n        const cValidGeneralCategory = !!fbGeneralCategory\n        const cValidCategory = fbCategory.fbcId !== -1\n        const cValidFile = !!props.byPassFields?.fbImplFile || fbImplFile.name !== ''  \n            \n        if(!cValidType) setValidType(cValidType)\n        if(!cValidDescription) setValidDescription(cValidDescription)\n        if(!cValidGeneralCategory) setValidGeneralCategory(cValidGeneralCategory)\n        if(!cValidCategory) setValidCategory(cValidCategory)\n        if(!cValidFile) setValidFile(cValidFile)\n    \n        return cValidType && cValidGeneralCategory && cValidCategory && cValidDescription && cValidFile\n    \n    }\n\n    const confirmButtonAction = () => {\n\n        if(validateFields())\n          setConfirm(true)\n    }\n\n    const confirmActionStates = {\n        start: {\n            label: props.confirmDialog.start?.label,\n            positiveLabel: props.confirmDialog.start?.positiveLabel,\n            negativeLabel: props.confirmDialog.start?.negativeLabel,\n            state: ConfirmActionStateLabel.start\n        },\n        executing: {\n          label: '',\n          state: ConfirmActionStateLabel.executing,\n        },\n        success: {\n          label: props.confirmDialog.success.label,\n          state: ConfirmActionStateLabel.success,\n          positiveLabel: props.confirmDialog.success.positiveLabel\n        },\n        error: {\n          label: props.confirmDialog.error.label,\n          state: ConfirmActionStateLabel.error,\n          positiveLabel: props.confirmDialog.success.positiveLabel\n        },\n      }\n    \n    const confirmActionProps : ConfirmActionProps = {\n\n        title: props.confirmDialog.title,\n        states: confirmActionStates,\n        currentState: confirmActionStates.executing,\n        onCancel: () => setConfirm(false),\n        onError: () => setConfirm(false),\n        onSuccess: props.confirmDialog.onSuccess,\n        action:props.confirmDialog.action,\n      \n    }\n\n    return (\n        <> {confirm ? <ConfirmAction {...confirmActionProps} /> : null}\n          <Grid onDrop={onDropFiles} spacing={2} container direction=\"column\" component=\"form\">\n            <Grid item container alignItems=\"center\" justify={errorReadingFBT.file ? 'space-between' : 'flex-end'} direction=\"row\">\n              {errorReadingFBT.file ?\n              <Grid item>\n                {errorReadingFBT.err ? <Typography color=\"error\">{errorReadingFBT.msg}</Typography> : <Done fontSize=\"small\" />}\n              </Grid>\n              : null}\n              <Grid item>\n                <input onChange={onChangeFBTFile} value=\"\" accept=\".xml,.fbt\" type=\"file\" id=\"raised-button-file\" hidden />\n                  <label htmlFor=\"raised-button-file\">\n                    <Button variant=\"outlined\" component=\"span\" size=\"small\">\n                      Choose fbt file for form auto completion\n                    </Button>\n                  </label> \n              </Grid>\n            </Grid>\n            <Grid spacing={1} justify=\"space-between\" item xs container direction=\"row\">\n              <Grid item xs={6}>\n                <TextField\n                  onChange={onChangeFBType} \n                  value={fbType}\n                  helperText=\"\"\n                  error={!validType} \n                  fullWidth required \n                  label=\"Type\" \n                  id=\"fb-type\" \n                  type=\"text\" />\n              </Grid>\n              <Grid item xs>\n                <FormControl fullWidth required>\n                  <InputLabel error={!validCategory} id=\"category-label\">Category</InputLabel>\n                  <>\n                    <Select\n                      error={!validCategory}\n                      labelId=\"category-label\"\n                      value={fbCategory.fbcName}\n                      onChange={(event) => {\n                        setValidCategory(true)\n                        setFbCategory(functionBlockCategories.filter((cat:FBCategory) => event.target.value === cat.fbcName)[0])\n                      }} \n                    >\n                      {functionBlockCategories.map((cat:FBCategory, index:number) => <MenuItem key={index} value={cat.fbcName}>{cat.fbcName}</MenuItem>)}\n                    </Select>\n                   \n                  </>\n                </FormControl>\n              </Grid>\n              <Grid item xs>\n                <FormControl fullWidth required>\n                  <InputLabel error={!validGeneralCategory} id=\"gen-category-label\">General Category</InputLabel>\n                  <Select\n                    error={!validGeneralCategory} \n                    labelId=\"gen-category-label\"\n                    value={fbGeneralCategory || ''}\n                    onChange={(event:any) => {\n                      setValidGeneralCategory(true)\n                      changeGeneralCategory(event.target.value)\n                    }}\n                  >\n                    {generalCategoryNames.map((cat:any, index:number) => <MenuItem key={index} value={cat}>{cat}</MenuItem>)}\n                  </Select>\n                </FormControl>\n              </Grid>\n            </Grid>\n            <Grid item xs>\n              <TextField \n                helperText=\"\" \n                variant=\"standard\" \n                fullWidth \n                required \n                multiline \n                rowsMax=\"4\" \n                label=\"Description\" \n                id=\"description\" \n                type=\"text\"\n                error={!validDescription} \n                onChange={setSimpleField(setFbDescription, () => setValidDescription(true))} \n                value={fbDescription}/>\n            </Grid>\n            <Grid item xs>\n              Variables\n            </Grid>\n            <Grid container item xs>\n              <Grid className={classes.box} spacing={1} item container direction=\"row\">\n                <Grid item xs={6}>\n                  <VariableList onVariableEdition={onInputVariableEdition} onVariableRemoval={onInputVariableRemoval} setVariables={setFbInputVariables} inOutType={InOutType.in} title=\"Input\" variables={fbInputVariables} />\n                </Grid>\n                <Grid item xs={6}>\n                  <VariableList onVariableEdition={onOutputVariableEdition} onVariableRemoval={onOutputVariableRemoval} setVariables={setFbOutputVariables} inOutType={InOutType.out} title=\"Output\" variables={fbOutputVariables} />\n                </Grid>\n              </Grid>\n            </Grid>\n            <Grid item xs>\n              Events\n            </Grid>\n            <Grid container item xs>\n              <Grid className={classes.box} spacing={1} item container direction=\"row\">\n                <Grid item xs={6}>\n                  <EventList setEvent={setInputEvent} removeEvent={removeInputEvent} addNewEvent={addNewInputEvent} setEvents={setFbInputEvents} newEvent={newInputEvent} setNewEvent={setNewInputEvent} variables={fbInputVariables} inOutType={InOutType.in} title=\"Input\" events={fbInputEvents} />\n                </Grid>\n                <Grid item xs={6}>\n                  <EventList setEvent={setOutputEvent} removeEvent={removeOutputEvent} addNewEvent={addNewOutputEvent} setEvents={setFbOutputEvents} newEvent={newOutputEvent} setNewEvent={setNewOutputEvent} variables={fbOutputVariables} inOutType={InOutType.out} title=\"Output\" events={fbOutputEvents} />\n                </Grid>\n              </Grid>\n            </Grid>\n            <Grid item xs>\n              Dependencies\n            </Grid>\n            <Grid container xs item>\n              <Grid item container className={classes.box} alignItems=\"center\" justify=\"space-between\">\n                <Grid item container direction=\"row\" spacing={1} alignItems=\"flex-end\">\n                  <Grid item xs={6}>\n                    <TextField\n                        onChange={onChangeCurrentDependency} \n                        value={currentDependency}\n                        helperText=\"\"\n                        fullWidth \n                        label=\"New Dependency\" \n                        id=\"fb-new-dependency\" \n                        type=\"text\" />\n                  </Grid>\n                  <Grid item>\n                    <Button onClick={addDependency} className={classes.varEvButton} size=\"small\" variant=\"contained\">+</Button>\n                  </Grid>\n                </Grid>\n                <Grid container className={`${classes.box} ${classes.dependenciesBox}`} item>\n                  {fbExternalDependencies.length ?\n                    fbExternalDependencies.map((ed: ExternalDependency, index: number) => (\n                      <Chip key={index} className={classes.dependency} label={ed.edName} onDelete={deleteDependency(ed)} />\n                    )) : 'No Dependencies'\n                  }\n                </Grid>\n              </Grid>\n            </Grid>\n            <Grid item xs container direction=\"row\" justify=\"space-between\" alignItems=\"center\"> \n              <Grid item xs={6}>\n                  <input onChange={changeImplFile} value=\"\" required accept=\".py\" type=\"file\" id=\"button-file\" hidden />\n                  <label htmlFor=\"button-file\">\n                    <TextField\n                      className={classes.tfFile}\n                      label=\"Implementation File\"\n                      required={!props.byPassFields?.fbImplFile}\n                      error={!validFile}\n                      disabled={true}\n                      value={fbImplFile.name} \n                      InputProps={{\n                        startAdornment: (\n                          <Box pb={1} mr={1}>\n                            <Button variant=\"outlined\" component=\"span\">\n                              <UploadIcon className={classes.icon} />\n                            </Button>\n                          </Box> \n                        )\n                      }} />\n                  </label>\n              </Grid>\n              <Grid item xs={6} container direction=\"row\" spacing={2} alignItems=\"center\" justify=\"flex-end\">\n                <Grid item>\n                    <Button onClick={onCancel} color=\"secondary\" variant=\"contained\"><Clear/>{cancelLabel}</Button>\n                </Grid>\n                <Grid>\n                  <Button onClick={confirmButtonAction} color=\"primary\" variant=\"contained\"><Done/>{confirmLabel}</Button>\n                </Grid>\n              </Grid>\n            </Grid>\n            \n          </Grid>\n        </>\n      )\n}"]},"metadata":{},"sourceType":"module"}