{"ast":null,"code":"var _jsxFileName = \"/media/maria/96ae9a87-ebe3-48cb-a2c1-fae5fe76b9e7/maria/Marketplace-JurassicPark/backend/web/src/components/SmartComponents/List/List.tsx\",\n    _s = $RefreshSig$();\n\nimport React, { useState } from 'react';\nimport { Navigator } from '../../templates/Navigator/Navigator';\nimport { LazyComponent } from '../../templates/LazyComponent/LazyComponent';\nimport { JPTable } from '../../templates/Table/JPTable';\nimport { useMountEffect } from '../../../utils/main';\nimport { useSmartComponentStyles } from '../style';\nimport { Box, Button } from '@material-ui/core';\nimport { Redirect } from 'react-router-dom';\nimport { Visibility } from '@material-ui/icons';\nimport { SocketConnection, SOCKET_EVENT } from '../../../services/socket/socket';\nimport { ConfirmActionStateLabel, ConfirmAction } from '../../templates/ConfirmAction/ConfirmAction';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport const SmartComponentList = () => {\n  _s();\n\n  const classes = useSmartComponentStyles();\n  const socket = new SocketConnection(SocketConnection.getSmartComponentsNamespace());\n  const [error, setError] = useState('');\n  const [fetching, setFetching] = useState(true);\n  const [smartComponents, setSmartComponents] = useState([]);\n  const [redirectToDetail, setRedirectToDetail] = useState(-1);\n  const indexes = [{\n    label: 'Name',\n    key: 'scName'\n  }, {\n    label: 'Address',\n    key: 'scAddress'\n  }, {\n    label: 'Port',\n    key: 'scPort'\n  }, {\n    label: 'Type',\n    key: 'scType'\n  }, {\n    label: 'CPU %',\n    key: 'cpuPercent'\n  }, {\n    label: 'MEM %',\n    key: 'memPercentage'\n  }, {\n    label: 'State',\n    key: 'scState'\n  }, {\n    label: '',\n    key: 'state'\n  }];\n\n  const onDisconnect = () => {\n    setError(\"Server error\");\n    setFetching(false);\n    setSmartComponents([]);\n  };\n\n  const onInitialData = data => {\n    updateSmartObjects(data.result);\n    setFetching(false);\n  };\n\n  useMountEffect(() => {\n    setTimeout(() => {\n      socket.connect(() => {}, onDisconnect, onInitialData);\n      socket.addListener(SOCKET_EVENT.UPDATED_SC_EVENT, data => updateSmartComponent(data.sc));\n    }, 0);\n  }, () => socket === null || socket === void 0 ? void 0 : socket.disconnect());\n\n  const updateSmartObjects = scs => setSmartComponents(getComponentsWithStateData(scs));\n\n  const updateSmartComponent = sc => {\n    console.log('entrei aqui2');\n    console.log(scs.scId);\n    setSmartComponents(prevComponents => {\n      let newSc = true;\n      const newComponents = getComponentsWithStateData(prevComponents.map(oSc => {\n        if (oSc.scId === sc.scId) {\n          newSc = false;\n          return sc;\n        }\n\n        return oSc;\n      }));\n      if (newSc) return [...prevComponents, addStateAndDetialData(sc)];\n      return newComponents;\n    });\n  };\n\n  const getComponentsWithStateData = scs => {\n    return scs.map(sc => addStateAndDetialData(sc));\n  };\n\n  const addStateAndDetialData = sc => {\n    console.log('entrei aqui 1');\n    console.log(sc.scId);\n    return { ...sc,\n      state: {\n        key: sc.scState,\n        data: /*#__PURE__*/_jsxDEV(Box, {\n          className: `${classes.onLineState} ${sc.scState === 'connected' ? classes.onLineStateOn : classes.onLineStateOff}`\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 115,\n          columnNumber: 27\n        }, this)\n      },\n      detail: {\n        key: 'detail',\n        data: /*#__PURE__*/_jsxDEV(Button, {\n          variant: \"text\",\n          size: \"small\",\n          onClick: redirectToDetailAction(sc.scId),\n          children: /*#__PURE__*/_jsxDEV(Visibility, {\n            fontSize: \"small\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 119,\n            columnNumber: 105\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 119,\n          columnNumber: 27\n        }, this)\n      }\n    };\n  };\n\n  const redirectToDetailAction = id => () => setRedirectToDetail(id);\n\n  const confirmActionStates = {\n    error: {\n      label: error,\n      state: ConfirmActionStateLabel.error,\n      positiveLabel: 'Ok'\n    }\n  };\n  const confirmActionProps = {\n    title: 'Loading Smart-Component',\n    states: confirmActionStates,\n    currentState: confirmActionStates.error,\n    onCancel: () => setError('')\n  };\n  if (redirectToDetail !== -1) return /*#__PURE__*/_jsxDEV(Redirect, {\n    to: `/smart-component/${redirectToDetail}`,\n    push: true\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 145,\n    columnNumber: 16\n  }, this);\n  return /*#__PURE__*/_jsxDEV(Navigator, {\n    title: \"Smart Components\",\n    children: /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: /*#__PURE__*/_jsxDEV(LazyComponent, {\n        loaded: !fetching,\n        children: error !== '' ? /*#__PURE__*/_jsxDEV(ConfirmAction, { ...confirmActionProps\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 152,\n          columnNumber: 27\n        }, this) : /*#__PURE__*/_jsxDEV(JPTable, {\n          data: smartComponents,\n          updateData: updateSmartObjects,\n          indexes: indexes,\n          sortedkey: \"scName\",\n          tName: \"Function Block\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 153,\n          columnNumber: 27\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 150,\n        columnNumber: 17\n      }, this)\n    }, void 0, false)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 148,\n    columnNumber: 9\n  }, this);\n};\n\n_s(SmartComponentList, \"ZswiyOK3c8hGIf4H8A3zqlbWKDo=\", false, function () {\n  return [useSmartComponentStyles, useMountEffect];\n});\n\n_c = SmartComponentList;\n\nvar _c;\n\n$RefreshReg$(_c, \"SmartComponentList\");","map":{"version":3,"sources":["/media/maria/96ae9a87-ebe3-48cb-a2c1-fae5fe76b9e7/maria/Marketplace-JurassicPark/backend/web/src/components/SmartComponents/List/List.tsx"],"names":["React","useState","Navigator","LazyComponent","JPTable","useMountEffect","useSmartComponentStyles","Box","Button","Redirect","Visibility","SocketConnection","SOCKET_EVENT","ConfirmActionStateLabel","ConfirmAction","SmartComponentList","classes","socket","getSmartComponentsNamespace","error","setError","fetching","setFetching","smartComponents","setSmartComponents","redirectToDetail","setRedirectToDetail","indexes","label","key","onDisconnect","onInitialData","data","updateSmartObjects","result","setTimeout","connect","addListener","UPDATED_SC_EVENT","updateSmartComponent","sc","disconnect","scs","getComponentsWithStateData","console","log","scId","prevComponents","newSc","newComponents","map","oSc","addStateAndDetialData","state","scState","onLineState","onLineStateOn","onLineStateOff","detail","redirectToDetailAction","id","confirmActionStates","positiveLabel","confirmActionProps","title","states","currentState","onCancel"],"mappings":"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","sourcesContent":["import React, { useState } from 'react'\nimport { Navigator } from '../../templates/Navigator/Navigator'\nimport { LazyComponent } from '../../templates/LazyComponent/LazyComponent'\nimport { JPTable } from '../../templates/Table/JPTable'\nimport { SmartComponent } from '../../../model/index'\nimport { useMountEffect } from '../../../utils/main'\nimport { useSmartComponentStyles } from '../style'\nimport { Box, Button } from '@material-ui/core'\nimport { Redirect } from 'react-router-dom'\nimport {Visibility} from '@material-ui/icons'\nimport { SocketConnection, SOCKET_EVENT } from '../../../services/socket/socket'\nimport { ConfirmActionStateLabel, ConfirmActionProps, ConfirmAction } from '../../templates/ConfirmAction/ConfirmAction'\n\ninterface SmartComponentWithDataState extends SmartComponent {\n    state: {\n        key:string | undefined\n        data: React.ReactElement\n    },\n    detail: {\n        key: 'detail'\n        data: React.ReactElement\n    }\n}\n\n\nexport const SmartComponentList = () : React.ReactElement => {\n    \n    const classes = useSmartComponentStyles()\n    \n    const socket : SocketConnection = new SocketConnection(SocketConnection.getSmartComponentsNamespace())\n    \n    const [error,setError] : [string,Function] = useState('')\n    const [fetching,setFetching] : [boolean, Function] = useState(true)\n\n    const [smartComponents,setSmartComponents] : [SmartComponentWithDataState[],Function] = useState([])\n\n    const [redirectToDetail,setRedirectToDetail] : [number, Function] = useState(-1)\n\n    const indexes = [\n        {label: 'Name', key: 'scName'},\n        {label: 'Address', key: 'scAddress'},\n        {label: 'Port', key: 'scPort'},\n        {label: 'Type', key: 'scType'},\n        {label: 'CPU %', key: 'cpuPercent'},\n        {label: 'MEM %', key: 'memPercentage'},\n        {label: 'State', key: 'scState'},\n        {label: '', key: 'state'},\n    ]\n\n    const onDisconnect = () => {\n        setError(\"Server error\")\n        setFetching(false)\n        setSmartComponents([])\n    }\n\n    const onInitialData = (data:any) => {\n        updateSmartObjects(data.result)\n        setFetching(false)\n    } \n\n    useMountEffect(() => {\n\n        setTimeout(() => {\n\n            socket.connect(() => {}, onDisconnect, onInitialData)\n            socket.addListener(SOCKET_EVENT.UPDATED_SC_EVENT, (data) => updateSmartComponent(data.sc))\n\n        }, 0)\n\n    }, () => socket?.disconnect())\n\n\n    const updateSmartObjects = (scs:SmartComponent[]) => setSmartComponents(getComponentsWithStateData(scs))\n\n    const updateSmartComponent = (sc: SmartComponent) => {\n        console.log('entrei aqui2')\n        console.log(scs.scId)\n\n        setSmartComponents((prevComponents: SmartComponentWithDataState[]) => {\n\n            let newSc = true\n\n            const newComponents = getComponentsWithStateData(prevComponents.map((oSc:SmartComponentWithDataState) => {\n\n                if(oSc.scId === sc.scId) {\n                    newSc = false\n                    return sc\n                }\n                return oSc\n\n            }))\n\n            if(newSc)\n                return [...prevComponents, addStateAndDetialData(sc)]\n            return newComponents\n\n        })\n    }\n\n    const getComponentsWithStateData = (scs: SmartComponent[]) : SmartComponentWithDataState[] => {\n\n        return scs.map((sc:SmartComponent) => addStateAndDetialData(sc))\n\n    }\n    \n    const addStateAndDetialData = (sc: SmartComponent) : SmartComponentWithDataState => {\n\n        console.log('entrei aqui 1')\n        console.log(sc.scId)\n        return (\n            {\n                ...sc, \n                state:  {\n                    key: sc.scState,\n                    data: <Box className= {`${classes.onLineState} ${sc.scState === 'connected' ? classes.onLineStateOn : classes.onLineStateOff}`}/>\n                },\n                detail: {\n                    key: 'detail',\n                    data: <Button variant=\"text\" size=\"small\" onClick={redirectToDetailAction(sc.scId)}><Visibility fontSize=\"small\"/></Button> \n                }\n            }\n        )\n    }\n\n    const redirectToDetailAction = (id?: number) => () => setRedirectToDetail(id)\n\n    const confirmActionStates = {\n\n        error: {\n          label: error,\n          state: ConfirmActionStateLabel.error,\n          positiveLabel: 'Ok'\n        },\n    }\n    \n    const confirmActionProps : ConfirmActionProps = {\n\n        title: 'Loading Smart-Component',\n        states: confirmActionStates,\n        currentState: confirmActionStates.error,\n        onCancel: () => setError(''),      \n    }\n\n    if(redirectToDetail !== -1)\n        return <Redirect to={`/smart-component/${redirectToDetail}`} push={true}/>\n\n    return (\n        <Navigator title=\"Smart Components\">\n            <>\n                <LazyComponent loaded={!fetching}>\n                    {error !== ''\n                        ? <ConfirmAction {...confirmActionProps}/> \n                        : <JPTable \n                            data={smartComponents} \n                            updateData={updateSmartObjects} \n                            indexes={indexes}\n                            sortedkey='scName' \n                            tName='Function Block'\n                        />\n                    }\n                </LazyComponent>\n            </>\n        </Navigator>\n    )\n\n}"]},"metadata":{},"sourceType":"module"}