{"ast":null,"code":"var _jsxFileName = \"/media/maria/96ae9a87-ebe3-48cb-a2c1-fae5fe76b9e7/maria/Marketplace-JurassicPark/backend/web/src/components/DigitalTwin/DigitalTwinForm.tsx\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useCallback } from 'react';\nimport { TextField, Grid, Button } from '@material-ui/core';\nimport { useFunctionBlockStyles } from '../FunctionBlocks/FunctionBlock/style';\nimport { Done, Clear } from '@material-ui/icons';\nimport { ConfirmActionStateLabel, ConfirmAction } from '../templates/ConfirmAction/ConfirmAction';\nimport { getOrDownloadSmartComponents } from '../../utils/smartComponents';\nimport { useMountEffect } from '../../utils/main';\nimport { SmartComponentList } from './SmartComponent';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nconst updateEventOnRemoveSmartComponent = (events, smartComponentToRemove) => {\n  const newEvents = [...events];\n  newEvents.forEach(event => {\n    event.scName = event.scName.filter(ev => ev.scName !== smartComponentToRemove.scName);\n  });\n  return newEvents;\n};\n\nconst updateEventOnUpdateSmartComponent = (events, oldVariable, variableEdited) => {\n  const newEvents = [...events];\n  newEvents.forEach(event => {\n    event.eventVariables = event.eventVariables.map(ev => {\n      if (ev.evVariableName === oldVariable.variableName) return {\n        evVariableName: variableEdited.variableName,\n        evEventName: event.eventName\n      };else return ev;\n    });\n  });\n  return newEvents;\n};\n\nexport const DigitalTwinForm = props => {\n  _s();\n\n  var _props$confirmDialog$, _props$confirmDialog$2, _props$confirmDialog$3;\n\n  /**styles */\n  const classes = useFunctionBlockStyles();\n  /**Digital Twin*/\n\n  const {\n    dtName,\n    setDtName\n  } = props.dtName;\n  const [validDtName, setValidDtName] = useState(true);\n  const onChangeDtName = useCallback(event => {\n    setDtName(event.target.value.trim());\n    setValidDtName(true);\n  }, [setDtName]);\n  /* Buttons */\n\n  const onCancel = props.cancel.action;\n  const cancelLabel = props.cancel.label;\n  const confirmLabel = props.confirmDialog.buttonTitle;\n  /* Confirmation */\n\n  const [confirm, setConfirm] = useState(false);\n\n  const validateFields = () => {\n    const cValidDtName = dtName.trim() !== '';\n    if (!cValidDtName) setValidDtName(cValidDtName);\n    return cValidDtName;\n  };\n\n  const confirmButtonAction = () => {\n    if (validateFields()) setConfirm(true);\n  };\n\n  const confirmActionStates = {\n    start: {\n      label: (_props$confirmDialog$ = props.confirmDialog.start) === null || _props$confirmDialog$ === void 0 ? void 0 : _props$confirmDialog$.label,\n      positiveLabel: (_props$confirmDialog$2 = props.confirmDialog.start) === null || _props$confirmDialog$2 === void 0 ? void 0 : _props$confirmDialog$2.positiveLabel,\n      negativeLabel: (_props$confirmDialog$3 = props.confirmDialog.start) === null || _props$confirmDialog$3 === void 0 ? void 0 : _props$confirmDialog$3.negativeLabel,\n      state: ConfirmActionStateLabel.start\n    },\n    executing: {\n      label: '',\n      state: ConfirmActionStateLabel.executing\n    },\n    success: {\n      label: props.confirmDialog.success.label,\n      state: ConfirmActionStateLabel.success,\n      positiveLabel: props.confirmDialog.success.positiveLabel\n    },\n    error: {\n      label: props.confirmDialog.error.label,\n      state: ConfirmActionStateLabel.error,\n      positiveLabel: props.confirmDialog.success.positiveLabel\n    }\n  };\n  const confirmActionProps = {\n    title: props.confirmDialog.title,\n    states: confirmActionStates,\n    currentState: confirmActionStates.executing,\n    onCancel: () => setConfirm(false),\n    onError: () => setConfirm(false),\n    onSuccess: props.confirmDialog.onSuccess,\n    action: props.confirmDialog.action\n  }; // Recuperar diretamente da comunicação OPC-UA os smart_components disponíveis (SmartComponent)\n\n  useMountEffect(() => {\n    setTimeout(() => {\n      setFetching(true);\n      getOrDownloadSmartComponents(smartComponents).then(result => updateSmartComponents(result)).catch(e => setError(e.msg)).finally(() => setFetching(false));\n    }, 0);\n  }); // Associar um SmartComponent pelo frontend\n  // const [fetching,setFetching] = useState(true)\n  // const {data:smartComponents, dispatchAction:dispatchSmartComponentActions} = useStore('smartComponents')\n  // const updateSmartComponents = (scs: SmartComponent[]) => dispatchSmartComponentActions(SmartComponentActions.updateSmartComponent(scs))\n  // const [error,setError] = useState('')\n\n  const [smartComponentChoice, setSmartComponentChoice] = useState('');\n  const [smartComponentIdChoice, setSmartComponentIdChoice] = useState(0); // const handleSmartComponentChoice = (event: React.ChangeEvent<{ value: unknown }>) => {\n  //   setSmartComponentChoice(event.target.value as string);\n  //   props.associatedSc.setAssociatedSc(event.target.value as string)\n  //   let i = 0;\n  //   while(i < smartComponents.length)\n  //   {\n  //       if( smartComponents[i].scName === (event.target.value as string))\n  //       {\n  //           setSmartComponentIdChoice(smartComponents[i].scId)\n  //       }\n  //       i++;\n  //   }\n  // };\n\n  const onSmartComponentRemoval = useCallback(smartComponentToRemove => {\n    setSmartComponent(prevEvents => updateEventOnRemoveSmartComponent(prevEvents, smartComponentToRemove));\n    setSmartComponent(prevEvent => updateEventOnRemoveSmartComponent([prevEvent], smartComponentToRemove)[0]);\n  }, [setSmartComponent]);\n  const onSmartComponentEdition = useCallback((oldSmartComponent, newSmartComponent) => {\n    setSmartComponent(prevEvents => updateEventOnUpdateSmartComponent(prevEvents, oldSmartComponent, newSmartComponent));\n    setSmartComponent(prevNewEvent => updateEventOnUpdateSmartComponent([prevNewEvent], oldSmartComponent, newSmartComponent)[0]);\n  }, [setSmartComponent]);\n  const {\n    smartComponent,\n    setSmartComponent\n  } = props.associatedSc;\n  return /*#__PURE__*/_jsxDEV(Grid, {\n    className: classes.box,\n    spacing: 2,\n    container: true,\n    direction: \"column\",\n    component: \"form\",\n    children: /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [\" \", confirm ? /*#__PURE__*/_jsxDEV(ConfirmAction, { ...confirmActionProps\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 222,\n        columnNumber: 23\n      }, this) : null, /*#__PURE__*/_jsxDEV(Grid, {\n        spacing: 1,\n        justify: \"space-between\",\n        item: true,\n        xs: true,\n        container: true,\n        direction: \"row\",\n        children: /*#__PURE__*/_jsxDEV(Grid, {\n          item: true,\n          xs: 6,\n          children: /*#__PURE__*/_jsxDEV(TextField, {\n            onChange: onChangeDtName,\n            value: dtName,\n            helperText: \"\",\n            error: !validDtName,\n            fullWidth: true,\n            required: true,\n            label: \"Insert New Digital Twin Name\",\n            id: \"dt-name\",\n            type: \"text\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 225,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 224,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 223,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(Grid, {\n        container: true,\n        item: true,\n        xs: true,\n        children: /*#__PURE__*/_jsxDEV(Grid, {\n          className: classes.box,\n          spacing: 1,\n          item: true,\n          container: true,\n          direction: \"row\",\n          children: /*#__PURE__*/_jsxDEV(Grid, {\n            item: true,\n            xs: 6,\n            children: /*#__PURE__*/_jsxDEV(SmartComponentList, {\n              onSmartComponentEdition: onSmartComponentEdition,\n              onSmartComponentRemoval: onSmartComponentRemoval,\n              setSmartComponents: setSmartComponent,\n              title: \"Smart Components\",\n              smartComponents: smartComponent\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 239,\n              columnNumber: 19\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 238,\n            columnNumber: 17\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 237,\n          columnNumber: 15\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 236,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(Grid, {\n        item: true,\n        xs: true,\n        container: true,\n        direction: \"row\",\n        justify: \"space-between\",\n        alignItems: \"center\",\n        children: /*#__PURE__*/_jsxDEV(Grid, {\n          item: true,\n          xs: 6,\n          container: true,\n          direction: \"row\",\n          spacing: 2,\n          alignItems: \"center\",\n          justify: \"flex-end\",\n          children: [/*#__PURE__*/_jsxDEV(Grid, {\n            item: true,\n            children: /*#__PURE__*/_jsxDEV(Button, {\n              onClick: onCancel,\n              color: \"secondary\",\n              variant: \"contained\",\n              children: [/*#__PURE__*/_jsxDEV(Clear, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 275,\n                columnNumber: 84\n              }, this), cancelLabel]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 275,\n              columnNumber: 19\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 274,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(Grid, {\n            children: /*#__PURE__*/_jsxDEV(Button, {\n              onClick: confirmButtonAction,\n              color: \"primary\",\n              variant: \"contained\",\n              children: [/*#__PURE__*/_jsxDEV(Done, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 278,\n                columnNumber: 91\n              }, this), confirmLabel]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 278,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 277,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 273,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 272,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 221,\n    columnNumber: 7\n  }, this);\n};\n\n_s(DigitalTwinForm, \"WtuvkX+eZELcfEAzXpuADeE21LM=\", false, function () {\n  return [useFunctionBlockStyles, useMountEffect];\n});\n\n_c = DigitalTwinForm;\n\nvar _c;\n\n$RefreshReg$(_c, \"DigitalTwinForm\");","map":{"version":3,"sources":["/media/maria/96ae9a87-ebe3-48cb-a2c1-fae5fe76b9e7/maria/Marketplace-JurassicPark/backend/web/src/components/DigitalTwin/DigitalTwinForm.tsx"],"names":["React","useState","useCallback","TextField","Grid","Button","useFunctionBlockStyles","Done","Clear","ConfirmActionStateLabel","ConfirmAction","getOrDownloadSmartComponents","useMountEffect","SmartComponentList","updateEventOnRemoveSmartComponent","events","smartComponentToRemove","newEvents","forEach","event","scName","filter","ev","updateEventOnUpdateSmartComponent","oldVariable","variableEdited","eventVariables","map","evVariableName","variableName","evEventName","eventName","DigitalTwinForm","props","classes","dtName","setDtName","validDtName","setValidDtName","onChangeDtName","target","value","trim","onCancel","cancel","action","cancelLabel","label","confirmLabel","confirmDialog","buttonTitle","confirm","setConfirm","validateFields","cValidDtName","confirmButtonAction","confirmActionStates","start","positiveLabel","negativeLabel","state","executing","success","error","confirmActionProps","title","states","currentState","onError","onSuccess","setTimeout","setFetching","smartComponents","then","result","updateSmartComponents","catch","e","setError","msg","finally","smartComponentChoice","setSmartComponentChoice","smartComponentIdChoice","setSmartComponentIdChoice","onSmartComponentRemoval","setSmartComponent","prevEvents","prevEvent","onSmartComponentEdition","oldSmartComponent","newSmartComponent","prevNewEvent","smartComponent","associatedSc","box"],"mappings":";;;AAAA,OAAOA,KAAP,IAAgBC,QAAhB,EAA0BC,WAA1B,QAAwD,OAAxD;AACA,SAASC,SAAT,EAAoBC,IAApB,EAA0BC,MAA1B,QAAmF,mBAAnF;AAEA,SAASC,sBAAT,QAAuC,uCAAvC;AACA,SAASC,IAAT,EAAeC,KAAf,QAA4B,oBAA5B;AACA,SAA6BC,uBAA7B,EAA2EC,aAA3E,QAAgG,0CAAhG;AAGA,SAASC,4BAAT,QAA6C,6BAA7C;AACA,SAASC,cAAT,QAA+B,kBAA/B;AAEA,SAASC,kBAAT,QAAmC,kBAAnC;;;;AAGA,MAAMC,iCAAiC,GAAG,CAACC,MAAD,EAAiBC,sBAAjB,KAAsE;AAE9G,QAAMC,SAAmB,GAAG,CAAC,GAAGF,MAAJ,CAA5B;AACAE,EAAAA,SAAS,CAACC,OAAV,CAAmBC,KAAD,IAA2B;AAEzCA,IAAAA,KAAK,CAACC,MAAN,GAAeD,KAAK,CAACC,MAAN,CAAaC,MAAb,CAAqBC,EAAD,IAAwBA,EAAE,CAACF,MAAH,KAAcJ,sBAAsB,CAACI,MAAjF,CAAf;AAEH,GAJD;AAMA,SAAOH,SAAP;AAED,CAXD;;AAaA,MAAMM,iCAAiC,GAAG,CAACR,MAAD,EAAiBS,WAAjB,EAAsCC,cAAtC,KAA4E;AAEpH,QAAMR,SAAmB,GAAG,CAAC,GAAGF,MAAJ,CAA5B;AACAE,EAAAA,SAAS,CAACC,OAAV,CAAmBC,KAAD,IAAkB;AAElCA,IAAAA,KAAK,CAACO,cAAN,GAAuBP,KAAK,CAACO,cAAN,CAAqBC,GAArB,CAA0BL,EAAD,IAAuB;AACrE,UAAGA,EAAE,CAACM,cAAH,KAAsBJ,WAAW,CAACK,YAArC,EACE,OAAO;AACLD,QAAAA,cAAc,EAAEH,cAAc,CAACI,YAD1B;AAELC,QAAAA,WAAW,EAAEX,KAAK,CAACY;AAFd,OAAP,CADF,KAME,OAAOT,EAAP;AACH,KARsB,CAAvB;AAUD,GAZD;AAcA,SAAOL,SAAP;AAED,CAnBD;;AA4DA,OAAO,MAAMe,eAAe,GAAIC,KAAD,IAAiC;AAAA;;AAAA;;AAE5D;AACA,QAAMC,OAAO,GAAG5B,sBAAsB,EAAtC;AAEA;;AACA,QAAM;AAAC6B,IAAAA,MAAD;AAASC,IAAAA;AAAT,MAAsBH,KAAK,CAACE,MAAlC;AACA,QAAM,CAACE,WAAD,EAAcC,cAAd,IAAgCrC,QAAQ,CAAC,IAAD,CAA9C;AACA,QAAMsC,cAAc,GAAGrC,WAAW,CAAEiB,KAAD,IAAe;AAE9CiB,IAAAA,SAAS,CAACjB,KAAK,CAACqB,MAAN,CAAaC,KAAb,CAAmBC,IAAnB,EAAD,CAAT;AACAJ,IAAAA,cAAc,CAAC,IAAD,CAAd;AAED,GAL+B,EAK9B,CAACF,SAAD,CAL8B,CAAlC;AAOA;;AAEA,QAAMO,QAAQ,GAAGV,KAAK,CAACW,MAAN,CAAaC,MAA9B;AACA,QAAMC,WAAW,GAAGb,KAAK,CAACW,MAAN,CAAaG,KAAjC;AAEA,QAAMC,YAAY,GAAGf,KAAK,CAACgB,aAAN,CAAoBC,WAAzC;AAEA;;AAEA,QAAM,CAACC,OAAD,EAAUC,UAAV,IAA8CnD,QAAQ,CAAC,KAAD,CAA5D;;AAEA,QAAMoD,cAAc,GAAG,MAAgB;AAEnC,UAAMC,YAAY,GAAGnB,MAAM,CAACO,IAAP,OAAkB,EAAvC;AAEA,QAAG,CAACY,YAAJ,EAAkBhB,cAAc,CAACgB,YAAD,CAAd;AAElB,WAAOA,YAAP;AAEH,GARD;;AAUA,QAAMC,mBAAmB,GAAG,MAAM;AAE9B,QAAGF,cAAc,EAAjB,EACED,UAAU,CAAC,IAAD,CAAV;AACL,GAJD;;AAMA,QAAMI,mBAAmB,GAAG;AACxBC,IAAAA,KAAK,EAAE;AACHV,MAAAA,KAAK,2BAAEd,KAAK,CAACgB,aAAN,CAAoBQ,KAAtB,0DAAE,sBAA2BV,KAD/B;AAEHW,MAAAA,aAAa,4BAAEzB,KAAK,CAACgB,aAAN,CAAoBQ,KAAtB,2DAAE,uBAA2BC,aAFvC;AAGHC,MAAAA,aAAa,4BAAE1B,KAAK,CAACgB,aAAN,CAAoBQ,KAAtB,2DAAE,uBAA2BE,aAHvC;AAIHC,MAAAA,KAAK,EAAEnD,uBAAuB,CAACgD;AAJ5B,KADiB;AAOxBI,IAAAA,SAAS,EAAE;AACTd,MAAAA,KAAK,EAAE,EADE;AAETa,MAAAA,KAAK,EAAEnD,uBAAuB,CAACoD;AAFtB,KAPa;AAWxBC,IAAAA,OAAO,EAAE;AACPf,MAAAA,KAAK,EAAEd,KAAK,CAACgB,aAAN,CAAoBa,OAApB,CAA4Bf,KAD5B;AAEPa,MAAAA,KAAK,EAAEnD,uBAAuB,CAACqD,OAFxB;AAGPJ,MAAAA,aAAa,EAAEzB,KAAK,CAACgB,aAAN,CAAoBa,OAApB,CAA4BJ;AAHpC,KAXe;AAgBxBK,IAAAA,KAAK,EAAE;AACLhB,MAAAA,KAAK,EAAEd,KAAK,CAACgB,aAAN,CAAoBc,KAApB,CAA0BhB,KAD5B;AAELa,MAAAA,KAAK,EAAEnD,uBAAuB,CAACsD,KAF1B;AAGLL,MAAAA,aAAa,EAAEzB,KAAK,CAACgB,aAAN,CAAoBa,OAApB,CAA4BJ;AAHtC;AAhBiB,GAA5B;AAuBA,QAAMM,kBAAuC,GAAG;AAE5CC,IAAAA,KAAK,EAAEhC,KAAK,CAACgB,aAAN,CAAoBgB,KAFiB;AAG5CC,IAAAA,MAAM,EAAEV,mBAHoC;AAI5CW,IAAAA,YAAY,EAAEX,mBAAmB,CAACK,SAJU;AAK5ClB,IAAAA,QAAQ,EAAE,MAAMS,UAAU,CAAC,KAAD,CALkB;AAM5CgB,IAAAA,OAAO,EAAE,MAAMhB,UAAU,CAAC,KAAD,CANmB;AAO5CiB,IAAAA,SAAS,EAAEpC,KAAK,CAACgB,aAAN,CAAoBoB,SAPa;AAQ5CxB,IAAAA,MAAM,EAACZ,KAAK,CAACgB,aAAN,CAAoBJ;AARiB,GAAhD,CAjE4D,CA6E5D;;AACAjC,EAAAA,cAAc,CAAC,MAAM;AAEnB0D,IAAAA,UAAU,CAAC,MAAM;AAEjBC,MAAAA,WAAW,CAAC,IAAD,CAAX;AACA5D,MAAAA,4BAA4B,CAAC6D,eAAD,CAA5B,CACKC,IADL,CACWC,MAAD,IAA8BC,qBAAqB,CAACD,MAAD,CAD7D,EAEKE,KAFL,CAEYC,CAAD,IAA4BC,QAAQ,CAACD,CAAC,CAACE,GAAH,CAF/C,EAGKC,OAHL,CAGa,MAAMT,WAAW,CAAC,KAAD,CAH9B;AAIC,KAPS,EAOP,CAPO,CAAV;AAQC,GAVW,CAAd,CA9E4D,CA0F5D;AAEA;AACA;AACA;AACA;;AAEA,QAAM,CAACU,oBAAD,EAAuBC,uBAAvB,IAAkDjF,QAAQ,CAAC,EAAD,CAAhE;AACA,QAAM,CAACkF,sBAAD,EAAyBC,yBAAzB,IAAsDnF,QAAQ,CAAC,CAAD,CAApE,CAlG4D,CAoG5D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAGF,QAAMoF,uBAAuB,GAAGnF,WAAW,CAAEc,sBAAD,IAA4C;AAEtFsE,IAAAA,iBAAiB,CAAEC,UAAD,IAAyBzE,iCAAiC,CAACyE,UAAD,EAAYvE,sBAAZ,CAA3D,CAAjB;AACAsE,IAAAA,iBAAiB,CAAEE,SAAD,IAAqB1E,iCAAiC,CAAC,CAAC0E,SAAD,CAAD,EAAaxE,sBAAb,CAAjC,CAAsE,CAAtE,CAAtB,CAAjB;AAED,GAL0C,EAKxC,CAACsE,iBAAD,CALwC,CAA3C;AAQA,QAAMG,uBAAuB,GAAGvF,WAAW,CAAC,CAACwF,iBAAD,EAAoCC,iBAApC,KAA0E;AAEpHL,IAAAA,iBAAiB,CAAEC,UAAD,IAAyBhE,iCAAiC,CAACgE,UAAD,EAAYG,iBAAZ,EAA8BC,iBAA9B,CAA3D,CAAjB;AACAL,IAAAA,iBAAiB,CAAEM,YAAD,IAAyBrE,iCAAiC,CAAC,CAACqE,YAAD,CAAD,EAAgBF,iBAAhB,EAAkCC,iBAAlC,CAAjC,CAAsF,CAAtF,CAA1B,CAAjB;AAED,GAL0C,EAKzC,CAACL,iBAAD,CALyC,CAA3C;AAOA,QAAM;AAACO,IAAAA,cAAD;AAAiBP,IAAAA;AAAjB,MAAsCrD,KAAK,CAAC6D,YAAlD;AAEE,sBACE,QAAC,IAAD;AAAM,IAAA,SAAS,EAAE5D,OAAO,CAAC6D,GAAzB;AAA8B,IAAA,OAAO,EAAE,CAAvC;AAA0C,IAAA,SAAS,MAAnD;AAAoD,IAAA,SAAS,EAAC,QAA9D;AAAuE,IAAA,SAAS,EAAC,MAAjF;AAAA,2BACE;AAAA,sBAAI5C,OAAO,gBAAG,QAAC,aAAD,OAAmBa;AAAnB;AAAA;AAAA;AAAA;AAAA,cAAH,GAA+C,IAA1D,eACE,QAAC,IAAD;AAAM,QAAA,OAAO,EAAE,CAAf;AAAkB,QAAA,OAAO,EAAC,eAA1B;AAA0C,QAAA,IAAI,MAA9C;AAA+C,QAAA,EAAE,MAAjD;AAAkD,QAAA,SAAS,MAA3D;AAA4D,QAAA,SAAS,EAAC,KAAtE;AAAA,+BACE,QAAC,IAAD;AAAM,UAAA,IAAI,MAAV;AAAW,UAAA,EAAE,EAAE,CAAf;AAAA,iCACE,QAAC,SAAD;AACE,YAAA,QAAQ,EAAEzB,cADZ;AAEE,YAAA,KAAK,EAAEJ,MAFT;AAGE,YAAA,UAAU,EAAC,EAHb;AAIE,YAAA,KAAK,EAAE,CAACE,WAJV;AAKE,YAAA,SAAS,MALX;AAKY,YAAA,QAAQ,MALpB;AAME,YAAA,KAAK,EAAC,8BANR;AAOE,YAAA,EAAE,EAAC,SAPL;AAQE,YAAA,IAAI,EAAC;AARP;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,cADF,eAcE,QAAC,IAAD;AAAM,QAAA,SAAS,MAAf;AAAgB,QAAA,IAAI,MAApB;AAAqB,QAAA,EAAE,MAAvB;AAAA,+BACI,QAAC,IAAD;AAAM,UAAA,SAAS,EAAEH,OAAO,CAAC6D,GAAzB;AAA8B,UAAA,OAAO,EAAE,CAAvC;AAA0C,UAAA,IAAI,MAA9C;AAA+C,UAAA,SAAS,MAAxD;AAAyD,UAAA,SAAS,EAAC,KAAnE;AAAA,iCACE,QAAC,IAAD;AAAM,YAAA,IAAI,MAAV;AAAW,YAAA,EAAE,EAAE,CAAf;AAAA,mCACE,QAAC,kBAAD;AAAoB,cAAA,uBAAuB,EAAEN,uBAA7C;AAAsE,cAAA,uBAAuB,EAAEJ,uBAA/F;AAAwH,cAAA,kBAAkB,EAAEC,iBAA5I;AAA+J,cAAA,KAAK,EAAC,kBAArK;AAAwL,cAAA,eAAe,EAAEO;AAAzM;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA;AADJ;AAAA;AAAA;AAAA;AAAA,cAdF,eAkDE,QAAC,IAAD;AAAM,QAAA,IAAI,MAAV;AAAW,QAAA,EAAE,MAAb;AAAc,QAAA,SAAS,MAAvB;AAAwB,QAAA,SAAS,EAAC,KAAlC;AAAwC,QAAA,OAAO,EAAC,eAAhD;AAAgE,QAAA,UAAU,EAAC,QAA3E;AAAA,+BACE,QAAC,IAAD;AAAM,UAAA,IAAI,MAAV;AAAW,UAAA,EAAE,EAAE,CAAf;AAAkB,UAAA,SAAS,MAA3B;AAA4B,UAAA,SAAS,EAAC,KAAtC;AAA4C,UAAA,OAAO,EAAE,CAArD;AAAwD,UAAA,UAAU,EAAC,QAAnE;AAA4E,UAAA,OAAO,EAAC,UAApF;AAAA,kCACE,QAAC,IAAD;AAAM,YAAA,IAAI,MAAV;AAAA,mCACI,QAAC,MAAD;AAAQ,cAAA,OAAO,EAAElD,QAAjB;AAA2B,cAAA,KAAK,EAAC,WAAjC;AAA6C,cAAA,OAAO,EAAC,WAArD;AAAA,sCAAiE,QAAC,KAAD;AAAA;AAAA;AAAA;AAAA,sBAAjE,EAA0EG,WAA1E;AAAA;AAAA;AAAA;AAAA;AAAA;AADJ;AAAA;AAAA;AAAA;AAAA,kBADF,eAIE,QAAC,IAAD;AAAA,mCACE,QAAC,MAAD;AAAQ,cAAA,OAAO,EAAES,mBAAjB;AAAsC,cAAA,KAAK,EAAC,SAA5C;AAAsD,cAAA,OAAO,EAAC,WAA9D;AAAA,sCAA0E,QAAC,IAAD;AAAA;AAAA;AAAA;AAAA,sBAA1E,EAAkFP,YAAlF;AAAA;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,kBAJF;AAAA;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,cAlDF;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,UADF;AAiEH,CArMM;;GAAMhB,e;UAGO1B,sB,EA2EhBM,c;;;KA9ESoB,e","sourcesContent":["import React, { useState, useCallback, useEffect } from 'react'\nimport { TextField, Grid, Button, InputLabel, Select, MenuItem, FormControl } from '@material-ui/core'\nimport { AssociatedSmartComponent, SmartComponent } from '../../model'\nimport { useFunctionBlockStyles } from '../FunctionBlocks/FunctionBlock/style'\nimport { Done, Clear } from '@material-ui/icons'\nimport { ConfirmActionProps, ConfirmActionStateLabel, ConfirmActionAction, ConfirmAction } from '../templates/ConfirmAction/ConfirmAction'\nimport { AssociatedSmartComponentActions, SmartComponentActions } from '../../redux/actions'\nimport { useStore } from '../templates/Store/Store'\nimport { getOrDownloadSmartComponents } from '../../utils/smartComponents'\nimport { useMountEffect } from '../../utils/main'\nimport { RequestResponseState } from '../../services/api/api'\nimport { SmartComponentList } from './SmartComponent'\n\n\nconst updateEventOnRemoveSmartComponent = (events:Event[], smartComponentToRemove:SmartComponent ) : Event[] => {\n\n  const newEvents : Event[] = [...events]\n  newEvents.forEach((event: SmartComponent) => {\n\n      event.scName = event.scName.filter((ev: SmartComponent) => ev.scName !== smartComponentToRemove.scName)\n\n  })\n\n  return newEvents\n\n}\n\nconst updateEventOnUpdateSmartComponent = (events:Event[], oldVariable:Variable,variableEdited:Variable) : Event[] => {\n\n  const newEvents : Event[] = [...events]\n  newEvents.forEach((event: Event) => {\n\n    event.eventVariables = event.eventVariables.map((ev: EventVariable) => {\n      if(ev.evVariableName === oldVariable.variableName)\n        return {\n          evVariableName: variableEdited.variableName,\n          evEventName: event.eventName\n        }\n      else\n        return ev\n    }) \n\n  })\n\n  return newEvents\n\n}\n\ninterface DigitalTwinFormProps {\n\n    dtName: {\n        dtName: string\n        setDtName: Function\n    },\n    associatedSc: {\n        associatedSc: SmartComponent[]\n        setAssociatedSc: Function\n    }\n    cancel: {\n        label: string\n        action: () => void\n    },\n    confirmDialog: {\n        buttonTitle: string\n        title: string\n        initialState: ConfirmActionStateLabel\n        action: ConfirmActionAction\n        onSuccess : () => void\n        start? : {\n            label: string\n            positiveLabel: string\n            negativeLabel: string\n        }\n        success: {\n            label:string\n            positiveLabel: string\n        }\n        error: {\n            label: string\n            positiveLabel: string\n        }\n    },\n    order?: number,\n    newSc?: boolean,\n    // addRemoveAssociatedSmartComponent: (associatedSc: AssociatedSmartComponent) => void,\n}\n\nexport const DigitalTwinForm = (props: DigitalTwinFormProps) => {\n\n    /**styles */\n    const classes = useFunctionBlockStyles()\n\n    /**Digital Twin*/\n    const {dtName, setDtName} = props.dtName\n    const [validDtName, setValidDtName] = useState(true)\n    const onChangeDtName = useCallback((event:any) => {\n\n        setDtName(event.target.value.trim())\n        setValidDtName(true)\n    \n      },[setDtName])\n\n    /* Buttons */\n\n    const onCancel = props.cancel.action\n    const cancelLabel = props.cancel.label\n\n    const confirmLabel = props.confirmDialog.buttonTitle\n\n    /* Confirmation */\n\n    const [confirm, setConfirm] : [boolean, Function] = useState(false)\n\n    const validateFields = () : boolean => {\n\n        const cValidDtName = dtName.trim() !== ''\n            \n        if(!cValidDtName) setValidDtName(cValidDtName)\n    \n        return cValidDtName \n    \n    }\n\n    const confirmButtonAction = () => {\n\n        if(validateFields())\n          setConfirm(true)\n    }\n\n    const confirmActionStates = {\n        start: {\n            label: props.confirmDialog.start?.label,\n            positiveLabel: props.confirmDialog.start?.positiveLabel,\n            negativeLabel: props.confirmDialog.start?.negativeLabel,\n            state: ConfirmActionStateLabel.start\n        },\n        executing: {\n          label: '',\n          state: ConfirmActionStateLabel.executing,\n        },\n        success: {\n          label: props.confirmDialog.success.label,\n          state: ConfirmActionStateLabel.success,\n          positiveLabel: props.confirmDialog.success.positiveLabel\n        },\n        error: {\n          label: props.confirmDialog.error.label,\n          state: ConfirmActionStateLabel.error,\n          positiveLabel: props.confirmDialog.success.positiveLabel\n        },\n      }\n    \n    const confirmActionProps : ConfirmActionProps = {\n\n        title: props.confirmDialog.title,\n        states: confirmActionStates,\n        currentState: confirmActionStates.executing,\n        onCancel: () => setConfirm(false),\n        onError: () => setConfirm(false),\n        onSuccess: props.confirmDialog.onSuccess,\n        action:props.confirmDialog.action,\n      \n    }\n\n    // Recuperar diretamente da comunicação OPC-UA os smart_components disponíveis (SmartComponent)\n    useMountEffect(() => {\n\n      setTimeout(() => {\n  \n      setFetching(true)\n      getOrDownloadSmartComponents(smartComponents)\n          .then((result: SmartComponent[]) => updateSmartComponents(result))\n          .catch((e:RequestResponseState) => setError(e.msg))\n          .finally(() => setFetching(false))\n      }, 0)\n      })\n  \n    // Associar um SmartComponent pelo frontend\n      \n    // const [fetching,setFetching] = useState(true)\n    // const {data:smartComponents, dispatchAction:dispatchSmartComponentActions} = useStore('smartComponents')\n    // const updateSmartComponents = (scs: SmartComponent[]) => dispatchSmartComponentActions(SmartComponentActions.updateSmartComponent(scs))\n    // const [error,setError] = useState('')\n\n    const [smartComponentChoice, setSmartComponentChoice] = useState('')\n    const [smartComponentIdChoice, setSmartComponentIdChoice] = useState(0)\n  \n    // const handleSmartComponentChoice = (event: React.ChangeEvent<{ value: unknown }>) => {\n    //   setSmartComponentChoice(event.target.value as string);\n    //   props.associatedSc.setAssociatedSc(event.target.value as string)\n    //   let i = 0;\n    //   while(i < smartComponents.length)\n    //   {\n    //       if( smartComponents[i].scName === (event.target.value as string))\n    //       {\n    //           setSmartComponentIdChoice(smartComponents[i].scId)\n    //       }\n    //       i++;\n    //   }\n    // };\n\n\n  const onSmartComponentRemoval = useCallback((smartComponentToRemove: SmartComponent) => {\n\n    setSmartComponent((prevEvents: Event[]) => updateEventOnRemoveSmartComponent(prevEvents,smartComponentToRemove))\n    setSmartComponent((prevEvent:Event) => updateEventOnRemoveSmartComponent([prevEvent],smartComponentToRemove)[0])\n\n  }, [setSmartComponent])\n\n\n  const onSmartComponentEdition = useCallback((oldSmartComponent: SmartComponent, newSmartComponent: SmartComponent) => {\n\n    setSmartComponent((prevEvents: Event[]) => updateEventOnUpdateSmartComponent(prevEvents,oldSmartComponent,newSmartComponent))\n    setSmartComponent((prevNewEvent: Event) => updateEventOnUpdateSmartComponent([prevNewEvent],oldSmartComponent,newSmartComponent)[0])\n  \n  },[setSmartComponent])\n\n  const {smartComponent, setSmartComponent} = props.associatedSc\n\n    return (\n      <Grid className={classes.box} spacing={2} container direction=\"column\" component=\"form\">\n        <> {confirm ? <ConfirmAction {...confirmActionProps} /> : null}\n          <Grid spacing={1} justify=\"space-between\" item xs container direction=\"row\">\n            <Grid item xs={6}>\n              <TextField\n                onChange={onChangeDtName} \n                value={dtName}\n                helperText=\"\"\n                error={!validDtName} \n                fullWidth required \n                label=\"Insert New Digital Twin Name\" \n                id=\"dt-name\" \n                type=\"text\" />\n            </Grid>\n          </Grid>\n          <Grid container item xs>\n              <Grid className={classes.box} spacing={1} item container direction=\"row\">\n                <Grid item xs={6}>\n                  <SmartComponentList onSmartComponentEdition={onSmartComponentEdition} onSmartComponentRemoval={onSmartComponentRemoval} setSmartComponents={setSmartComponent} title=\"Smart Components\" smartComponents={smartComponent} />\n                </Grid>\n              </Grid>\n          </Grid>\n          {/* <Grid item container direction=\"row\" justify=\"space-between\" alignItems=\"center\">\n            {props.order ?\n            <Grid item xs={1}>\n                {props.order}\n            </Grid>\n            : null\n            }\n            <Grid item xs={3}>\n              <FormControl fullWidth required>\n                <InputLabel id={`digital-twin-label-${smartComponents}`}>SmartComponent</InputLabel>\n                <Select\n                  labelId={`digital-twin-label-${smartComponents}`}\n                  value={smartComponentChoice}\n                  onChange={handleSmartComponentChoice}\n                >\n                   {(smartComponents || []).map((smartComponent: any) => {return <MenuItem key={smartComponent.scId} value={smartComponent.scName}>{smartComponent.scName}</MenuItem>})}\n                </Select>\n              </FormControl>\n            </Grid>\n            <Grid item xs={1}>\n              <Button \n                className={classes.varEvButton} \n                size=\"small\" \n                variant=\"contained\"\n                // onClick={action}\n              >\n              {props.newSc ? '+' : 'x' }</Button>\n            </Grid>\n          </Grid> */}\n          <Grid item xs container direction=\"row\" justify=\"space-between\" alignItems=\"center\"> \n            <Grid item xs={6} container direction=\"row\" spacing={2} alignItems=\"center\" justify=\"flex-end\">\n              <Grid item>\n                  <Button onClick={onCancel} color=\"secondary\" variant=\"contained\"><Clear/>{cancelLabel}</Button>\n              </Grid>\n              <Grid>\n                <Button onClick={confirmButtonAction} color=\"primary\" variant=\"contained\"><Done/>{confirmLabel}</Button>\n              </Grid>\n            </Grid>\n          </Grid>\n        </>\n    </Grid>\n  ) \n}"]},"metadata":{},"sourceType":"module"}