{"ast":null,"code":"var _jsxFileName = \"/media/maria/96ae9a87-ebe3-48cb-a2c1-fae5fe76b9e7/maria/Marketplace-JurassicPark/backend/web/src/components/DigitalTwin/NewDigitalTwin.tsx\",\n    _s = $RefreshSig$();\n\nimport React, { useState } from 'react';\nimport { Navigator } from '../templates/Navigator/Navigator';\nimport { Redirect } from 'react-router-dom';\nimport { routes } from '../../App';\nimport { ConfirmActionStateLabel } from '../templates/ConfirmAction/ConfirmAction';\nimport { setTimeout } from 'timers';\nimport { DigitalTwinForm } from './DigitalTwinForm';\nimport { useMountEffect } from '../../utils/main';\nimport { useStore } from '../templates/Store/Store';\nimport { DigitalTwinActions } from '../../redux/actions';\nimport { getOrDownloadDigitalTwins } from '../../utils/digitalTwins';\nimport { createDigitalTwin } from '../../services/api/digital-twin';\nimport { createAssociatedSmartComponents } from '../../services/api/digital-twin';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst dtUserId = 1;\nexport const NewDigitalTwin = () => {\n  _s();\n\n  useMountEffect(() => {\n    getOrDownloadDigitalTwins(digitalTwins).then(result => {\n      dispatchDigitalTwinActions(DigitalTwinActions.updateDigitalTwins(result));\n    }).catch(e => {\n      console.error(e);\n    });\n  });\n  const {\n    data: digitalTwins,\n    dispatchAction: dispatchDigitalTwinActions\n  } = useStore('digitalTwins');\n  const [redirectTo, setRedirectTo] = useState(\"\");\n  const [dtName, setDtName] = useState('');\n  const [associatedSc, setAssociatedSc] = useState([]);\n  const [choosenAssociatedSc, setChoosenAssociatedSc] = useState([]);\n  let dtId = 1;\n  let idAssociatedSmartComponent = 1;\n\n  const redirectToList = () => setRedirectTo(routes.functionBlockList);\n\n  const buildDigitalTwin = () => ({\n    dtName,\n    dtId,\n    dtUserId\n  });\n\n  const redirectToListAndUpdateLocal = () => {\n    dispatchDigitalTwinActions(DigitalTwinActions.addDigitalTwin(buildDigitalTwin()));\n    redirectToList();\n  };\n\n  const buildAssociatedSmartComponent = (associatedSc, dtId, i) => ({\n    scName: associatedSc[i].scName,\n    scDtId: dtId,\n    associatedScUserId: 1\n  });\n\n  const createDigitalTwinAction = () => {\n    return new Promise((res, rej) => {\n      setTimeout(() => {\n        if (associatedSc.length === 0) {\n          createDigitalTwin(dtName).then(result => {\n            dtId = result.extra.lastInsertedId;\n            res('Digital Twin created');\n          }).catch(e => rej(e.msg));\n        } else {\n          console.log(associatedSc.length);\n          createDigitalTwin(dtName).then(result => {\n            dtId = result.extra.lastInsertedId;\n            let i = 0;\n\n            while (associatedSc.length) {\n              const choosenAssociatedSc = buildAssociatedSmartComponent(associatedSc, dtId, i);\n              createAssociatedSmartComponents(choosenAssociatedSc).then(r => {\n                idAssociatedSmartComponent = r.extra.lastInsertedId;\n                res('Associated Smart Component created');\n              }).catch(e => rej(e.msg));\n              i++;\n            }\n          }).catch(e => rej(e.msg));\n        }\n      });\n    });\n  };\n\n  if (redirectTo !== \"\") return /*#__PURE__*/_jsxDEV(Redirect, {\n    to: redirectTo,\n    push: true\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 113,\n    columnNumber: 12\n  }, this);\n  return /*#__PURE__*/_jsxDEV(Navigator, {\n    title: \"New Digital Twin\",\n    children: /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: /*#__PURE__*/_jsxDEV(DigitalTwinForm, {\n        dtName: {\n          dtName,\n          setDtName\n        },\n        associatedSc: {\n          associatedSc,\n          setAssociatedSc\n        },\n        cancel: {\n          action: redirectToList,\n          label: 'Cancel'\n        },\n        confirmDialog: {\n          buttonTitle: 'Confirm',\n          title: 'Creating Digital Twin',\n          initialState: ConfirmActionStateLabel.executing,\n          action: createDigitalTwinAction,\n          onSuccess: redirectToListAndUpdateLocal,\n          success: {\n            label: '',\n            positiveLabel: 'Ok'\n          },\n          error: {\n            label: '',\n            positiveLabel: 'Ok'\n          }\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 118,\n        columnNumber: 7\n      }, this)\n    }, void 0, false)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 116,\n    columnNumber: 5\n  }, this);\n};\n\n_s(NewDigitalTwin, \"s8UZKDbUWxfqQODnst2YurYiwMk=\", false, function () {\n  return [useMountEffect, useStore];\n});\n\n_c = NewDigitalTwin;\n\nvar _c;\n\n$RefreshReg$(_c, \"NewDigitalTwin\");","map":{"version":3,"sources":["/media/maria/96ae9a87-ebe3-48cb-a2c1-fae5fe76b9e7/maria/Marketplace-JurassicPark/backend/web/src/components/DigitalTwin/NewDigitalTwin.tsx"],"names":["React","useState","Navigator","Redirect","routes","ConfirmActionStateLabel","setTimeout","DigitalTwinForm","useMountEffect","useStore","DigitalTwinActions","getOrDownloadDigitalTwins","createDigitalTwin","createAssociatedSmartComponents","dtUserId","NewDigitalTwin","digitalTwins","then","result","dispatchDigitalTwinActions","updateDigitalTwins","catch","e","console","error","data","dispatchAction","redirectTo","setRedirectTo","dtName","setDtName","associatedSc","setAssociatedSc","choosenAssociatedSc","setChoosenAssociatedSc","dtId","idAssociatedSmartComponent","redirectToList","functionBlockList","buildDigitalTwin","redirectToListAndUpdateLocal","addDigitalTwin","buildAssociatedSmartComponent","i","scName","scDtId","associatedScUserId","createDigitalTwinAction","Promise","res","rej","length","extra","lastInsertedId","msg","log","r","action","label","buttonTitle","title","initialState","executing","onSuccess","success","positiveLabel"],"mappings":"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","sourcesContent":["import React, { useState } from 'react'\r\nimport { Navigator } from '../templates/Navigator/Navigator'\r\nimport { FBGeneralCategory, Variable, Event, FunctionBlock, ExternalDependency, FBCategory, DigitalTwin, AssociatedSmartComponent, SmartComponent } from '../../model/index'\r\nimport { Redirect } from 'react-router-dom'\r\nimport { routes } from '../../App'\r\nimport { createFunctionBlock } from '../../services/api/function-block'\r\nimport { ConfirmActionStateLabel } from '../templates/ConfirmAction/ConfirmAction'\r\nimport { RequestResponseState } from '../../services/api/api'\r\nimport { setTimeout } from 'timers'\r\nimport { DigitalTwinForm } from './DigitalTwinForm'\r\nimport { toBase64, useMountEffect } from '../../utils/main'\r\nimport { useStore } from '../templates/Store/Store'\r\nimport { DigitalTwinActions, FunctionBlockActions, FunctionBlockCategoriesActions } from '../../redux/actions'\r\nimport { getOrDownloadFunctionBlocks } from '../../utils/functionBlock'\r\nimport { getOrDownloadDigitalTwins } from '../../utils/digitalTwins'\r\nimport { createDigitalTwin } from '../../services/api/digital-twin'\r\nimport { createAssociatedSmartComponents } from '../../services/api/digital-twin'\r\nimport { isConstructorDeclaration } from 'typescript'\r\nimport { LocalConvenienceStoreOutlined } from '@material-ui/icons'\r\n\r\nconst dtUserId = 1\r\n\r\nexport const NewDigitalTwin = () => {\r\n\r\n  useMountEffect(() => {\r\n    \r\n    getOrDownloadDigitalTwins(digitalTwins)\r\n      .then((result: DigitalTwin[]) => {\r\n          dispatchDigitalTwinActions(DigitalTwinActions.updateDigitalTwins(result))\r\n      })\r\n      .catch((e:RequestResponseState) => {\r\n          console.error(e)\r\n      })\r\n\r\n  })\r\n\r\n  const {data: digitalTwins, dispatchAction:dispatchDigitalTwinActions} = useStore('digitalTwins')\r\n  \r\n  const [redirectTo, setRedirectTo] : [string, Function] = useState(\"\")\r\n\r\n  const [dtName,setDtName] : [string,Function] = useState('')\r\n  const [associatedSc,setAssociatedSc] : [SmartComponent[],Function] = useState([])\r\n  const [choosenAssociatedSc, setChoosenAssociatedSc] : [AssociatedSmartComponent[] ,Function] = useState([])\r\n\r\n  let dtId = 1\r\n  let idAssociatedSmartComponent = 1\r\n\r\n  const redirectToList = () => setRedirectTo(routes.functionBlockList)\r\n\r\n  const buildDigitalTwin = () : DigitalTwin => ({\r\n    dtName, dtId,\r\n    dtUserId,\r\n  })\r\n\r\n  const redirectToListAndUpdateLocal = () => {\r\n    dispatchDigitalTwinActions(DigitalTwinActions.addDigitalTwin(buildDigitalTwin()))\r\n    redirectToList()\r\n  } \r\n  \r\n  const buildAssociatedSmartComponent = (associatedSc : SmartComponent[], dtId: number, i: number) : AssociatedSmartComponent => ({\r\n    scName: associatedSc[i].scName, scDtId: dtId,\r\n    associatedScUserId: 1\r\n  })\r\n  \r\n  const createDigitalTwinAction = () : Promise<string> => {\r\n    \r\n    return new Promise<string>((res:Function, rej:Function)  => {\r\n\r\n      setTimeout(() => {\r\n\r\n        if(associatedSc.length === 0){\r\n          \r\n          createDigitalTwin(dtName)\r\n          .then((result: RequestResponseState) => {\r\n            dtId = result.extra.lastInsertedId\r\n            res('Digital Twin created')\r\n          })\r\n\r\n          .catch((e:RequestResponseState) => rej(e.msg))\r\n\r\n        }\r\n\r\n        else {\r\n\r\n          console.log(associatedSc.length)\r\n          createDigitalTwin(dtName)\r\n          .then((result:RequestResponseState) => {\r\n\r\n            dtId = result.extra.lastInsertedId\r\n            let i = 0  \r\n            while(associatedSc.length){         \r\n            const choosenAssociatedSc : AssociatedSmartComponent = buildAssociatedSmartComponent(associatedSc,dtId,i)\r\n\r\n            createAssociatedSmartComponents(choosenAssociatedSc)\r\n            .then((r:RequestResponseState) => {\r\n              idAssociatedSmartComponent= r.extra.lastInsertedId\r\n              res('Associated Smart Component created')\r\n            \r\n            }) \r\n            .catch((e:RequestResponseState) => rej(e.msg))\r\n\r\n            i++\r\n            }\r\n          })\r\n          .catch((e:RequestResponseState) => rej(e.msg))\r\n                    \r\n        }\r\n      })\r\n    })\r\n  }\r\n\r\n  if(redirectTo !== \"\") \r\n    return <Redirect to={redirectTo} push={true} />\r\n  \r\n  return (\r\n    <Navigator title=\"New Digital Twin\">\r\n      <>\r\n      <DigitalTwinForm \r\n        dtName={{dtName, setDtName}}\r\n        associatedSc = {{associatedSc, setAssociatedSc}}\r\n        cancel={{action: redirectToList, label: 'Cancel'}}\r\n        confirmDialog={{\r\n          buttonTitle: 'Confirm',\r\n          title: 'Creating Digital Twin',\r\n          initialState: ConfirmActionStateLabel.executing,\r\n          action: createDigitalTwinAction,\r\n          onSuccess: redirectToListAndUpdateLocal,\r\n          success: {\r\n            label: '',\r\n            positiveLabel: 'Ok'\r\n          },\r\n          error: {\r\n            label: '',\r\n            positiveLabel: 'Ok'\r\n          },\r\n        }}\r\n      />\r\n      </>\r\n    </Navigator>\r\n  )\r\n}"]},"metadata":{},"sourceType":"module"}