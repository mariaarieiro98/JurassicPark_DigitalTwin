{"ast":null,"code":"var _jsxFileName = \"/media/maria/96ae9a87-ebe3-48cb-a2c1-fae5fe76b9e7/maria/Marketplace-JurassicPark/backend/web/src/components/DigitalTwin/FunctionalityDetails.tsx\",\n    _s = $RefreshSig$();\n\nimport { Box, Button, Card, CardContent, CardHeader, Divider, Grid } from '@material-ui/core';\nimport React, { useState } from 'react';\nimport { Redirect, useRouteMatch } from 'react-router-dom';\nimport { routes } from '../../App';\nimport { FunctionalityActions, MonitoredEventActions, MonitoredVariableActions } from '../../redux/actions';\nimport { getOrDownloadFunctionalities, getOrDownloadMonitoredEvents, getOrDownloadMonitoredVariables } from '../../utils/digitalTwins';\nimport { useMountEffect } from '../../utils/main';\nimport { Navigator } from '../templates/Navigator/Navigator';\nimport { useStore } from '../templates/Store/Store';\nimport { JPTable } from '../templates/Table/JPTable';\nimport { FunctionalityForm } from './FunctionalityForm';\nimport { SocketConnection, SOCKET_EVENT } from '../../services/socket/socket';\nimport { Visibility } from '@material-ui/icons';\nimport { useSmartComponentStyles } from '../SmartComponents/style';\nimport { deleteMonitoredVariable } from '../../services/api/digital-twin'; //Esta página pretende dispor informação mais detalhada da funcionalidade correspondente disponível na página \"DigitalTwinMonitoring\"\n\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport const FunctionalityDetails = () => {\n  _s();\n\n  //Recupera o id da funcionalidade seleccionada anteriormente na página Digital Twin Monitoring\n  const matchParams = useRouteMatch();\n  const id = matchParams.params.id; // Recuperar da base de dados as variáveis que estão a ser monitorizadas (MonitoredVariable)\n\n  const [fetching, setFetching] = useState(true);\n  const [error, setError] = useState('');\n  const {\n    data: monitoredVariables,\n    dispatchAction: dispatchMonitoredVariableActions\n  } = useStore('monitoredVariables');\n\n  const updateMonitoredVariables = monVar => dispatchMonitoredVariableActions(MonitoredVariableActions.updateMonitoredVariable(monVar));\n\n  const [selectedMonitoredVariable, setSelectedMonitoredVariable] = useState([]);\n\n  const initializeMonitoredVariable = monVars => {\n    let monitoredVariable = monVars.filter(monVar => monVar.funcIdAssociated === parseInt(id));\n    setSelectedMonitoredVariable(monitoredVariable);\n  };\n\n  useMountEffect(() => {\n    setFetching(true);\n    getOrDownloadMonitoredVariables(monitoredVariables).then(result => {\n      updateMonitoredVariables(result);\n      initializeMonitoredVariable(result);\n    }).catch(e => {\n      setError(e.msg);\n    }).finally(() => setFetching(false));\n  }); // Recuperar da base de dados os eventos que estão a ser monitorizados (MonitoredEvent)\n\n  const {\n    data: monitoredEvents,\n    dispatchAction: dispatchMonitoredEventActions\n  } = useStore('monitoredEvents');\n\n  const updateMonitoredEvents = monEv => dispatchMonitoredEventActions(MonitoredEventActions.updateMonitoredEvent(monEv));\n\n  const [selectedMonitoredEvent, setSelectedMonitoredEvent] = useState([]);\n\n  const initializeMonitoredEvent = monEvs => {\n    let monitoredEvent = monEvs.filter(monEv => monEv.funcIdAssociated === parseInt(id));\n    setSelectedMonitoredEvent(monitoredEvent);\n  };\n\n  useMountEffect(() => {\n    setFetching(true);\n    getOrDownloadMonitoredEvents(monitoredEvents).then(result => {\n      updateMonitoredEvents(result);\n      initializeMonitoredEvent(result);\n    }).catch(e => {\n      setError(e.msg);\n    }).finally(() => setFetching(false));\n  }); // Cabeçalhos da tabela Variable + Funções Necessárias\n\n  const indexes_variable = [{\n    label: 'Variable',\n    key: 'monitoredVariableName'\n  }, {\n    label: 'Function Block',\n    key: 'id'\n  }, {\n    label: 'Smart Component',\n    key: 'sc'\n  }, {\n    label: 'Current Value',\n    key: 'currentValueData'\n  } //{label: 'Graph', key: 'dtName'},\n  //{label: 'Remove', key: 'dtName'},\n  ];\n\n  const getDataMonitoredVariable = () => selectedMonitoredVariable.map(monitoredVariable => {\n    return { ...monitoredVariable\n    };\n  }); // Cabeçalhos da tabela Event + Funções Necessárias\n\n\n  const indexes_event = [{\n    label: 'Event',\n    key: 'monitoredEventName'\n  }, {\n    label: 'Function Block',\n    key: 'fbAssociated'\n  }, {\n    label: 'Smart Component',\n    key: 'scAssociated'\n  }, {\n    label: 'Trigger',\n    key: 'dtName'\n  }, {\n    label: 'Current Value',\n    key: 'sc.scState'\n  } //{label: 'Graph', key: 'dtName'},\n  //{label: 'Remove', key: 'dtName'},\n  ];\n\n  const getDataMonitoredEvent = () => selectedMonitoredEvent.map(monitoredEvent => {\n    return { ...monitoredEvent\n    };\n  });\n\n  const deleteMonitoredVariableAction = monVar => {\n    return new Promise(async (res, rej) => {\n      if (!monVar.idMonitoredVariable) {\n        rej('Error');\n        return;\n      }\n\n      try {\n        console.log(\"id:\", monVar.idMonitoredVariable);\n        const response = await deleteMonitoredVariable(monVar.idMonitoredVariable);\n        res(response);\n      } catch (err) {\n        rej(err);\n      }\n    });\n  }; // Variáveis e funções que permitem o redireccionamento para a página DigitalTwinMonitoring\n\n\n  const [redirectTo, setRedirectTo] = useState(\"\");\n\n  const redirectToList = () => setRedirectTo(routes.digitalTwinMonitoring); // Recuperar da base de dados as funcionalidades (Functionality)\n\n\n  const {\n    data: functionalities,\n    dispatchAction: dispatchFunctionalityActions\n  } = useStore('functionalities');\n\n  const updateFunctionalities = funcs => dispatchFunctionalityActions(FunctionalityActions.updateFunctionalities(funcs));\n\n  useMountEffect(() => {\n    setTimeout(() => {\n      setFetching(true);\n      getOrDownloadFunctionalities(functionalities).then(result => updateFunctionalities(result)).catch(e => setError(e.msg)).finally(() => setFetching(false));\n    }, 0);\n  }); // Recuperar dados da funcionalidade\n\n  let [functionalityName, setFunctionalityName] = useState([]);\n  let i = 0;\n\n  while (i < functionalities.length) {\n    if (functionalities[i].funcId == id) {\n      functionalityName = functionalities[i].funcName;\n    }\n\n    i++;\n  } // Estabelecer a ligação com os sockets\n\n\n  const socket = new SocketConnection(SocketConnection.getSmartComponentsNamespace());\n  const [smartComponents, setSmartComponents] = useState([]);\n  const [monitoredVariableInstances, setMonitoredVariableInstances] = useState([]);\n  const classes = useSmartComponentStyles();\n\n  const updateSmartObjects = scs => setSmartComponents(getComponentsWithStateData(scs));\n\n  const updateMonitoredVariableInstances = monVars => setMonitoredVariableInstances(getMonitoredVariablesWithCurrentValue(monVars));\n\n  const updateSmartComponent = sc => {\n    //console.log(\"sc:\", sc)\n    setSmartComponents(prevComponents => {\n      let newSc = true;\n      const newComponents = getComponentsWithStateData(prevComponents.map(oSc => {\n        if (oSc.scId === sc.scId) {\n          newSc = false;\n          return sc;\n        }\n\n        return oSc;\n      }));\n      if (newSc) return [...prevComponents, addStateAndDetialData(sc)];\n      return newComponents;\n    });\n  };\n\n  const updateMonitoredVariableInstance = monVar => {\n    setMonitoredVariableInstances(prevMonitoredVariables => {\n      let newMonVar = true;\n      const newMonitoredVariables = getMonitoredVariablesWithCurrentValue(prevMonitoredVariables.map(oMonVar => {\n        if (oMonVar.sc === monVar.sc) {\n          newMonVar = false;\n          return monVar;\n        }\n\n        return oMonVar;\n      }));\n      if (newMonVar) return [...prevMonitoredVariables, addCurrentValueData(monVar)];\n      return newMonitoredVariables;\n    });\n  };\n\n  const getComponentsWithStateData = scs => {\n    return scs.map(sc => addStateAndDetialData(sc));\n  };\n\n  const getMonitoredVariablesWithCurrentValue = monVars => {\n    return monVars.map(monVar => addCurrentValueData(monVar));\n  };\n\n  const addStateAndDetialData = sc => {\n    return { ...sc,\n      state: {\n        key: sc.scState,\n        data: /*#__PURE__*/_jsxDEV(Box, {\n          className: `${classes.onLineState} ${sc.scState === 'connected' ? classes.onLineStateOn : classes.onLineStateOff}`\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 274,\n          columnNumber: 27\n        }, this)\n      },\n      detail: {\n        key: 'detail',\n        data: /*#__PURE__*/_jsxDEV(Button, {\n          variant: \"text\",\n          size: \"small\",\n          children: /*#__PURE__*/_jsxDEV(Visibility, {\n            fontSize: \"small\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 278,\n            columnNumber: 63\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 278,\n          columnNumber: 27\n        }, this)\n      }\n    };\n  };\n\n  const addCurrentValueData = monVar => {\n    return { ...monVar,\n      currentValueData: {\n        key: monVar.monitoredVariableName,\n        data: monVar.currentValue\n      }\n    };\n  };\n\n  const onInitialData = data => {\n    updateSmartObjects(data.result);\n    setFetching(false);\n  };\n\n  const onDisconnect = () => {\n    setError(\"Server error\");\n    setFetching(false);\n    setSmartComponents([]);\n  };\n\n  useMountEffect(() => {\n    setTimeout(() => {\n      socket.connect(() => {}, onDisconnect, onInitialData);\n      socket.addListener(SOCKET_EVENT.UPDATED_SC_EVENT, updateSmartComponent);\n      socket.addListener(SOCKET_EVENT.EDITED_MVI_EVENT, data => updateMonitoredVariableInstance(data[0]));\n    }, 0);\n  }, () => socket === null || socket === void 0 ? void 0 : socket.disconnect()); // const [smartComponentMvInstances,setSmartComponentMvInstances] : [MonitoredVariableInstance[],Function] = useState([])\n  // const updateSmartComponentMonitoredVariableInstances = (instances: MonitoredVariableInstance[]) => {\n  //     console.log(\"instances:\",instances)\n  //     setSmartComponentMvInstances(instances)\n  // }\n\n  if (redirectTo !== \"\") return /*#__PURE__*/_jsxDEV(Redirect, {\n    to: redirectTo,\n    push: true\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 329,\n    columnNumber: 12\n  }, this);\n  return /*#__PURE__*/_jsxDEV(Navigator, {\n    title: \"Digital Twin monitoring\",\n    children: /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(Grid, {\n        item: true,\n        children: /*#__PURE__*/_jsxDEV(Card, {\n          children: [/*#__PURE__*/_jsxDEV(CardHeader, {\n            title: functionalityName\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 336,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(Divider, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 337,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(CardContent, {\n            children: /*#__PURE__*/_jsxDEV(Grid, {\n              item: true,\n              xs: 12,\n              children: /*#__PURE__*/_jsxDEV(Grid, {\n                item: true,\n                children: /*#__PURE__*/_jsxDEV(JPTable, {\n                  sortedkey: \"idMonitoredVariable\",\n                  data: monitoredVariableInstances,\n                  updateData: updateMonitoredVariableInstances,\n                  indexes: indexes_variable,\n                  tName: \"MonitoredVariable\",\n                  extra: {\n                    delete: {\n                      action: deleteMonitoredVariableAction,\n                      labelKey: 'monitoredVariableName',\n                      onSuccessDelete: () => {}\n                    }\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 361,\n                  columnNumber: 33\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 360,\n                columnNumber: 29\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 359,\n              columnNumber: 25\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 358,\n            columnNumber: 22\n          }, this), /*#__PURE__*/_jsxDEV(CardContent, {\n            children: /*#__PURE__*/_jsxDEV(Grid, {\n              item: true,\n              xs: 12,\n              children: /*#__PURE__*/_jsxDEV(Grid, {\n                item: true,\n                children: /*#__PURE__*/_jsxDEV(JPTable, {\n                  sortedkey: \"idMonitoredEvent\",\n                  data: getDataMonitoredEvent(),\n                  updateData: updateMonitoredEvents,\n                  indexes: indexes_event,\n                  tName: \"MonitoredEvent\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 381,\n                  columnNumber: 33\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 380,\n                columnNumber: 29\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 379,\n              columnNumber: 25\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 378,\n            columnNumber: 21\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 335,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 334,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(FunctionalityForm, {\n        cancel: {\n          action: redirectToList,\n          label: 'Cancel'\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 394,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 332,\n    columnNumber: 5\n  }, this);\n};\n\n_s(FunctionalityDetails, \"XfAQcfTCow/Xv+Y04syPTqk47Ho=\", false, function () {\n  return [useRouteMatch, useStore, useMountEffect, useStore, useMountEffect, useStore, useMountEffect, useSmartComponentStyles, useMountEffect];\n});\n\n_c = FunctionalityDetails;\n\nvar _c;\n\n$RefreshReg$(_c, \"FunctionalityDetails\");","map":{"version":3,"sources":["/media/maria/96ae9a87-ebe3-48cb-a2c1-fae5fe76b9e7/maria/Marketplace-JurassicPark/backend/web/src/components/DigitalTwin/FunctionalityDetails.tsx"],"names":["Box","Button","Card","CardContent","CardHeader","Divider","Grid","React","useState","Redirect","useRouteMatch","routes","FunctionalityActions","MonitoredEventActions","MonitoredVariableActions","getOrDownloadFunctionalities","getOrDownloadMonitoredEvents","getOrDownloadMonitoredVariables","useMountEffect","Navigator","useStore","JPTable","FunctionalityForm","SocketConnection","SOCKET_EVENT","Visibility","useSmartComponentStyles","deleteMonitoredVariable","FunctionalityDetails","matchParams","id","params","fetching","setFetching","error","setError","data","monitoredVariables","dispatchAction","dispatchMonitoredVariableActions","updateMonitoredVariables","monVar","updateMonitoredVariable","selectedMonitoredVariable","setSelectedMonitoredVariable","initializeMonitoredVariable","monVars","monitoredVariable","filter","funcIdAssociated","parseInt","then","result","catch","e","msg","finally","monitoredEvents","dispatchMonitoredEventActions","updateMonitoredEvents","monEv","updateMonitoredEvent","selectedMonitoredEvent","setSelectedMonitoredEvent","initializeMonitoredEvent","monEvs","monitoredEvent","indexes_variable","label","key","getDataMonitoredVariable","map","indexes_event","getDataMonitoredEvent","deleteMonitoredVariableAction","Promise","res","rej","idMonitoredVariable","console","log","response","err","redirectTo","setRedirectTo","redirectToList","digitalTwinMonitoring","functionalities","dispatchFunctionalityActions","updateFunctionalities","funcs","setTimeout","functionalityName","setFunctionalityName","i","length","funcId","funcName","socket","getSmartComponentsNamespace","smartComponents","setSmartComponents","monitoredVariableInstances","setMonitoredVariableInstances","classes","updateSmartObjects","scs","getComponentsWithStateData","updateMonitoredVariableInstances","getMonitoredVariablesWithCurrentValue","updateSmartComponent","sc","prevComponents","newSc","newComponents","oSc","scId","addStateAndDetialData","updateMonitoredVariableInstance","prevMonitoredVariables","newMonVar","newMonitoredVariables","oMonVar","addCurrentValueData","state","scState","onLineState","onLineStateOn","onLineStateOff","detail","currentValueData","monitoredVariableName","currentValue","onInitialData","onDisconnect","connect","addListener","UPDATED_SC_EVENT","EDITED_MVI_EVENT","disconnect","delete","action","labelKey","onSuccessDelete"],"mappings":"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","sourcesContent":["import { Box, Button, Card, CardContent, CardHeader, Divider, Grid } from '@material-ui/core'\r\nimport React, { useState } from 'react'\r\nimport { match, Redirect, useRouteMatch } from 'react-router-dom'\r\nimport { routes } from '../../App'\r\nimport { Functionality, MonitoredEvent, MonitoredVariable, MonitoredVariableInstance, SmartComponent } from '../../model'\r\nimport { FunctionalityActions, MonitoredEventActions, MonitoredVariableActions } from '../../redux/actions'\r\nimport { RequestResponseState } from '../../services/api/api'\r\nimport { getOrDownloadFunctionalities, getOrDownloadMonitoredEvents, getOrDownloadMonitoredVariables } from '../../utils/digitalTwins'\r\nimport { useMountEffect } from '../../utils/main'\r\nimport { Navigator } from '../templates/Navigator/Navigator'\r\nimport { useStore } from '../templates/Store/Store'\r\nimport { JPTable } from '../templates/Table/JPTable'\r\nimport { FunctionalityForm } from './FunctionalityForm'\r\nimport { SocketConnection, SOCKET_EVENT } from '../../services/socket/socket'\r\nimport { Visibility } from '@material-ui/icons'\r\nimport { useSmartComponentStyles } from '../SmartComponents/style'\r\nimport { deleteMonitoredVariable } from '../../services/api/digital-twin'\r\n\r\n//Esta página pretende dispor informação mais detalhada da funcionalidade correspondente disponível na página \"DigitalTwinMonitoring\"\r\n\r\ninterface SmartComponentWithDataState extends SmartComponent {\r\n    state: {\r\n        key: string | undefined\r\n        data: React.ReactElement\r\n    },\r\n    detail: {\r\n        key: 'detail'\r\n        data: React.ReactElement\r\n    }\r\n}\r\n\r\ninterface MonitoredVariableWithCurrentValue extends MonitoredVariableInstance {\r\n    currentValueData: {\r\n        key: string | undefined\r\n        data: number\r\n    }\r\n}\r\n\r\n\r\nexport const FunctionalityDetails = () => {\r\n\r\n    //Recupera o id da funcionalidade seleccionada anteriormente na página Digital Twin Monitoring\r\n    const matchParams : match = useRouteMatch()\r\n    const id = (matchParams.params as any).id\r\n\r\n    // Recuperar da base de dados as variáveis que estão a ser monitorizadas (MonitoredVariable)\r\n    const [fetching,setFetching] = useState(true)\r\n    const [error,setError] = useState('')\r\n    const {data: monitoredVariables, dispatchAction: dispatchMonitoredVariableActions} = useStore('monitoredVariables')\r\n    const updateMonitoredVariables = (monVar: MonitoredVariable[]) => dispatchMonitoredVariableActions(MonitoredVariableActions.updateMonitoredVariable(monVar))\r\n\r\n    const [selectedMonitoredVariable, setSelectedMonitoredVariable] : [MonitoredVariable[], Function] = useState([])\r\n\r\n    const initializeMonitoredVariable = (monVars: MonitoredVariable[]) => {\r\n        \r\n        let monitoredVariable : MonitoredVariable[] = monVars.filter((monVar) => monVar.funcIdAssociated === parseInt(id))\r\n        \r\n        setSelectedMonitoredVariable(monitoredVariable)\r\n\r\n    }\r\n\r\n    useMountEffect(() => {\r\n\r\n        setFetching(true)\r\n        getOrDownloadMonitoredVariables(monitoredVariables)\r\n            .then((result: MonitoredVariable[]) => {\r\n                updateMonitoredVariables(result)\r\n                initializeMonitoredVariable(result)\r\n            })\r\n            .catch((e:RequestResponseState) => {\r\n                setError(e.msg)\r\n            })\r\n            .finally(() => setFetching(false))\r\n\r\n    })\r\n\r\n    // Recuperar da base de dados os eventos que estão a ser monitorizados (MonitoredEvent)\r\n    const {data: monitoredEvents, dispatchAction: dispatchMonitoredEventActions} = useStore('monitoredEvents')\r\n    const updateMonitoredEvents = (monEv: MonitoredEvent[]) => dispatchMonitoredEventActions(MonitoredEventActions.updateMonitoredEvent(monEv))\r\n\r\n    const [selectedMonitoredEvent, setSelectedMonitoredEvent] : [MonitoredEvent[], Function] = useState([])\r\n    \r\n    const initializeMonitoredEvent = (monEvs: MonitoredEvent[]) => {\r\n            \r\n        let monitoredEvent : MonitoredEvent[] = monEvs.filter((monEv) => monEv.funcIdAssociated === parseInt(id))\r\n            \r\n        setSelectedMonitoredEvent(monitoredEvent)\r\n    \r\n    }\r\n    \r\n    useMountEffect(() => {\r\n    \r\n        setFetching(true)\r\n        getOrDownloadMonitoredEvents(monitoredEvents)\r\n            .then((result: MonitoredEvent[]) => {\r\n                updateMonitoredEvents(result)\r\n                initializeMonitoredEvent(result)\r\n            })\r\n            .catch((e:RequestResponseState) => {\r\n                setError(e.msg)\r\n            })\r\n            .finally(() => setFetching(false))\r\n    \r\n    })\r\n    \r\n    // Cabeçalhos da tabela Variable + Funções Necessárias\r\n    const indexes_variable = [\r\n        {label: 'Variable', key: 'monitoredVariableName'},\r\n        {label: 'Function Block', key: 'id'},\r\n        {label: 'Smart Component', key: 'sc'},\r\n        {label: 'Current Value', key: 'currentValueData'},\r\n        //{label: 'Graph', key: 'dtName'},\r\n        //{label: 'Remove', key: 'dtName'},\r\n    ]\r\n\r\n    const getDataMonitoredVariable = () =>  selectedMonitoredVariable.map((monitoredVariable: MonitoredVariable) => {    \r\n        \r\n        return {\r\n            ...monitoredVariable\r\n        }\r\n\r\n    })\r\n\r\n    // Cabeçalhos da tabela Event + Funções Necessárias\r\n    const indexes_event = [\r\n        {label: 'Event', key: 'monitoredEventName'},\r\n        {label: 'Function Block', key: 'fbAssociated'},\r\n        {label: 'Smart Component', key: 'scAssociated'},\r\n        {label: 'Trigger', key: 'dtName'},\r\n        {label: 'Current Value', key: 'sc.scState'},\r\n        //{label: 'Graph', key: 'dtName'},\r\n        //{label: 'Remove', key: 'dtName'},\r\n    ]\r\n\r\n    const getDataMonitoredEvent = () =>  selectedMonitoredEvent.map((monitoredEvent: MonitoredEvent) => {    \r\n        \r\n        return {\r\n            ...monitoredEvent\r\n        }\r\n\r\n    })\r\n\r\n    const deleteMonitoredVariableAction = (monVar: MonitoredVariable) : Promise<any> => {\r\n\r\n        return new Promise(async(res:Function,rej:Function) => {\r\n    \r\n            if(!monVar.idMonitoredVariable) {\r\n                rej('Error')\r\n                return\r\n            }\r\n            \r\n            try {\r\n                console.log(\"id:\",monVar.idMonitoredVariable)\r\n                const response : RequestResponseState = await deleteMonitoredVariable(monVar.idMonitoredVariable)\r\n                res(response)\r\n              }\r\n    \r\n            catch(err) {\r\n                rej(err)\r\n            }\r\n        })\r\n    }\r\n\r\n    // Variáveis e funções que permitem o redireccionamento para a página DigitalTwinMonitoring\r\n    const [redirectTo, setRedirectTo] : [string, Function] = useState(\"\")\r\n\r\n    const redirectToList = () => setRedirectTo(routes.digitalTwinMonitoring)\r\n\r\n    // Recuperar da base de dados as funcionalidades (Functionality)\r\n    const {data:functionalities, dispatchAction:dispatchFunctionalityActions} = useStore('functionalities')\r\n    const updateFunctionalities = (funcs: Functionality[]) => dispatchFunctionalityActions(FunctionalityActions.updateFunctionalities(funcs))\r\n\r\n    useMountEffect(() => {\r\n\r\n    setTimeout(() => {\r\n\r\n    setFetching(true)\r\n    getOrDownloadFunctionalities(functionalities)\r\n        .then((result: Functionality[]) => updateFunctionalities(result))\r\n        .catch((e:RequestResponseState) => setError(e.msg))\r\n        .finally(() => setFetching(false))\r\n    }, 0)\r\n    })\r\n\r\n    // Recuperar dados da funcionalidade\r\n    let [functionalityName, setFunctionalityName] : [Functionality[], Function] = useState([])\r\n\r\n    let i = 0;\r\n    while(i < functionalities.length){\r\n\r\n        if(functionalities[i].funcId == id) {\r\n          functionalityName = functionalities[i].funcName\r\n        }\r\n        i++\r\n    }\r\n\r\n    // Estabelecer a ligação com os sockets\r\n    const socket : SocketConnection = new SocketConnection(SocketConnection.getSmartComponentsNamespace())\r\n    \r\n    const [smartComponents,setSmartComponents] : [SmartComponentWithDataState[],Function] = useState([])\r\n    const [monitoredVariableInstances,setMonitoredVariableInstances] : [MonitoredVariableWithCurrentValue[],Function] = useState([])\r\n\r\n    const classes = useSmartComponentStyles()\r\n\r\n    const updateSmartObjects = (scs:SmartComponent[]) => setSmartComponents(getComponentsWithStateData(scs))\r\n    const updateMonitoredVariableInstances = (monVars:MonitoredVariableInstance[]) => setMonitoredVariableInstances(getMonitoredVariablesWithCurrentValue(monVars))\r\n\r\n    const updateSmartComponent = (sc: SmartComponent) => {\r\n        //console.log(\"sc:\", sc)\r\n\r\n        setSmartComponents((prevComponents: SmartComponentWithDataState[]) => {\r\n\r\n            let newSc = true\r\n\r\n            const newComponents = getComponentsWithStateData(prevComponents.map((oSc:SmartComponentWithDataState) => {\r\n\r\n                if(oSc.scId === sc.scId) {\r\n                    newSc = false\r\n                    return sc\r\n                }\r\n                return oSc\r\n\r\n            }))\r\n        \r\n            if(newSc)\r\n                return [...prevComponents, addStateAndDetialData(sc)]\r\n            return newComponents\r\n\r\n        })\r\n    }\r\n\r\n    const updateMonitoredVariableInstance = (monVar: MonitoredVariableInstance) => {\r\n    \r\n        setMonitoredVariableInstances((prevMonitoredVariables: MonitoredVariableWithCurrentValue[]) => {\r\n\r\n            let newMonVar = true\r\n\r\n            const newMonitoredVariables = getMonitoredVariablesWithCurrentValue(prevMonitoredVariables.map((oMonVar:MonitoredVariableWithCurrentValue) => {\r\n\r\n                if(oMonVar.sc === monVar.sc) {\r\n                    newMonVar = false\r\n                    return monVar\r\n                }\r\n                return oMonVar\r\n\r\n            }))\r\n        \r\n            if(newMonVar)\r\n                return [...prevMonitoredVariables, addCurrentValueData(monVar)]\r\n            return newMonitoredVariables\r\n\r\n        })\r\n    }\r\n\r\n    const getComponentsWithStateData = (scs: SmartComponent[]) : SmartComponentWithDataState[] => {\r\n\r\n        return scs.map((sc:SmartComponent) => addStateAndDetialData(sc))\r\n\r\n    }\r\n\r\n    const getMonitoredVariablesWithCurrentValue = (monVars: MonitoredVariableInstance[]) : MonitoredVariableWithCurrentValue[] => {\r\n\r\n        return monVars.map((monVar:MonitoredVariableInstance) => addCurrentValueData(monVar))\r\n\r\n    }\r\n\r\n    const addStateAndDetialData = (sc: SmartComponent) : SmartComponentWithDataState => {\r\n\r\n        return (\r\n            {\r\n                ...sc, \r\n                state:  {\r\n                    key: sc.scState,\r\n                    data: <Box className= {`${classes.onLineState} ${sc.scState === 'connected' ? classes.onLineStateOn : classes.onLineStateOff}`}/>\r\n                },\r\n                detail: {\r\n                    key: 'detail',\r\n                    data: <Button variant=\"text\" size=\"small\"><Visibility fontSize=\"small\"/></Button> \r\n                }\r\n            }\r\n        )\r\n    }\r\n\r\n    const addCurrentValueData = (monVar: MonitoredVariableInstance) : MonitoredVariableWithCurrentValue => {\r\n\r\n        return (\r\n            {\r\n                ...monVar, \r\n                currentValueData:  {\r\n                    key: monVar.monitoredVariableName,\r\n                    data: monVar.currentValue\r\n                }\r\n            }\r\n        )\r\n    }\r\n\r\n    const onInitialData = (data:any) => {\r\n        updateSmartObjects(data.result)\r\n        setFetching(false)\r\n    } \r\n\r\n    const onDisconnect = () => {\r\n        setError(\"Server error\")\r\n        setFetching(false)\r\n        setSmartComponents([])\r\n    }\r\n\r\n    useMountEffect(() => {\r\n\r\n        setTimeout(() => {\r\n\r\n            socket.connect(() => {}, onDisconnect, onInitialData)\r\n            socket.addListener(SOCKET_EVENT.UPDATED_SC_EVENT, updateSmartComponent)\r\n            socket.addListener(SOCKET_EVENT.EDITED_MVI_EVENT, (data) => updateMonitoredVariableInstance(data[0]))\r\n        }, 0)\r\n\r\n    }, () => socket?.disconnect())\r\n\r\n\r\n    // const [smartComponentMvInstances,setSmartComponentMvInstances] : [MonitoredVariableInstance[],Function] = useState([])\r\n\r\n    // const updateSmartComponentMonitoredVariableInstances = (instances: MonitoredVariableInstance[]) => {\r\n    //     console.log(\"instances:\",instances)\r\n    //     setSmartComponentMvInstances(instances)\r\n\r\n    // }\r\n\r\n    if(redirectTo !== \"\") \r\n    return <Redirect to={redirectTo} push={true} />\r\n\r\n    return(\r\n    <Navigator title=\"Digital Twin monitoring\">\r\n    <>\r\n        <Grid item>\r\n            <Card>\r\n                <CardHeader title={functionalityName} />\r\n                <Divider />\r\n                    {/* <CardContent>\r\n                        <Grid item xs={12}>        \r\n                            <Grid item>\r\n                                <JPTable\r\n                                    sortedkey=\"idMonitoredVariable\"\r\n                                    data={getDataMonitoredVariable()} \r\n                                    updateData={updateMonitoredVariables} \r\n                                    indexes={indexes_variable} \r\n                                    tName='MonitoredVariable'\r\n                                    extra={{\r\n                                        delete: {\r\n                                            action: deleteMonitoredVariableAction,\r\n                                            labelKey: 'monitoredVariableName',\r\n                                            onSuccessDelete: () => {}\r\n                                        }\r\n                                    }} \r\n                                />\r\n                            </Grid>\r\n                        </Grid>\r\n                    </CardContent> */}\r\n                     <CardContent>\r\n                        <Grid item xs={12}>        \r\n                            <Grid item>\r\n                                <JPTable\r\n                                    sortedkey=\"idMonitoredVariable\"\r\n                                    data={monitoredVariableInstances} \r\n                                    updateData={updateMonitoredVariableInstances} \r\n                                    indexes={indexes_variable} \r\n                                    tName='MonitoredVariable'\r\n                                    extra={{\r\n                                        delete: {\r\n                                            action: deleteMonitoredVariableAction,\r\n                                            labelKey: 'monitoredVariableName',\r\n                                            onSuccessDelete: () => {}\r\n                                        }\r\n                                    }} \r\n                                />\r\n                            </Grid>\r\n                        </Grid>\r\n                    </CardContent>\r\n                    <CardContent>\r\n                        <Grid item xs={12}>        \r\n                            <Grid item>\r\n                                <JPTable\r\n                                    sortedkey=\"idMonitoredEvent\"\r\n                                    data={getDataMonitoredEvent()} \r\n                                    updateData={updateMonitoredEvents} \r\n                                    indexes={indexes_event} \r\n                                    tName='MonitoredEvent'\r\n                                />\r\n                            </Grid>\r\n                            \r\n                        </Grid>\r\n                    </CardContent>\r\n            </Card>\r\n        </Grid>\r\n        <FunctionalityForm\r\n            cancel={{action: redirectToList, label: 'Cancel'}}\r\n        />\r\n    </>\r\n    </Navigator>\r\n    )\r\n}"]},"metadata":{},"sourceType":"module"}