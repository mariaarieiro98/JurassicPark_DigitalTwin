{"ast":null,"code":"var _jsxFileName = \"/home/maria/Desktop/Marketplace-JurassicPark/backend/web/src/components/DigitalTwin/DigitalTwinMonitoring.tsx\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nimport React, { useState } from 'react';\nimport { Navigator } from '../templates/Navigator/Navigator';\nimport { ConfirmAction, ConfirmActionStateLabel } from '../templates/ConfirmAction/ConfirmAction';\nimport { LazyComponent } from '../templates/LazyComponent/LazyComponent';\nimport { JPTable } from '../templates/Table/JPTable';\nimport { useMountEffect } from '../../utils/main';\nimport { getOrDownloadFunctionalities } from '../../utils/digitalTwins';\nimport { useStore } from '../templates/Store/Store';\nimport { FunctionalityActions } from '../../redux/actions';\nimport { TextField, Grid, Button, Box, Dialog, DialogTitle, CircularProgress } from '@material-ui/core';\nimport { createFunctionBlockCategory, updateFunctionBlockCategory } from '../../services/api/function-block';\nimport { deleteFunctionBlockCategory } from '../../services/api/function-block';\nimport { useDialogStyles } from '../FunctionBlockCategories/List/style';\nimport { CheckCircle, Error } from '@material-ui/icons';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst NEW_FUNCTIONALITY_RE = /[a-zA-Z0-9]{3,}/;\nlet functionalityId = -1;\n\nconst EditFBCategoryDialog = props => {\n  _s();\n\n  const [newCategoryName, setNewCategoryName] = useState(props.category.fbcName);\n  const classes = useDialogStyles();\n  const [sending, setSending] = useState(false);\n  const [result, setResult] = useState({\n    done: false\n  });\n\n  const action = () => {\n    if (props.category.fbcId) {\n      if (!result.done) {\n        setSending(true);\n        updateFunctionBlockCategory(props.category.fbcId, newCategoryName).then(response => {\n          setResult({\n            done: true,\n            good: true,\n            message: response.msg\n          });\n        }).catch(error => {\n          setResult({\n            done: true,\n            good: false,\n            message: error.msg\n          });\n        }).finally(() => setSending(false));\n      } else {\n        if (result.good) props.onGood({ ...props.category,\n          fbcName: newCategoryName\n        });else props.onError();\n      }\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(Dialog, {\n    open: true,\n    children: [/*#__PURE__*/_jsxDEV(DialogTitle, {\n      children: \"Edit Category\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 70,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(Box, {\n      className: classes.box,\n      children: !result.done ? /*#__PURE__*/_jsxDEV(TextField, {\n        disabled: sending,\n        value: newCategoryName,\n        onChange: event => setNewCategoryName(event.target.value)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 75,\n        columnNumber: 29\n      }, this) : /*#__PURE__*/_jsxDEV(Grid, {\n        container: true,\n        justify: \"center\",\n        children: [/*#__PURE__*/_jsxDEV(Grid, {\n          item: true,\n          children: result.good ? /*#__PURE__*/_jsxDEV(CheckCircle, {\n            color: \"primary\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 84,\n            columnNumber: 49\n          }, this) : /*#__PURE__*/_jsxDEV(Error, {\n            color: \"error\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 85,\n            columnNumber: 49\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 81,\n          columnNumber: 33\n        }, this), /*#__PURE__*/_jsxDEV(Grid, {\n          item: true,\n          children: /*#__PURE__*/_jsxDEV(Box, {\n            className: result.good ? classes.good : classes.error,\n            textAlign: \"center\",\n            children: result.message\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 89,\n            columnNumber: 37\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 88,\n          columnNumber: 33\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 80,\n        columnNumber: 30\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 71,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(Grid, {\n      className: classes.buttons,\n      container: true,\n      direction: \"row\",\n      justify: \"space-between\",\n      children: [/*#__PURE__*/_jsxDEV(Grid, {\n        item: true,\n        children: sending ? /*#__PURE__*/_jsxDEV(CircularProgress, {\n          color: \"primary\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 97,\n          columnNumber: 27\n        }, this) : /*#__PURE__*/_jsxDEV(Button, {\n          onClick: action,\n          children: \"Ok\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 98,\n          columnNumber: 27\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 95,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Grid, {\n        item: true,\n        children: /*#__PURE__*/_jsxDEV(Button, {\n          disabled: sending,\n          onClick: props.onCancel,\n          children: \"Cancel\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 102,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 101,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 69,\n    columnNumber: 9\n  }, this);\n};\n\n_s(EditFBCategoryDialog, \"jnrKS5Gqcr5egIrNgFOfDUg9+bw=\", false, function () {\n  return [useDialogStyles];\n});\n\n_c = EditFBCategoryDialog;\nexport const DigitalTwinMonitoring = () => {\n  _s2();\n\n  const [fetching, setFetching] = useState(true);\n  const [error, setError] = useState('');\n  const [newFunc, setNewFunc] = useState('');\n  const [confirmAddFunc, setConfirmAddFunc] = useState(false);\n  const [validNewFunc, setValidNewFunc] = useState(true);\n  const errorFetchingFunctionalityState = {\n    label: error,\n    state: ConfirmActionStateLabel.error,\n    positiveLabel: 'Ok'\n  };\n  const {\n    data: functionalities,\n    dispatchAction: dispatchFunctionalityActions\n  } = useStore('functionalities');\n\n  const onCancel = () => setError('');\n\n  const updateFunctionalities = funcs => dispatchFunctionalityActions(FunctionalityActions.updateFunctionalities(funcs));\n\n  const addFunc = () => dispatchFunctionalityActions(FunctionalityActions.addFunctionality({\n    funcId: functionalityId,\n    funcUserId: 1,\n    funcName: newFunc\n  }));\n\n  const [editingFunc, setEditingFunc] = useState(null);\n  const indexes = [{\n    label: 'Functionality',\n    key: 'dtFunctionality'\n  } //{label: 'Digital Twin', key: 'dt'},\n  //{label: 'State', key: 'dtDescription'},\n  //{label: 'AssociatedSmartComponents', key: 'dtSmartComponents'},\n  //{label: 'Monitored Variables/Events', key: 'dtMonitoredVariableEvent'},\n  //{label: 'Add Variables/Events', key: 'dtAddVariableEvent'},\n  //{label: 'Details', key: 'dtDetails'},\n  ];\n  useMountEffect(() => {\n    setTimeout(() => {\n      setFetching(true);\n      getOrDownloadFunctionalities(functionalities).then(result => updateFunctionalities(result)).catch(e => setError(e.msg)).finally(() => setFetching(false));\n    }, 0);\n  });\n\n  const isFunctionalityValid = func => NEW_FUNCTIONALITY_RE.test(func);\n\n  const validateAndCreate = () => {\n    const validCategory = isCategoryValid(newCategory);\n    if (!validCategory) setValidNewCategory(false);else setConfirmAddCategory(true);\n  };\n\n  const addNewCategoryAction = () => {\n    return new Promise((res, rej) => {\n      createFunctionBlockCategory(newCategory.trim()).then(result => {\n        categoryId = result.extra.lastInsertedId;\n        res('Category created');\n      }).catch(e => rej(e.msg));\n    });\n  };\n\n  const confirmCategoryCreationActionStates = {\n    start: {\n      label: `Confirm creation of new category: ${newCategory} ?`,\n      positiveLabel: 'Ok',\n      negativeLabel: 'Cancel',\n      state: ConfirmActionStateLabel.start\n    },\n    executing: {\n      label: '',\n      state: ConfirmActionStateLabel.executing\n    },\n    success: {\n      label: 'Category Created',\n      state: ConfirmActionStateLabel.success,\n      positiveLabel: 'Ok'\n    },\n    error: {\n      label: 'Error Creating Category',\n      state: ConfirmActionStateLabel.error,\n      positiveLabel: 'Ok'\n    }\n  };\n  const confirmActionProps = {\n    title: 'Add Category',\n    states: confirmCategoryCreationActionStates,\n    currentState: confirmCategoryCreationActionStates.start,\n    onCancel: () => setConfirmAddCategory(false),\n    onError: () => setConfirmAddCategory(false),\n    onSuccess: () => {\n      addFunctionBlockCategory();\n      setNewCategory('');\n    },\n    action: addNewCategoryAction\n  };\n\n  const getData = () => functionBlockCategories.map(category => {\n    var _category$functionBlo, _category$functionBlo2, _category$functionBlo3, _category$functionBlo4, _category$functionBlo5;\n\n    return { ...category,\n      fbList: {\n        key: (_category$functionBlo = (_category$functionBlo2 = category.functionBlocks) === null || _category$functionBlo2 === void 0 ? void 0 : _category$functionBlo2.length) !== null && _category$functionBlo !== void 0 ? _category$functionBlo : 0,\n        data: /*#__PURE__*/_jsxDEV(Grid, {\n          container: true,\n          direction: \"row\",\n          spacing: 2,\n          wrap: \"wrap\",\n          children: [\" \", (_category$functionBlo3 = category.functionBlocks) === null || _category$functionBlo3 === void 0 ? void 0 : _category$functionBlo3.map((fb, index) => /*#__PURE__*/_jsxDEV(Grid, {\n            item: true,\n            children: /*#__PURE__*/_jsxDEV(Box, {\n              fontStyle: \"italic\",\n              children: [\" \", fb, \" ; \"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 231,\n              columnNumber: 44\n            }, this)\n          }, index, false, {\n            fileName: _jsxFileName,\n            lineNumber: 231,\n            columnNumber: 21\n          }, this)), \" \"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 230,\n          columnNumber: 24\n        }, this)\n      },\n      deleteDisabled: (_category$functionBlo4 = !!((_category$functionBlo5 = category.functionBlocks) === null || _category$functionBlo5 === void 0 ? void 0 : _category$functionBlo5.length)) !== null && _category$functionBlo4 !== void 0 ? _category$functionBlo4 : false\n    };\n  });\n\n  const deleteFunctionBlockCategoryAction = category => {\n    return new Promise(async (res, rej) => {\n      if (!category.fbcId) {\n        rej('Error');\n        return;\n      }\n\n      try {\n        const response = await deleteFunctionBlockCategory(category.fbcId);\n        res(response);\n      } catch (err) {\n        rej(err);\n      }\n    });\n  };\n\n  const cancelEditing = () => setEditingCategory(null);\n\n  const showEditing = cat => setEditingCategory(cat);\n\n  const onGoodEditing = editingCat => {\n    const newCats = functionBlockCategories.map(cat => {\n      if (cat.fbcId === editingCat.fbcId) return { ...cat,\n        fbcName: editingCat.fbcName\n      };\n      return cat;\n    });\n    cancelEditing();\n    dispatchFunctionBlockCategoriesActions(FunctionBlockCategoriesActions.updateFunctionBlockCategories(newCats));\n  };\n\n  return /*#__PURE__*/_jsxDEV(Navigator, {\n    title: \"Function Block Categories\",\n    children: /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [error !== '' ? /*#__PURE__*/_jsxDEV(ConfirmAction, {\n        title: \"Fetching Function Blocks\",\n        currentState: errorFetchngCategoriesState,\n        states: {\n          error: errorFetchngCategoriesState\n        },\n        onCancel: onCancel\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 282,\n        columnNumber: 19\n      }, this) : null, /*#__PURE__*/_jsxDEV(LazyComponent, {\n        loaded: !fetching,\n        children: /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [confirmAddCategory ? /*#__PURE__*/_jsxDEV(ConfirmAction, { ...confirmActionProps\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 288,\n            columnNumber: 27\n          }, this) : editingCategory ? /*#__PURE__*/_jsxDEV(EditFBCategoryDialog, {\n            onGood: onGoodEditing,\n            category: editingCategory,\n            onError: cancelEditing,\n            onCancel: cancelEditing\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 290,\n            columnNumber: 32\n          }, this) : null, /*#__PURE__*/_jsxDEV(Grid, {\n            container: true,\n            direction: \"column\",\n            spacing: 2,\n            children: [/*#__PURE__*/_jsxDEV(Grid, {\n              item: true,\n              children: /*#__PURE__*/_jsxDEV(JPTable, {\n                sortedkey: \"fbcName\",\n                data: getData(),\n                updateData: updateFunctionBlockCategories,\n                indexes: indexes,\n                tName: \"Function Block Category\",\n                extra: {\n                  delete: {\n                    action: deleteFunctionBlockCategoryAction,\n                    labelKey: 'fbcName',\n                    onSuccessDelete: () => {}\n                  },\n                  edit: {\n                    action: showEditing\n                  }\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 299,\n                columnNumber: 29\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 298,\n              columnNumber: 25\n            }, this), /*#__PURE__*/_jsxDEV(Grid, {\n              item: true,\n              children: /*#__PURE__*/_jsxDEV(Grid, {\n                container: true,\n                justify: \"flex-end\",\n                spacing: 1,\n                children: [/*#__PURE__*/_jsxDEV(Grid, {\n                  item: true,\n                  xs: 4,\n                  children: /*#__PURE__*/_jsxDEV(TextField, {\n                    helperText: !validNewCategory ? NEW_CATEGORY_RE.toString() : '',\n                    error: !validNewCategory,\n                    required: true,\n                    onChange: event => {\n                      setNewCategory(event.target.value);\n                      if (!validNewCategory) setValidNewCategory(isCategoryValid(event.target.value.trim()));\n                    },\n                    fullWidth: true,\n                    value: newCategory\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 320,\n                    columnNumber: 37\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 319,\n                  columnNumber: 33\n                }, this), /*#__PURE__*/_jsxDEV(Grid, {\n                  item: true,\n                  children: /*#__PURE__*/_jsxDEV(Button, {\n                    color: \"primary\",\n                    variant: \"contained\",\n                    onClick: validateAndCreate,\n                    children: \"Add Category\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 334,\n                    columnNumber: 37\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 333,\n                  columnNumber: 33\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 318,\n                columnNumber: 29\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 317,\n              columnNumber: 25\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 297,\n            columnNumber: 21\n          }, this)]\n        }, void 0, true)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 285,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 279,\n    columnNumber: 9\n  }, this);\n};\n\n_s2(DigitalTwinMonitoring, \"6unbhERMJC/rvGsudmgOV7V8n3k=\", false, function () {\n  return [useStore, useMountEffect];\n});\n\n_c2 = DigitalTwinMonitoring;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"EditFBCategoryDialog\");\n$RefreshReg$(_c2, \"DigitalTwinMonitoring\");","map":{"version":3,"sources":["/home/maria/Desktop/Marketplace-JurassicPark/backend/web/src/components/DigitalTwin/DigitalTwinMonitoring.tsx"],"names":["React","useState","Navigator","ConfirmAction","ConfirmActionStateLabel","LazyComponent","JPTable","useMountEffect","getOrDownloadFunctionalities","useStore","FunctionalityActions","TextField","Grid","Button","Box","Dialog","DialogTitle","CircularProgress","createFunctionBlockCategory","updateFunctionBlockCategory","deleteFunctionBlockCategory","useDialogStyles","CheckCircle","Error","NEW_FUNCTIONALITY_RE","functionalityId","EditFBCategoryDialog","props","newCategoryName","setNewCategoryName","category","fbcName","classes","sending","setSending","result","setResult","done","action","fbcId","then","response","good","message","msg","catch","error","finally","onGood","onError","box","event","target","value","buttons","onCancel","DigitalTwinMonitoring","fetching","setFetching","setError","newFunc","setNewFunc","confirmAddFunc","setConfirmAddFunc","validNewFunc","setValidNewFunc","errorFetchingFunctionalityState","label","state","positiveLabel","data","functionalities","dispatchAction","dispatchFunctionalityActions","updateFunctionalities","funcs","addFunc","addFunctionality","funcId","funcUserId","funcName","editingFunc","setEditingFunc","indexes","key","setTimeout","e","isFunctionalityValid","func","test","validateAndCreate","validCategory","isCategoryValid","newCategory","setValidNewCategory","setConfirmAddCategory","addNewCategoryAction","Promise","res","rej","trim","categoryId","extra","lastInsertedId","confirmCategoryCreationActionStates","start","negativeLabel","executing","success","confirmActionProps","title","states","currentState","onSuccess","addFunctionBlockCategory","setNewCategory","getData","functionBlockCategories","map","fbList","functionBlocks","length","fb","index","deleteDisabled","deleteFunctionBlockCategoryAction","err","cancelEditing","setEditingCategory","showEditing","cat","onGoodEditing","editingCat","newCats","dispatchFunctionBlockCategoriesActions","FunctionBlockCategoriesActions","updateFunctionBlockCategories","errorFetchngCategoriesState","confirmAddCategory","editingCategory","delete","labelKey","onSuccessDelete","edit","validNewCategory","NEW_CATEGORY_RE","toString"],"mappings":"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","sourcesContent":["import React, { useState } from 'react'\r\nimport { Navigator } from '../templates/Navigator/Navigator'\r\nimport { ConfirmAction, ConfirmActionState, ConfirmActionStateLabel, ConfirmActionProps } from '../templates/ConfirmAction/ConfirmAction'\r\nimport { LazyComponent } from '../templates/LazyComponent/LazyComponent'\r\nimport { JPTable } from '../templates/Table/JPTable'\r\nimport { Functionality} from '../../model'\r\nimport { useMountEffect } from '../../utils/main'\r\nimport { getOrDownloadFunctionalities} from '../../utils/digitalTwins'\r\nimport { useStore } from '../templates/Store/Store'\r\nimport { FunctionalityActions } from '../../redux/actions'\r\nimport { RequestResponseState } from '../../services/api/api'\r\nimport { TextField, Grid, Button, Box, Dialog, DialogTitle, CircularProgress } from '@material-ui/core'\r\nimport { createFunctionBlockCategory, updateFunctionBlockCategory } from '../../services/api/function-block'\r\nimport { deleteFunctionBlockCategory} from '../../services/api/function-block'\r\nimport { useDialogStyles } from '../FunctionBlockCategories/List/style'\r\nimport { CheckCircle, Error } from '@material-ui/icons'\r\n\r\nconst NEW_FUNCTIONALITY_RE = /[a-zA-Z0-9]{3,}/\r\n\r\nlet functionalityId = -1\r\n\r\nconst EditFBCategoryDialog = (props: {category: FBCategory, onGood: (newCategory: FBCategory) => void, onError: () => void, onCancel: () => void}) => {\r\n\r\n    const [newCategoryName, setNewCategoryName] : [string,Function] = useState(props.category.fbcName)\r\n\r\n    const classes = useDialogStyles()\r\n\r\n    const [sending, setSending] : [boolean, Function] = useState(false)\r\n\r\n    const [result, setResult] : [{done: boolean, good?: boolean, message?: string},Function] = useState({done:false})\r\n\r\n    const action = () => {\r\n\r\n        if(props.category.fbcId) {\r\n\r\n            if(!result.done) {\r\n\r\n                setSending(true)\r\n    \r\n                updateFunctionBlockCategory(props.category.fbcId, newCategoryName)\r\n\r\n                    .then((response: RequestResponseState) => {\r\n                        setResult({done:true, good: true, message: response.msg})\r\n                    })\r\n\r\n                    .catch((error: RequestResponseState) => {\r\n                        setResult({done: true, good: false, message: error.msg})\r\n                    })\r\n\r\n                    .finally(() => setSending(false))\r\n\r\n            }\r\n\r\n            else {\r\n\r\n                if(result.good)\r\n                    props.onGood({...props.category, fbcName: newCategoryName})\r\n                \r\n                else\r\n                    props.onError()\r\n\r\n            }\r\n\r\n        }\r\n\r\n    }\r\n\r\n    return (\r\n        <Dialog open={true}>\r\n            <DialogTitle>Edit Category</DialogTitle>\r\n            <Box className={classes.box}>\r\n                {\r\n                    !result.done \r\n                        ?\r\n                            <TextField \r\n                                disabled={sending}\r\n                                value={newCategoryName}\r\n                                onChange={(event) => setNewCategoryName(event.target.value)}\r\n                            />\r\n                        :    <Grid container justify=\"center\">\r\n                                <Grid item>\r\n                                    {\r\n                                        result.good \r\n                                            ?   <CheckCircle color=\"primary\" />\r\n                                            :   <Error color=\"error\" />\r\n                                    }\r\n                                </Grid>\r\n                                <Grid item>\r\n                                    <Box className={result.good ? classes.good : classes.error} textAlign=\"center\">{result.message}</Box>\r\n                                </Grid>\r\n                            </Grid> \r\n                }\r\n            </Box>\r\n            <Grid className={classes.buttons} container direction=\"row\" justify=\"space-between\">\r\n                <Grid item>\r\n                    {sending \r\n                        ? <CircularProgress color=\"primary\" />\r\n                        : <Button onClick={action}>Ok</Button>\r\n                    }\r\n                </Grid>\r\n                <Grid item>\r\n                    <Button disabled={sending} onClick={props.onCancel}>Cancel</Button>\r\n                </Grid>\r\n            </Grid>\r\n        </Dialog>\r\n    )\r\n\r\n}\r\n\r\nexport const DigitalTwinMonitoring = () => {\r\n  \r\n  const [fetching,setFetching] = useState(true)\r\n  const [error,setError] = useState('')\r\n  const [newFunc,setNewFunc] = useState('')\r\n\r\n  const [confirmAddFunc,setConfirmAddFunc] : [boolean, Function] = useState(false)\r\n\r\n  const [validNewFunc, setValidNewFunc] : [boolean,Function] = useState(true)\r\n\r\n  const errorFetchingFunctionalityState : ConfirmActionState = {\r\n    label: error,\r\n    state: ConfirmActionStateLabel.error,\r\n    positiveLabel: 'Ok'\r\n  }\r\n\r\n  const {data:functionalities, dispatchAction:dispatchFunctionalityActions} = useStore('functionalities')\r\n\r\n  const onCancel = () => setError('')\r\n\r\n  const updateFunctionalities = (funcs: Functionality[]) => dispatchFunctionalityActions(FunctionalityActions.updateFunctionalities(funcs))\r\n  const addFunc = () => dispatchFunctionalityActions(FunctionalityActions.addFunctionality({funcId: functionalityId, funcUserId: 1 , funcName: newFunc}))\r\n  \r\n  const [editingFunc, setEditingFunc] : [Functionality | null,Function] = useState(null)\r\n\r\n  const indexes = [\r\n    {label: 'Functionality', key: 'dtFunctionality'},\r\n    //{label: 'Digital Twin', key: 'dt'},\r\n    //{label: 'State', key: 'dtDescription'},\r\n    //{label: 'AssociatedSmartComponents', key: 'dtSmartComponents'},\r\n    //{label: 'Monitored Variables/Events', key: 'dtMonitoredVariableEvent'},\r\n    //{label: 'Add Variables/Events', key: 'dtAddVariableEvent'},\r\n    //{label: 'Details', key: 'dtDetails'},\r\n  ]\r\n\r\n  useMountEffect(() => {\r\n\r\n      setTimeout(() => {\r\n\r\n      setFetching(true)\r\n      getOrDownloadFunctionalities(functionalities)\r\n          .then((result: Functionality[]) => updateFunctionalities(result))\r\n          .catch((e:RequestResponseState) => setError(e.msg))\r\n          .finally(() => setFetching(false))\r\n      }, 0)\r\n  })\r\n  \r\n  const isFunctionalityValid = (func:string) => NEW_FUNCTIONALITY_RE.test(func)\r\n\r\n    const validateAndCreate = () => {\r\n\r\n        const validCategory = isCategoryValid(newCategory)\r\n\r\n        if(!validCategory)\r\n            setValidNewCategory(false)\r\n        else\r\n            setConfirmAddCategory(true)\r\n    \r\n    }\r\n\r\n    const addNewCategoryAction = () : Promise<string> => {\r\n\r\n        return new Promise<string>((res:Function, rej:Function)  => {\r\n\r\n            createFunctionBlockCategory(newCategory.trim())\r\n\r\n                .then((result: RequestResponseState) => {\r\n                    categoryId = result.extra.lastInsertedId\r\n                    res('Category created')\r\n                })\r\n\r\n                .catch((e:RequestResponseState) => rej(e.msg))\r\n\r\n        })\r\n\r\n    }\r\n\r\n    const confirmCategoryCreationActionStates = {\r\n        start: {\r\n            label: `Confirm creation of new category: ${newCategory} ?`,\r\n            positiveLabel: 'Ok',\r\n            negativeLabel: 'Cancel',\r\n            state: ConfirmActionStateLabel.start\r\n        },\r\n        executing: {\r\n          label: '',\r\n          state: ConfirmActionStateLabel.executing,\r\n        },\r\n        success: {\r\n          label: 'Category Created',\r\n          state: ConfirmActionStateLabel.success,\r\n          positiveLabel: 'Ok'\r\n        },\r\n        error: {\r\n          label: 'Error Creating Category',\r\n          state: ConfirmActionStateLabel.error,\r\n          positiveLabel: 'Ok'\r\n        },\r\n      }\r\n    \r\n    const confirmActionProps : ConfirmActionProps = {\r\n\r\n        title: 'Add Category',\r\n        states: confirmCategoryCreationActionStates,\r\n        currentState: confirmCategoryCreationActionStates.start,\r\n        onCancel: () => setConfirmAddCategory(false),\r\n        onError: () => setConfirmAddCategory(false),\r\n        onSuccess: () => {\r\n            addFunctionBlockCategory()\r\n            setNewCategory('')\r\n        },\r\n        action: addNewCategoryAction,\r\n    }\r\n\r\n    const getData = () => functionBlockCategories.map((category: FBCategory) => {\r\n\r\n        return {\r\n            ...category,\r\n            fbList: {\r\n                key: category.functionBlocks?.length ?? 0,\r\n                data:  <Grid container direction=\"row\" spacing={2} wrap=\"wrap\"> {category.functionBlocks?.map((fb: string, index:number) => (\r\n                    <Grid key={index} item><Box fontStyle=\"italic\"> {fb} ; </Box></Grid>\r\n                ))} </Grid>\r\n            },\r\n            deleteDisabled: !!category.functionBlocks?.length ?? false\r\n        }\r\n\r\n    })\r\n\r\n    const deleteFunctionBlockCategoryAction = (category: FBCategory) : Promise<any> => {\r\n\r\n        return new Promise(async(res:Function,rej:Function) => {\r\n\r\n            if(!category.fbcId) {\r\n                rej('Error')\r\n                return\r\n            }\r\n\r\n            try {\r\n                const response : RequestResponseState = await deleteFunctionBlockCategory(category.fbcId)\r\n                res(response)\r\n              }\r\n    \r\n            catch(err) {\r\n                rej(err)\r\n            }\r\n        })\r\n\r\n    }\r\n\r\n    const cancelEditing = () => setEditingCategory(null)\r\n    const showEditing = (cat: FBCategory) => setEditingCategory(cat)\r\n\r\n    const onGoodEditing = (editingCat: FBCategory) => {\r\n\r\n        const newCats = functionBlockCategories.map((cat: FBCategory) => {\r\n\r\n            if(cat.fbcId === editingCat.fbcId)\r\n                return {...cat, fbcName: editingCat.fbcName}\r\n            return cat\r\n\r\n        })\r\n        \r\n        cancelEditing()\r\n        dispatchFunctionBlockCategoriesActions(FunctionBlockCategoriesActions.updateFunctionBlockCategories(newCats))\r\n\r\n    }\r\n\r\n    return (\r\n        <Navigator title=\"Function Block Categories\">\r\n        <> \r\n            {error !== ''\r\n                ? <ConfirmAction title='Fetching Function Blocks' currentState={errorFetchngCategoriesState} states={{error: errorFetchngCategoriesState}} onCancel={onCancel}/>\r\n                : null \r\n            }\r\n            <LazyComponent loaded={!fetching}>\r\n                <>\r\n                    {confirmAddCategory \r\n                        ? <ConfirmAction {...confirmActionProps} /> \r\n                        : editingCategory \r\n                            ?  <EditFBCategoryDialog \r\n                                onGood={onGoodEditing}\r\n                                category={editingCategory}\r\n                                onError={cancelEditing}\r\n                                onCancel={cancelEditing} />\r\n                            : null\r\n                    }\r\n                    <Grid container direction=\"column\" spacing={2}>\r\n                        <Grid item>\r\n                            <JPTable\r\n                                sortedkey=\"fbcName\"\r\n                                data={getData()} \r\n                                updateData={updateFunctionBlockCategories} \r\n                                indexes={indexes}\r\n                                tName='Function Block Category'\r\n                                extra={{\r\n                                    delete: {\r\n                                        action: deleteFunctionBlockCategoryAction,\r\n                                        labelKey: 'fbcName',\r\n                                        onSuccessDelete: () => {}\r\n                                    },\r\n                                    edit: {\r\n                                        action: showEditing\r\n                                    }\r\n                                }} \r\n                            />\r\n                        </Grid>\r\n                        <Grid item>\r\n                            <Grid container justify=\"flex-end\" spacing={1}>\r\n                                <Grid item xs={4}>\r\n                                    <TextField\r\n                                        helperText={!validNewCategory ? NEW_CATEGORY_RE.toString() : ''}\r\n                                        error={!validNewCategory}\r\n                                        required\r\n                                        onChange={(event) => {\r\n                                            setNewCategory(event.target.value)\r\n                                            if(!validNewCategory)\r\n                                                setValidNewCategory(isCategoryValid(event.target.value.trim()))\r\n                                        }}\r\n                                        fullWidth\r\n                                        value={newCategory}\r\n                                    />\r\n                                </Grid>\r\n                                <Grid item>\r\n                                    <Button\r\n                                        color=\"primary\"\r\n                                        variant=\"contained\"\r\n                                        onClick={validateAndCreate}\r\n                                    >\r\n                                        Add Category\r\n                                    </Button>\r\n                                </Grid>\r\n                            </Grid>\r\n                        </Grid>\r\n                    </Grid>\r\n                </>\r\n            </LazyComponent>\r\n        </>\r\n        </Navigator>\r\n    )\r\n\r\n}"]},"metadata":{},"sourceType":"module"}