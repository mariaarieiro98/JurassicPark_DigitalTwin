{"ast":null,"code":"var _jsxFileName = \"/media/maria/96ae9a87-ebe3-48cb-a2c1-fae5fe76b9e7/maria/Marketplace-JurassicPark/backend/web/src/components/DigitalTwin/SmartComponent.tsx\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nimport React, { useEffect, useState, useCallback } from 'react';\nimport { useFunctionBlockStyles } from \"../FunctionBlocks/FunctionBlock/style\";\nimport { Grid, FormControl, InputLabel, Select, Button, MenuItem } from \"@material-ui/core\";\nimport { useMountEffect } from '../../utils/main';\nimport { getOrDownloadSmartComponents } from '../../utils/smartComponents';\nimport { useStore } from '../templates/Store/Store';\nimport { SmartComponentActions } from '../../redux/actions';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const SmartComponentList = /*#__PURE__*/React.memo(_c = _s(props => {\n  _s();\n\n  const {\n    smartComponents,\n    setSmartComponents,\n    onSmartComponentRemoval\n  } = props;\n  const classes = useFunctionBlockStyles();\n  const newSc = {\n    scId: -1,\n    scName: \"\",\n    scAddress: \"\",\n    scPort: -1\n  };\n  const [newSmartComponent, setNewSmartComponent] = useState(newSc);\n  const setSmartComponent = useCallback((smartComponent, index) => {\n    setSmartComponents(prevScs => {\n      console.log(\"entrei aqui\");\n      const oldSmartComponent = prevScs[index];\n      const newSmartComponents = [...prevScs];\n      newSmartComponents[index] = smartComponent;\n      return newSmartComponents;\n    });\n  }, [setSmartComponents]);\n  const addSmartComponent = useCallback(scToAdd => {\n    console.log(\"entrei aqui 1\");\n    console.log(\"scToAdd:\", scToAdd);\n    setSmartComponents(prevSmartComponents => [...prevSmartComponents, scToAdd]);\n    setNewSmartComponent(newSc);\n  }, [setSmartComponents, newSc]);\n  const removeSmartComponent = useCallback(smartComponentToRemove => {\n    console.log(\"entrei aqui 2\");\n    setSmartComponents(prevSmartComponents => prevSmartComponents.filter((smartComponent, index) => smartComponent !== smartComponentToRemove));\n    console.log(smartComponentToRemove);\n    onSmartComponentRemoval(smartComponentToRemove);\n  }, [onSmartComponentRemoval, setSmartComponents]);\n  console.log(\"newSc\", newSmartComponent);\n  return /*#__PURE__*/_jsxDEV(Grid, {\n    container: true,\n    direction: \"column\",\n    children: [/*#__PURE__*/_jsxDEV(Grid, {\n      item: true,\n      children: props.title\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 67,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Grid, {\n      item: true,\n      className: classes.box,\n      children: [smartComponents.map((smartComponent, index) => /*#__PURE__*/_jsxDEV(SmartComponentRow, {\n        index: index,\n        addRemoveSmartComponent: removeSmartComponent,\n        setSmartComponent: setSmartComponent,\n        smartComponent: smartComponent,\n        newSc: false\n      }, index, false, {\n        fileName: _jsxFileName,\n        lineNumber: 69,\n        columnNumber: 79\n      }, this)), /*#__PURE__*/_jsxDEV(SmartComponentRow, {\n        index: -1,\n        addRemoveSmartComponent: addSmartComponent,\n        setSmartComponent: setNewSmartComponent,\n        smartComponent: newSmartComponent,\n        newSc: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 70,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 68,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 66,\n    columnNumber: 5\n  }, this);\n}, \"nEPT5xElcQIY0XQYnP2j9DCOoCw=\", false, function () {\n  return [useFunctionBlockStyles];\n}));\n_c2 = SmartComponentList;\nconst SmartComponentRow = /*#__PURE__*/React.memo(_c3 = _s2(props => {\n  _s2();\n\n  const classes = useFunctionBlockStyles();\n  const [validName, setValidName] = useState(\"\");\n  const [fetching, setFetching] = useState(true);\n  const {\n    data: smartComponents,\n    dispatchAction: dispatchSmartComponentActions\n  } = useStore('smartComponents');\n\n  const updateSmartComponents = scs => dispatchSmartComponentActions(SmartComponentActions.updateSmartComponent(scs));\n\n  const [error, setError] = useState('');\n  const isValid = useCallback(() => props.smartComponent.scName !== '', [props.smartComponent]);\n\n  const action = () => {\n    if (!isValid() && props.newSc) setValidName(\"Mandatory\");else props.addRemoveSmartComponent(props.smartComponent);\n  }; //Verifica se o nome é válido\n\n\n  const validate = useCallback(() => {\n    !isValid() ? setValidName(\"Mandatory\") : setValidName('');\n  }, [isValid]);\n  useEffect(() => {\n    if (!props.newSc) validate();\n  }, [props.smartComponent.scName, props.smartComponent.scAddress, props.smartComponent.scPort, props.newSc, validate]);\n\n  const updateField = (field1, field2, field3) => event => {\n    props.setSmartComponent({ ...props.smartComponent,\n      [field1]: event.target.value.scName,\n      [field2]: event.target.value.scAddress,\n      [field3]: event.target.value.scPort\n    }, props.index);\n  }; // Recuperar diretamente da comunicação OPC-UA os smart_components disponíveis (SmartComponent)\n\n\n  useMountEffect(() => {\n    setTimeout(() => {\n      setFetching(true);\n      getOrDownloadSmartComponents(smartComponents).then(result => updateSmartComponents(result)).catch(e => setError(e.msg)).finally(() => setFetching(false));\n    }, 0);\n  });\n  return /*#__PURE__*/_jsxDEV(Grid, {\n    item: true,\n    xs: 12,\n    container: true,\n    direction: \"row\",\n    justify: \"space-between\",\n    alignItems: \"center\",\n    children: [props.order ? /*#__PURE__*/_jsxDEV(Grid, {\n      item: true,\n      xs: 12,\n      children: props.order\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 139,\n      columnNumber: 7\n    }, this) : null, /*#__PURE__*/_jsxDEV(Grid, {\n      item: true,\n      xs: 6,\n      children: /*#__PURE__*/_jsxDEV(FormControl, {\n        fullWidth: true,\n        required: true,\n        children: [/*#__PURE__*/_jsxDEV(InputLabel, {\n          id: `smart-component-label-${props.smartComponent}`\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 146,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Select, {\n          labelId: `smart-component-label-${props.smartComponent}`,\n          value: props.smartComponent,\n          onChange: updateField('scName', 'scAddress', 'scPort'),\n          children: (smartComponents || []).map(smartComponent => {\n            return /*#__PURE__*/_jsxDEV(MenuItem, {\n              value: smartComponent,\n              children: `${smartComponent.scAddress}, ${smartComponent.scName}, ${smartComponent.scPort}`\n            }, smartComponent, false, {\n              fileName: _jsxFileName,\n              lineNumber: 152,\n              columnNumber: 77\n            }, this);\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 147,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 145,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 144,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Grid, {\n      item: true,\n      xs: 1,\n      children: /*#__PURE__*/_jsxDEV(Button, {\n        className: classes.varEvButton,\n        size: \"small\",\n        variant: \"contained\",\n        onClick: action,\n        children: props.newSc ? '+' : 'x'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 157,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 156,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 137,\n    columnNumber: 5\n  }, this);\n}, \"luLnUB28zaZCTVZpdBdaWdamFfo=\", false, function () {\n  return [useFunctionBlockStyles, useStore, useMountEffect];\n}), (prevProps, nextProps) => prevProps.smartComponent === nextProps.smartComponent);\n_c4 = SmartComponentRow;\n\nvar _c, _c2, _c3, _c4;\n\n$RefreshReg$(_c, \"SmartComponentList$React.memo\");\n$RefreshReg$(_c2, \"SmartComponentList\");\n$RefreshReg$(_c3, \"SmartComponentRow$React.memo\");\n$RefreshReg$(_c4, \"SmartComponentRow\");","map":{"version":3,"sources":["/media/maria/96ae9a87-ebe3-48cb-a2c1-fae5fe76b9e7/maria/Marketplace-JurassicPark/backend/web/src/components/DigitalTwin/SmartComponent.tsx"],"names":["React","useEffect","useState","useCallback","useFunctionBlockStyles","Grid","FormControl","InputLabel","Select","Button","MenuItem","useMountEffect","getOrDownloadSmartComponents","useStore","SmartComponentActions","SmartComponentList","memo","props","smartComponents","setSmartComponents","onSmartComponentRemoval","classes","newSc","scId","scName","scAddress","scPort","newSmartComponent","setNewSmartComponent","setSmartComponent","smartComponent","index","prevScs","console","log","oldSmartComponent","newSmartComponents","addSmartComponent","scToAdd","prevSmartComponents","removeSmartComponent","smartComponentToRemove","filter","title","box","map","SmartComponentRow","validName","setValidName","fetching","setFetching","data","dispatchAction","dispatchSmartComponentActions","updateSmartComponents","scs","updateSmartComponent","error","setError","isValid","action","addRemoveSmartComponent","validate","updateField","field1","field2","field3","event","target","value","setTimeout","then","result","catch","e","msg","finally","order","varEvButton","prevProps","nextProps"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useCallback } from 'react'\nimport { useFunctionBlockStyles } from \"../FunctionBlocks/FunctionBlock/style\"\nimport { SmartComponent } from \"../../model/index\"\nimport { Grid, FormControl, InputLabel, Select, Button, MenuItem } from \"@material-ui/core\"\nimport { useMountEffect } from '../../utils/main'\nimport { getOrDownloadSmartComponents } from '../../utils/smartComponents'\nimport { RequestResponseState } from '../../services/api/api'\nimport { useStore } from '../templates/Store/Store'\nimport { SmartComponentActions } from '../../redux/actions'\nimport { ContactSupport } from '@material-ui/icons'\n\ninterface SmartComponentProps {\n  setSmartComponents: Function\n  smartComponents: SmartComponent[]\n  title: string\n  onSmartComponentRemoval: (smartComponent: SmartComponent) => void\n}\n\nexport const SmartComponentList = React.memo((props: SmartComponentProps) => {\n  \n  const {smartComponents,setSmartComponents,onSmartComponentRemoval} = props\n\n  const classes = useFunctionBlockStyles()\n\n  const newSc : SmartComponent = {\n    scId: -1,\n    scName: \"\",\n    scAddress: \"\",\n    scPort: -1,\n  }\n\n  const [newSmartComponent,setNewSmartComponent] : [SmartComponent,Function] = useState(newSc)\n\n  const setSmartComponent = useCallback((smartComponent: SmartComponent , index:number) => {\n\n    setSmartComponents((prevScs: SmartComponent[]) => {\n      console.log(\"entrei aqui\")\n      const oldSmartComponent : SmartComponent = prevScs[index]\n      const newSmartComponents : SmartComponent[] = [...prevScs]\n      newSmartComponents[index] = smartComponent\n      return newSmartComponents\n\n    }) \n\n  },[setSmartComponents])\n\n  const addSmartComponent = useCallback((scToAdd: SmartComponent) => {\n    console.log(\"entrei aqui 1\")\n\n    console.log(\"scToAdd:\",scToAdd)\n    setSmartComponents((prevSmartComponents: SmartComponent[]) =>[...prevSmartComponents, scToAdd])\n    setNewSmartComponent(newSc)\n\n  }, [setSmartComponents,newSc]) \n\n  const removeSmartComponent = useCallback((smartComponentToRemove:SmartComponent) => {\n    console.log(\"entrei aqui 2\")\n    setSmartComponents((prevSmartComponents: SmartComponent[]) => prevSmartComponents.filter((smartComponent:SmartComponent,index:number) => smartComponent !== smartComponentToRemove))\n    console.log(smartComponentToRemove)\n    onSmartComponentRemoval(smartComponentToRemove)\n  },[onSmartComponentRemoval,setSmartComponents]) \n  \n  console.log(\"newSc\", newSmartComponent)\n  \n  return (\n    <Grid container direction=\"column\">\n      <Grid item>{props.title}</Grid>\n      <Grid item className={classes.box}>\n        {smartComponents.map((smartComponent:SmartComponent, index:number) => <SmartComponentRow key={index} index={index} addRemoveSmartComponent={removeSmartComponent} setSmartComponent={setSmartComponent} smartComponent={smartComponent} newSc={false} />)}\n        <SmartComponentRow index={-1} addRemoveSmartComponent={addSmartComponent} setSmartComponent={setNewSmartComponent} smartComponent={newSmartComponent} newSc={true}  />\n      </Grid> \n    </Grid>\n  )\n})\n\ninterface SmartComponentRowProps {\n  index: number \n  addRemoveSmartComponent: (smartComponent: SmartComponent) => void\n  setSmartComponent:Function\n  smartComponent: SmartComponent\n  newSc: boolean\n  order?: number\n}\n\nconst SmartComponentRow = React.memo((props: SmartComponentRowProps) => {\n\n  const classes = useFunctionBlockStyles()\n\n  const [validName,setValidName] = useState(\"\")\n\n  const [fetching,setFetching] = useState(true)\n  const {data:smartComponents, dispatchAction:dispatchSmartComponentActions} = useStore('smartComponents')\n  const updateSmartComponents = (scs: SmartComponent[]) => dispatchSmartComponentActions(SmartComponentActions.updateSmartComponent(scs))\n  const [error,setError] = useState('')\n\n  const isValid = useCallback(() => props.smartComponent.scName!== '', [props.smartComponent])\n\n  const action = () => {\n\n    if(!isValid() && props.newSc) \n      setValidName(\"Mandatory\")\n    \n    else\n      props.addRemoveSmartComponent(props.smartComponent)\n    \n  }\n  \n  //Verifica se o nome é válido\n  const validate = useCallback(() => {\n    \n    !isValid() ? setValidName(\"Mandatory\") : setValidName('')\n\n  },[isValid]) \n\n  useEffect(() => {if(!props.newSc) validate()}, [props.smartComponent.scName, props.smartComponent.scAddress, props.smartComponent.scPort, props.newSc, validate])\n\n  const updateField = (field1:string, field2:string, field3:string) => (event:any) => {\n  \n    props.setSmartComponent({...props.smartComponent, [field1]: event.target.value.scName, [field2]: event.target.value.scAddress, [field3]: event.target.value.scPort}, props.index)\n  \n  }\n\n  // Recuperar diretamente da comunicação OPC-UA os smart_components disponíveis (SmartComponent)\n  useMountEffect(() => {\n\n    setTimeout(() => {\n  \n      setFetching(true)\n      getOrDownloadSmartComponents(smartComponents)\n          .then((result: SmartComponent[]) => updateSmartComponents(result))\n          .catch((e:RequestResponseState) => setError(e.msg))\n          .finally(() => setFetching(false))\n      }, 0)\n  })\n\n  return (\n    <Grid item xs={12} container direction=\"row\" justify=\"space-between\" alignItems=\"center\">\n      { props.order ?\n      <Grid item xs={12}>\n          {props.order}\n      </Grid>\n      : null\n      }\n      <Grid item xs={6}>\n        <FormControl fullWidth required>\n          <InputLabel id={`smart-component-label-${props.smartComponent}`}></InputLabel>\n            <Select\n              labelId={`smart-component-label-${props.smartComponent}`}\n              value={props.smartComponent}\n              onChange={updateField('scName','scAddress','scPort')}\n            >\n              {(smartComponents || []).map((smartComponent: any) => {return <MenuItem key={smartComponent} value={smartComponent}>{`${smartComponent.scAddress}, ${smartComponent.scName}, ${smartComponent.scPort}`}</MenuItem>})}\n            </Select>\n        </FormControl>\n      </Grid>\n      <Grid item xs={1}>\n        <Button \n          className={classes.varEvButton} \n          size=\"small\" \n          variant=\"contained\"\n          onClick={action}\n        >\n        {props.newSc ? '+' : 'x' }</Button>\n      </Grid>\n    </Grid>\n  )\n  }\n ,(prevProps:SmartComponentRowProps, nextProps: SmartComponentRowProps) => prevProps.smartComponent === nextProps.smartComponent\n)\n"]},"metadata":{},"sourceType":"module"}