{"ast":null,"code":"var _jsxFileName = \"/media/maria/96ae9a87-ebe3-48cb-a2c1-fae5fe76b9e7/maria/Marketplace-JurassicPark/backend/web/src/components/DigitalTwin/DigitalTwinMonitoring.tsx\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$(),\n    _s3 = $RefreshSig$();\n\nimport React, { useState } from 'react';\nimport { Navigator } from '../templates/Navigator/Navigator';\nimport { ConfirmAction, ConfirmActionStateLabel } from '../templates/ConfirmAction/ConfirmAction';\nimport { LazyComponent } from '../templates/LazyComponent/LazyComponent';\nimport { JPTable } from '../templates/Table/JPTable';\nimport { useMountEffect } from '../../utils/main';\nimport { getOrDownloadDigitalTwins, getOrDownloadFunctionalities, getOrDownloadMonitoredEvents, getOrDownloadMonitoredVariables } from '../../utils/digitalTwins';\nimport { getOrDownloadAssociatedSmartComponents } from '../../utils/associatedSmartComponents';\nimport { useStore } from '../templates/Store/Store';\nimport { FunctionalityActions, DigitalTwinActions, AssociatedSmartComponentActions, MonitoredVariableActions, MonitoredEventActions } from '../../redux/actions';\nimport { TextField, Grid, Button, Box, Dialog, DialogTitle, CircularProgress, Select, InputLabel, MenuItem, DialogContent, DialogContentText } from '@material-ui/core';\nimport { createFunctionality, createMonitoredEvent, createMonitoredVariable, deleteMonitoredEvent, updateFunctionality } from '../../services/api/digital-twin';\nimport { deleteFunctionality } from '../../services/api/digital-twin';\nimport { useDialogStyles } from '../FunctionBlockCategories/List/style';\nimport { useFunctionBlockStyles } from '../FunctionBlocks/FunctionBlock/style';\nimport { Redirect } from 'react-router-dom';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst NEW_FUNCTIONALITY_RE = /[a-zA-Z0-9]{3,}/;\nconst FUNCTION_BLOCK_RE = /[a-zA-Z0-9]{3,}/;\nconst VARIABLE_RE = /[a-zA-Z0-9]{3,}/;\nconst EVENT_RE = /[a-zA-Z0-9]{3,}/;\nlet functionalityId = -1;\nlet idMonitoredVariable = -1;\nlet idMonitoredEvent = -1;\nconst funcUserId = 1;\n\nconst EditFunctionalityDialog = props => {\n  _s();\n\n  const [newFuncName, setNewFuncName] = useState(props.func.funcName);\n  const classes = useDialogStyles();\n  const [sending, setSending] = useState(false);\n  const [result, setResult] = useState({\n    done: false\n  });\n  const [newSamplingTime, setNewSamplingTime] = useState('');\n  const useStyles = makeStyles(theme => ({\n    formControl: {\n      margin: theme.spacing(1),\n      minWidth: 120\n    },\n    selectEmpty: {\n      marginTop: theme.spacing(2)\n    }\n  }));\n\n  const action = () => {\n    if (props.func.funcId) {\n      if (!result.done) {\n        setSending(true);\n        updateFunctionality(props.func).then(response => {\n          setResult({\n            done: true,\n            good: true,\n            message: response.msg\n          });\n        }).catch(error => {\n          setResult({\n            done: true,\n            good: false,\n            message: error.msg\n          });\n        }).finally(() => setSending(false));\n      } else {\n        if (result.good) props.onGood({ ...props.func,\n          funcName: newFuncName\n        });else props.onError();\n      }\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: /*#__PURE__*/_jsxDEV(Dialog, {\n      open: true,\n      \"aria-labelledby\": \"form-dialog-title\",\n      children: [/*#__PURE__*/_jsxDEV(DialogTitle, {\n        id: \"form-dialog-title\",\n        children: \"Subscribe\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 100,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(DialogContent, {\n        children: [/*#__PURE__*/_jsxDEV(DialogContentText, {\n          children: \"To subscribe to this website, please enter your email address here. We will send updates occasionally.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 102,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(TextField, {\n          disabled: sending,\n          value: newFuncName,\n          onChange: event => setNewFuncName(event.target.value)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 106,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(Grid, {\n          item: true,\n          xs: 4,\n          children: [/*#__PURE__*/_jsxDEV(InputLabel, {\n            id: \"functionality-sampling-time\",\n            children: \"Sampling Time\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 112,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(Select, {\n            labelId: \"sampling-time-select-label\",\n            id: \"sampling-time-select\",\n            value: age,\n            onChange: handleChange,\n            children: [/*#__PURE__*/_jsxDEV(MenuItem, {\n              value: 10,\n              children: \"Ten\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 119,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(MenuItem, {\n              value: 15,\n              children: \"Fifteen\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 120,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(MenuItem, {\n              value: 20,\n              children: \"Twenty\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 121,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(MenuItem, {\n              value: 30,\n              children: \"Thirty\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 122,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(MenuItem, {\n              value: 40,\n              children: \"Fourty\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 123,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(MenuItem, {\n              value: 50,\n              children: \"Fifty\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 124,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(MenuItem, {\n              value: 60,\n              children: \"Sixty\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 125,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 113,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(InputLabel, {\n            id: `digital-twin-label-${newSamplingTime}`,\n            children: \"Sampling Time\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 127,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(Select, {\n            labelId: `digital-twin-label-${newSamplingTime}`,\n            value: digitalTwinChoice,\n            onChange: handleDigitalTwinChoice,\n            children: (digitalTwins || []).map(digitalTwin => {\n              return /*#__PURE__*/_jsxDEV(MenuItem, {\n                value: digitalTwin.dtName,\n                children: digitalTwin.dtName\n              }, digitalTwin.dtId, false, {\n                fileName: _jsxFileName,\n                lineNumber: 129,\n                columnNumber: 85\n              }, this);\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 128,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 111,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 101,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 98,\n    columnNumber: 9\n  }, this) //   <Dialog open={true}>\n  //       <DialogTitle>Edit Functionality</DialogTitle>\n  //       <Box className={classes.box}>\n  //         {\n  //             !result.done \n  //             ?\n  //                 <TextField \n  //                     disabled={sending}\n  //                     value={newFuncName}\n  //                     onChange={(event) => setNewFuncName(event.target.value)}\n  //                 />    \n  //             :   \n  //                 <Grid container justify=\"center\">\n  //                     <Grid item>\n  //                     {\n  //                         result.good \n  //                         ?   <CheckCircle color=\"primary\" />\n  //                             :   <Error color=\"error\" />\n  //                     }\n  //                     </Grid>\n  //                         <Grid item>\n  //                             <Box className={result.good ? classes.good : classes.error} textAlign=\"center\">{result.message}</Box>\n  //                         </Grid>\n  //                 </Grid> \n  //         }\n  //       </Box>\n  //       <Grid className={classes.buttons} container direction=\"row\" justify=\"space-between\">\n  //           <Grid item>\n  //               {sending \n  //                   ? <CircularProgress color=\"primary\" />\n  //                   : <Button onClick={action}>Ok</Button>\n  //               }\n  //           </Grid>\n  //           <Grid item>\n  //               <Button disabled={sending} onClick={props.onCancel}>Cancel</Button>\n  //           </Grid>\n  //       </Grid>\n  //   </Dialog>\n  ;\n};\n\n_s(EditFunctionalityDialog, \"wIm/Y6RYR9FxVgxSRSg/2HIpvPw=\", false, function () {\n  return [useDialogStyles];\n});\n\n_c = EditFunctionalityDialog;\n\nconst AddFunctionalityDetails = props => {\n  _s2();\n\n  const [newFuncName, setNewFuncName] = useState(props.func.funcName);\n  const classes = useDialogStyles();\n  const [sending, setSending] = useState(false);\n  const [result, setResult] = useState({\n    done: false\n  });\n  const [fetching, setFetching] = useState(true);\n  const {\n    data: associatedSmartComponents,\n    dispatchAction: dispatchAssociatedSmartComponentActions\n  } = useStore('associatedSmartComponents');\n\n  const updateAssociatedSmartComponents = assScs => dispatchAssociatedSmartComponentActions(AssociatedSmartComponentActions.updateAssociatedSmartComponents(assScs));\n\n  const [error, setError] = useState('');\n  const [availableSmartComponents, setAvailableSmartComponents] = useState([]); // Recuperar da base de dados os Smart Components Associados ao Digital Twin associado\n\n  useMountEffect(() => {\n    setTimeout(() => {\n      setFetching(true);\n      getOrDownloadAssociatedSmartComponents(associatedSmartComponents).then(result => updateAssociatedSmartComponents(result)).catch(e => setError(e.msg)).finally(() => setFetching(false));\n    }, 0);\n  });\n  let i = 0;\n\n  while (i < associatedSmartComponents.length) {\n    if (associatedSmartComponents[i].scDtId === props.func.funcdtId) {\n      availableSmartComponents[i] = associatedSmartComponents[i];\n    }\n\n    i++;\n  } // Escolher um AssociatedSmartComponent de dentro dos disponíveis pelo DT respectivo \n\n\n  const [smartComponentChoice, setSmartComponentChoice] = useState('');\n  const [smartComponentIdChoice, setSmartComponentIdChoice] = useState(0);\n\n  const handleSmartComponentChoice = event => {\n    setSmartComponentChoice(event.target.value);\n    let j = 0;\n\n    while (j < associatedSmartComponents.length) {\n      if (associatedSmartComponents[j].scName === event.target.value) {\n        setSmartComponentIdChoice(associatedSmartComponents[j].scId);\n      }\n\n      j++;\n    }\n  }; //Variáveis e funções de apoio à escolha do Function Block\n\n\n  const [validFunctionBlock, setValidFunctionBlock] = useState(true);\n  const [newFb, setNewFb] = useState('');\n\n  const isFunctionBlockValid = fb => NEW_FUNCTIONALITY_RE.test(fb); //Variáveis e funções de apoio à escolha da Variable\n\n\n  const [validVariable, setValidVariable] = useState(true);\n  const [newVariable, setNewVariable] = useState('');\n\n  const isVariableValid = variable => VARIABLE_RE.test(variable);\n\n  const buildMonitoredVariable = funcId => ({\n    monitoredVariableName: newVariable,\n    fbAssociated: newFb,\n    funcIdAssociated: funcId,\n    idMonitoredVariable: idMonitoredVariable,\n    scAssociated: smartComponentChoice\n  }); //Variáveis e funções de apoio à escolha do Event\n\n\n  const [validEvent, setValidEvent] = useState(true);\n  const [newEvent, setNewEvent] = useState('');\n\n  const isEventValid = event => EVENT_RE.test(event);\n\n  const buildMonitoredEvent = funcId => ({\n    monitoredEventName: newEvent,\n    fbAssociated: newFb,\n    funcIdAssociated: funcId,\n    idMonitoredEvent: idMonitoredEvent,\n    scAssociated: smartComponentChoice\n  }); //Função de atualização da database com os dados escolhidos \n\n\n  const action = () => {\n    let funcId = props.func.funcId;\n    const monitoredVariable = buildMonitoredVariable(funcId);\n    const monitoredEvent = buildMonitoredEvent(funcId);\n    console.log(monitoredVariable);\n\n    if (props.func.funcId) {\n      if (!result.done) {\n        setSending(true);\n        updateFunctionality(props.func).then(response => {\n          setResult({\n            done: true,\n            good: true,\n            message: response.msg\n          });\n        }).catch(error => {\n          setResult({\n            done: true,\n            good: false,\n            message: error.msg\n          });\n        });\n\n        if (newVariable != '') {\n          createMonitoredVariable(monitoredVariable).then(response => {\n            setResult({\n              done: true,\n              good: true,\n              message: response.msg\n            });\n          }).catch(error => {\n            setResult({\n              done: true,\n              good: false,\n              message: error.msg\n            });\n          });\n        }\n\n        if (newEvent != '') {\n          createMonitoredEvent(monitoredEvent).then(response => {\n            setResult({\n              done: true,\n              good: true,\n              message: response.msg\n            });\n          }).catch(error => {\n            setResult({\n              done: true,\n              good: false,\n              message: error.msg\n            });\n          });\n        }\n      } else {\n        if (result.good) {\n          props.onGood({ ...props.func,\n            funcName: newFuncName\n          });\n        } else props.onError();\n      }\n    }\n\n    props.onCancel();\n    document.location.reload(true);\n  };\n\n  return /*#__PURE__*/_jsxDEV(Dialog, {\n    open: true,\n    children: [/*#__PURE__*/_jsxDEV(DialogTitle, {\n      children: \"Add Functionality Details\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 333,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(Box, {\n      className: classes.box,\n      children: [/*#__PURE__*/_jsxDEV(Grid, {\n        item: true,\n        children: /*#__PURE__*/_jsxDEV(Grid, {\n          container: true,\n          item: true,\n          xs: true,\n          children: /*#__PURE__*/_jsxDEV(Grid, {\n            className: classes.box,\n            spacing: 3,\n            item: true,\n            container: true,\n            direction: \"column\",\n            alignItems: \"flex-start\",\n            children: [/*#__PURE__*/_jsxDEV(Grid, {\n              item: true,\n              xs: 12,\n              sm: 6,\n              children: [/*#__PURE__*/_jsxDEV(InputLabel, {\n                id: `smart-component-label-${availableSmartComponents}`,\n                children: \"DINASORE\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 340,\n                columnNumber: 29\n              }, this), /*#__PURE__*/_jsxDEV(Select, {\n                labelId: `smart-component-label-${availableSmartComponents}`,\n                value: smartComponentChoice,\n                onChange: handleSmartComponentChoice,\n                children: (availableSmartComponents || []).map(sc => {\n                  return /*#__PURE__*/_jsxDEV(MenuItem, {\n                    value: sc.scName,\n                    children: sc.scName\n                  }, sc.scId, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 342,\n                    columnNumber: 88\n                  }, this);\n                })\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 341,\n                columnNumber: 29\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 339,\n              columnNumber: 25\n            }, this), /*#__PURE__*/_jsxDEV(Grid, {\n              item: true,\n              xs: 12,\n              sm: 6,\n              children: /*#__PURE__*/_jsxDEV(TextField, {\n                label: \"Function Block\",\n                helperText: !validFunctionBlock ? FUNCTION_BLOCK_RE.toString() : '',\n                error: !validFunctionBlock,\n                required: true,\n                onChange: event => {\n                  setNewFb(event.target.value);\n                  if (!validFunctionBlock) setValidFunctionBlock(isFunctionBlockValid(event.target.value.trim()));\n                },\n                fullWidth: true,\n                value: newFb\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 346,\n                columnNumber: 29\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 345,\n              columnNumber: 25\n            }, this), /*#__PURE__*/_jsxDEV(Grid, {\n              item: true,\n              xs: 12,\n              sm: 6,\n              children: /*#__PURE__*/_jsxDEV(TextField, {\n                label: \"Variable\",\n                helperText: !validVariable ? VARIABLE_RE.toString() : '',\n                error: !validVariable,\n                required: true,\n                onChange: event => {\n                  setNewVariable(event.target.value);\n                  if (!validVariable) setValidVariable(isVariableValid(event.target.value.trim()));\n                },\n                fullWidth: true,\n                value: newVariable\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 361,\n                columnNumber: 29\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 360,\n              columnNumber: 25\n            }, this), /*#__PURE__*/_jsxDEV(Grid, {\n              item: true,\n              xs: 12,\n              sm: 6,\n              children: /*#__PURE__*/_jsxDEV(TextField, {\n                label: \"Event\",\n                helperText: !validEvent ? EVENT_RE.toString() : '',\n                error: !validEvent,\n                required: true,\n                onChange: event => {\n                  setNewEvent(event.target.value);\n                  if (!validEvent) setValidEvent(isEventValid(event.target.value.trim()));\n                },\n                fullWidth: true,\n                value: newEvent\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 376,\n                columnNumber: 29\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 375,\n              columnNumber: 25\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 338,\n            columnNumber: 21\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 337,\n          columnNumber: 17\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 335,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(Grid, {\n        className: classes.buttons,\n        container: true,\n        direction: \"row\",\n        justify: \"space-between\",\n        children: [/*#__PURE__*/_jsxDEV(Grid, {\n          item: true,\n          children: sending ? /*#__PURE__*/_jsxDEV(CircularProgress, {\n            color: \"primary\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 396,\n            columnNumber: 27\n          }, this) : /*#__PURE__*/_jsxDEV(Button, {\n            onClick: action,\n            children: \"Ok\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 397,\n            columnNumber: 27\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 394,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(Grid, {\n          item: true,\n          children: /*#__PURE__*/_jsxDEV(Button, {\n            disabled: sending,\n            onClick: props.onCancel,\n            children: \"Cancel\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 401,\n            columnNumber: 21\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 400,\n          columnNumber: 17\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 393,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 334,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 332,\n    columnNumber: 9\n  }, this);\n};\n\n_s2(AddFunctionalityDetails, \"lNhY3ul82GyaswiwXfjATeWRg3I=\", false, function () {\n  return [useDialogStyles, useStore, useMountEffect];\n});\n\n_c2 = AddFunctionalityDetails;\nexport const DigitalTwinMonitoring = () => {\n  _s3();\n\n  const classes = useFunctionBlockStyles();\n  const [fetching, setFetching] = useState(true);\n  const [error, setError] = useState('');\n  const [newFunc, setNewFunc] = useState('');\n  const [confirmEditing, setConfirmEditing] = useState(false);\n  const [confirmAddFunc, setConfirmAddFunc] = useState(false);\n  const [validNewFunc, setValidNewFunc] = useState(true);\n  const errorFetchingFunctionalityState = {\n    label: error,\n    state: ConfirmActionStateLabel.error,\n    positiveLabel: 'Ok'\n  };\n  const [redirectTo, setRedirectTo] = useState(-1);\n  const {\n    data: functionalities,\n    dispatchAction: dispatchFunctionalityActions\n  } = useStore('functionalities');\n  const {\n    data: digitalTwins,\n    dispatchAction: dispatchDigitalTwinActions\n  } = useStore('digitalTwins');\n  const {\n    data: monitoredVariables,\n    dispatchAction: dispatchMonitoredVariableActions\n  } = useStore('monitoredVariables');\n  const {\n    data: monitoredEvents,\n    dispatchAction: dispatchMonitoredEventActions\n  } = useStore('monitoredEvents');\n\n  const onCancel = () => setError('');\n\n  const updateFunctionalities = funcs => dispatchFunctionalityActions(FunctionalityActions.updateFunctionalities(funcs));\n\n  const updateDigitalTwins = dts => dispatchDigitalTwinActions(DigitalTwinActions.updateDigitalTwins(dts));\n\n  const updateMonitoredVariables = monVars => dispatchMonitoredVariableActions(MonitoredVariableActions.updateMonitoredVariable(monVars));\n\n  const updateMonitoredEvents = monEvs => dispatchMonitoredEventActions(MonitoredEventActions.updateMonitoredEvent(monEvs));\n\n  const addFunc = () => dispatchFunctionalityActions(FunctionalityActions.addFunctionality({\n    funcId: functionalityId,\n    funcUserId: 1,\n    funcName: newFunc,\n    funcdtId: 1\n  }));\n\n  const [editingFunc, setEditingFunc] = useState(null);\n  const [addDetailsFunc, setAddDetailsFunc] = useState(null);\n  const indexes = [{\n    label: 'Functionality',\n    key: 'funcName'\n  }, {\n    label: 'Digital Twin',\n    key: 'dtName'\n  }]; // Recuperar da base de dados as funcionalidades (Functionality)\n\n  useMountEffect(() => {\n    setTimeout(() => {\n      setFetching(true);\n      getOrDownloadFunctionalities(functionalities).then(result => updateFunctionalities(result)).catch(e => setError(e.msg)).finally(() => setFetching(false));\n    }, 0);\n  }); // Recuperar da base de dados os digital twins (DigitalTwin)\n\n  useMountEffect(() => {\n    setTimeout(() => {\n      setFetching(true);\n      getOrDownloadDigitalTwins(digitalTwins).then(result => updateDigitalTwins(result)).catch(e => setError(e.msg)).finally(() => setFetching(false));\n    }, 0);\n  });\n\n  const isFunctionalityValid = func => NEW_FUNCTIONALITY_RE.test(func);\n\n  const validateAndCreate = () => {\n    const validFunc = isFunctionalityValid(newFunc);\n    if (!validFunc) setValidNewFunc(false);else {\n      setConfirmAddFunc(true);\n    }\n  };\n\n  const buildFunctionality = () => ({\n    funcName: newFunc,\n    funcId: functionalityId,\n    funcdtId: digitalTwinIdChoice,\n    funcUserId,\n    funcdtName: digitalTwinChoice\n  });\n\n  const addNewFunctionalityAction = () => {\n    const functionality = buildFunctionality();\n    return new Promise((res, rej) => {\n      createFunctionality(functionality).then(result => {\n        functionalityId = result.extra.lastInsertedId;\n        res('Functionality created');\n      }).catch(e => rej(e.msg));\n    });\n  };\n\n  const confirmFunctionalityCreationActionStates = {\n    start: {\n      label: `Confirm creation of new functionality: ${newFunc} ?`,\n      positiveLabel: 'Ok',\n      negativeLabel: 'Cancel',\n      state: ConfirmActionStateLabel.start\n    },\n    executing: {\n      label: '',\n      state: ConfirmActionStateLabel.executing\n    },\n    success: {\n      label: 'Functionality Created',\n      state: ConfirmActionStateLabel.success,\n      positiveLabel: 'Ok'\n    },\n    error: {\n      label: 'Error Creating Functionality',\n      state: ConfirmActionStateLabel.error,\n      positiveLabel: 'Ok'\n    }\n  };\n  const confirmActionProps = {\n    title: 'Add Functionality',\n    states: confirmFunctionalityCreationActionStates,\n    currentState: confirmFunctionalityCreationActionStates.start,\n    onCancel: () => setConfirmAddFunc(false),\n    onError: () => setConfirmAddFunc(false),\n    onSuccess: () => {\n      addFunc();\n      setNewFunc('');\n      document.location.reload(true);\n    },\n    action: addNewFunctionalityAction\n  };\n\n  const getDataFunctionality = () => functionalities.map(functionality => {\n    return { ...functionality\n    };\n  }); // Recuperar da base de dados os monitoredEvents (MonitoredEvent)\n\n\n  useMountEffect(() => {\n    setTimeout(() => {\n      setFetching(true);\n      getOrDownloadMonitoredEvents(monitoredEvents).then(result => updateMonitoredEvents(result)).catch(e => setError(e.msg)).finally(() => setFetching(false));\n    }, 0);\n  }); // Recuperar da base de dados as monitoredVariables (MonitoredVariable)\n\n  useMountEffect(() => {\n    setTimeout(() => {\n      setFetching(true);\n      getOrDownloadMonitoredVariables(monitoredVariables).then(result => updateMonitoredVariables(result)).catch(e => setError(e.msg)).finally(() => setFetching(false));\n    }, 0);\n  });\n\n  const deleteFunctionalityAction = func => {\n    return new Promise(async (res, rej) => {\n      //let monitoredVariablesToDelete = []\n      let monitoredEventsToDelete = [];\n      let i = 0; // while(i < monitoredVariables.length) {\n      //     if(monitoredVariables[i].funcIdAssociated === func.funcId){\n      //         monitoredVariablesToDelete.push(monitoredVariables[i])\n      //     } \n      //     i++\n      // }   \n\n      i = 0;\n\n      while (i < monitoredEvents.length) {\n        if (monitoredEvents[i].funcIdAssociated === func.funcId) {\n          monitoredEventsToDelete.push(monitoredEvents[i]);\n        }\n\n        i++;\n      } //console.log(monitoredVariablesToDelete)\n\n\n      console.log(monitoredEventsToDelete);\n\n      if (!func.funcId) {\n        rej('Error');\n        return;\n      }\n\n      try {\n        const response = await deleteFunctionality(func.funcId); // i=0\n        // while(i < monitoredVariablesToDelete.length){\n        //     console.log(\"entrei aqui\")\n        //     const response1 : RequestResponseState = await deleteMonitoredVariable(monitoredVariablesToDelete[i].idMonitoredVariable)\n        //     res(response1)\n        //     i++\n        // }\n\n        i = 0;\n\n        while (i < monitoredEventsToDelete.length) {\n          const response1 = await deleteMonitoredEvent(monitoredEventsToDelete[i].idMonitoredEvent);\n          i++;\n        }\n\n        res(response);\n      } catch (err) {\n        rej(err);\n      }\n    });\n  }; //Adicionar Detalhes à Funcionalidade\n\n\n  const cancelAddDetails = () => setAddDetailsFunc(null);\n\n  const showAddDetails = func => setAddDetailsFunc(func); //Editar a Funcionalidade\n\n\n  const cancelEditing = () => setEditingFunc(null);\n\n  const showEditing = func => setEditingFunc(func);\n\n  const onGoodEditing = editingFunctionality => {\n    const newFunctionalities = functionalities.map(func => {\n      if (func.funcId === editingFunctionality.funcId) return { ...func,\n        funcName: editingFunctionality.funcName,\n        funcdtId: editingFunctionality.funcdtId\n      };\n      return func;\n    });\n    cancelEditing();\n    dispatchFunctionalityActions(FunctionalityActions.updateFunctionalities(newFunctionalities));\n  }; // Associar um digital twin à nova funcionalidade criada\n\n\n  const [digitalTwinChoice, setDigitalTwinChoice] = useState('');\n  const [digitalTwinIdChoice, setDigitalTwinIdChoice] = useState(0);\n\n  const handleDigitalTwinChoice = event => {\n    setDigitalTwinChoice(event.target.value);\n    let i = 0;\n\n    while (i < digitalTwins.length) {\n      if (digitalTwins[i].dtName === event.target.value) {\n        setDigitalTwinIdChoice(digitalTwins[i].dtId);\n      }\n\n      i++;\n    }\n  };\n\n  const redirectToList = func => {\n    setRedirectTo(func.funcId);\n  };\n\n  const indexes_test = [{\n    label: 'delete',\n    key: 'delete'\n  }];\n  if (redirectTo !== -1) return /*#__PURE__*/_jsxDEV(Redirect, {\n    to: `/functionality-details/${redirectTo}`,\n    push: true\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 696,\n    columnNumber: 11\n  }, this);\n  return /*#__PURE__*/_jsxDEV(Navigator, {\n    title: \"Digital Twin Monitoring\",\n    children: /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [error !== '' ? /*#__PURE__*/_jsxDEV(ConfirmAction, {\n        title: \"Fetching Functionalities\",\n        currentState: errorFetchingFunctionalityState,\n        states: {\n          error: errorFetchingFunctionalityState\n        },\n        onCancel: onCancel\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 702,\n        columnNumber: 19\n      }, this) : null, /*#__PURE__*/_jsxDEV(LazyComponent, {\n        loaded: !fetching,\n        children: /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [confirmEditing ? /*#__PURE__*/_jsxDEV(ConfirmAction, { ...confirmActionProps\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 708,\n            columnNumber: 19\n          }, this) : editingFunc ? /*#__PURE__*/_jsxDEV(EditFunctionalityDialog, {\n            onGood: onGoodEditing,\n            func: editingFunc,\n            onError: cancelEditing,\n            onCancel: cancelEditing\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 710,\n            columnNumber: 19\n          }, this) : null, confirmAddFunc ? /*#__PURE__*/_jsxDEV(ConfirmAction, { ...confirmActionProps\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 718,\n            columnNumber: 19\n          }, this) : addDetailsFunc ? /*#__PURE__*/_jsxDEV(AddFunctionalityDetails, {\n            onGood: onGoodEditing,\n            func: addDetailsFunc,\n            onError: cancelAddDetails,\n            onCancel: cancelAddDetails\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 720,\n            columnNumber: 20\n          }, this) : null, /*#__PURE__*/_jsxDEV(Grid, {\n            container: true,\n            direction: \"column\",\n            spacing: 2,\n            children: [/*#__PURE__*/_jsxDEV(Grid, {\n              item: true,\n              children: /*#__PURE__*/_jsxDEV(JPTable, {\n                sortedkey: \"funcName\",\n                data: getDataFunctionality(),\n                updateData: updateFunctionalities,\n                indexes: indexes,\n                tName: \"Functionality\",\n                extra: {\n                  delete: {\n                    action: deleteFunctionalityAction,\n                    labelKey: 'funcName',\n                    onSuccessDelete: () => {}\n                  },\n                  edit: {\n                    action: showEditing\n                  },\n                  details: {\n                    action: redirectToList\n                  },\n                  add: {\n                    action: showAddDetails\n                  }\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 729,\n                columnNumber: 21\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 728,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(Grid, {\n              item: true,\n              xs: true,\n              children: \"New Functionality\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 753,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(Grid, {\n              item: true,\n              children: /*#__PURE__*/_jsxDEV(Grid, {\n                container: true,\n                item: true,\n                xs: true,\n                children: /*#__PURE__*/_jsxDEV(Grid, {\n                  className: classes.box,\n                  spacing: 1,\n                  item: true,\n                  container: true,\n                  direction: \"row\",\n                  children: [/*#__PURE__*/_jsxDEV(Grid, {\n                    item: true,\n                    xs: 4,\n                    children: /*#__PURE__*/_jsxDEV(TextField, {\n                      helperText: !validNewFunc ? NEW_FUNCTIONALITY_RE.toString() : '',\n                      error: !validNewFunc,\n                      label: \"Insert new functionality name\",\n                      required: true,\n                      onChange: event => {\n                        setNewFunc(event.target.value);\n                        if (!validNewFunc) setValidNewFunc(isFunctionalityValid(event.target.value.trim()));\n                      },\n                      fullWidth: true,\n                      value: newFunc\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 760,\n                      columnNumber: 33\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 759,\n                    columnNumber: 29\n                  }, this), /*#__PURE__*/_jsxDEV(Grid, {\n                    item: true,\n                    xs: 4,\n                    children: [/*#__PURE__*/_jsxDEV(InputLabel, {\n                      id: `digital-twin-label-${newFunc}`,\n                      children: \"Digital Twin\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 775,\n                      columnNumber: 33\n                    }, this), /*#__PURE__*/_jsxDEV(Select, {\n                      labelId: `digital-twin-label-${newFunc}`,\n                      value: digitalTwinChoice,\n                      onChange: handleDigitalTwinChoice,\n                      children: (digitalTwins || []).map(digitalTwin => {\n                        return /*#__PURE__*/_jsxDEV(MenuItem, {\n                          value: digitalTwin.dtName,\n                          children: digitalTwin.dtName\n                        }, digitalTwin.dtId, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 777,\n                          columnNumber: 89\n                        }, this);\n                      })\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 776,\n                      columnNumber: 33\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 774,\n                    columnNumber: 29\n                  }, this), /*#__PURE__*/_jsxDEV(Grid, {\n                    container: true,\n                    justify: \"flex-end\",\n                    spacing: 1,\n                    children: /*#__PURE__*/_jsxDEV(Grid, {\n                      item: true,\n                      children: /*#__PURE__*/_jsxDEV(Button, {\n                        color: \"primary\",\n                        variant: \"contained\",\n                        onClick: validateAndCreate,\n                        children: \"Add Functionality\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 782,\n                        columnNumber: 37\n                      }, this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 781,\n                      columnNumber: 33\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 780,\n                    columnNumber: 29\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 758,\n                  columnNumber: 25\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 757,\n                columnNumber: 21\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 756,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 727,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 705,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 699,\n    columnNumber: 5\n  }, this);\n};\n\n_s3(DigitalTwinMonitoring, \"APjwpUVNdQwFER5Byig6pa0Rog4=\", false, function () {\n  return [useFunctionBlockStyles, useStore, useStore, useStore, useStore, useMountEffect, useMountEffect, useMountEffect, useMountEffect];\n});\n\n_c3 = DigitalTwinMonitoring;\n\nvar _c, _c2, _c3;\n\n$RefreshReg$(_c, \"EditFunctionalityDialog\");\n$RefreshReg$(_c2, \"AddFunctionalityDetails\");\n$RefreshReg$(_c3, \"DigitalTwinMonitoring\");","map":{"version":3,"sources":["/media/maria/96ae9a87-ebe3-48cb-a2c1-fae5fe76b9e7/maria/Marketplace-JurassicPark/backend/web/src/components/DigitalTwin/DigitalTwinMonitoring.tsx"],"names":["React","useState","Navigator","ConfirmAction","ConfirmActionStateLabel","LazyComponent","JPTable","useMountEffect","getOrDownloadDigitalTwins","getOrDownloadFunctionalities","getOrDownloadMonitoredEvents","getOrDownloadMonitoredVariables","getOrDownloadAssociatedSmartComponents","useStore","FunctionalityActions","DigitalTwinActions","AssociatedSmartComponentActions","MonitoredVariableActions","MonitoredEventActions","TextField","Grid","Button","Box","Dialog","DialogTitle","CircularProgress","Select","InputLabel","MenuItem","DialogContent","DialogContentText","createFunctionality","createMonitoredEvent","createMonitoredVariable","deleteMonitoredEvent","updateFunctionality","deleteFunctionality","useDialogStyles","useFunctionBlockStyles","Redirect","NEW_FUNCTIONALITY_RE","FUNCTION_BLOCK_RE","VARIABLE_RE","EVENT_RE","functionalityId","idMonitoredVariable","idMonitoredEvent","funcUserId","EditFunctionalityDialog","props","newFuncName","setNewFuncName","func","funcName","classes","sending","setSending","result","setResult","done","newSamplingTime","setNewSamplingTime","useStyles","makeStyles","theme","formControl","margin","spacing","minWidth","selectEmpty","marginTop","action","funcId","then","response","good","message","msg","catch","error","finally","onGood","onError","event","target","value","age","handleChange","digitalTwinChoice","handleDigitalTwinChoice","digitalTwins","map","digitalTwin","dtName","dtId","AddFunctionalityDetails","fetching","setFetching","data","associatedSmartComponents","dispatchAction","dispatchAssociatedSmartComponentActions","updateAssociatedSmartComponents","assScs","setError","availableSmartComponents","setAvailableSmartComponents","setTimeout","e","i","length","scDtId","funcdtId","smartComponentChoice","setSmartComponentChoice","smartComponentIdChoice","setSmartComponentIdChoice","handleSmartComponentChoice","j","scName","scId","validFunctionBlock","setValidFunctionBlock","newFb","setNewFb","isFunctionBlockValid","fb","test","validVariable","setValidVariable","newVariable","setNewVariable","isVariableValid","variable","buildMonitoredVariable","monitoredVariableName","fbAssociated","funcIdAssociated","scAssociated","validEvent","setValidEvent","newEvent","setNewEvent","isEventValid","buildMonitoredEvent","monitoredEventName","monitoredVariable","monitoredEvent","console","log","onCancel","document","location","reload","box","sc","toString","trim","buttons","DigitalTwinMonitoring","newFunc","setNewFunc","confirmEditing","setConfirmEditing","confirmAddFunc","setConfirmAddFunc","validNewFunc","setValidNewFunc","errorFetchingFunctionalityState","label","state","positiveLabel","redirectTo","setRedirectTo","functionalities","dispatchFunctionalityActions","dispatchDigitalTwinActions","monitoredVariables","dispatchMonitoredVariableActions","monitoredEvents","dispatchMonitoredEventActions","updateFunctionalities","funcs","updateDigitalTwins","dts","updateMonitoredVariables","monVars","updateMonitoredVariable","updateMonitoredEvents","monEvs","updateMonitoredEvent","addFunc","addFunctionality","editingFunc","setEditingFunc","addDetailsFunc","setAddDetailsFunc","indexes","key","isFunctionalityValid","validateAndCreate","validFunc","buildFunctionality","digitalTwinIdChoice","funcdtName","addNewFunctionalityAction","functionality","Promise","res","rej","extra","lastInsertedId","confirmFunctionalityCreationActionStates","start","negativeLabel","executing","success","confirmActionProps","title","states","currentState","onSuccess","getDataFunctionality","deleteFunctionalityAction","monitoredEventsToDelete","push","response1","err","cancelAddDetails","showAddDetails","cancelEditing","showEditing","onGoodEditing","editingFunctionality","newFunctionalities","setDigitalTwinChoice","setDigitalTwinIdChoice","redirectToList","indexes_test","delete","labelKey","onSuccessDelete","edit","details","add"],"mappings":"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","sourcesContent":["import React, { useState } from 'react'\r\nimport { Navigator } from '../templates/Navigator/Navigator'\r\nimport { ConfirmAction, ConfirmActionState, ConfirmActionStateLabel, ConfirmActionProps } from '../templates/ConfirmAction/ConfirmAction'\r\nimport { LazyComponent } from '../templates/LazyComponent/LazyComponent'\r\nimport { JPTable } from '../templates/Table/JPTable'\r\nimport { Functionality, DigitalTwin, AssociatedSmartComponent, MonitoredVariable, MonitoredEvent} from '../../model'\r\nimport { useMountEffect } from '../../utils/main'\r\nimport { getOrDownloadDigitalTwins, getOrDownloadFunctionalities, getOrDownloadMonitoredEvents, getOrDownloadMonitoredVariables} from '../../utils/digitalTwins'\r\nimport { getOrDownloadAssociatedSmartComponents } from '../../utils/associatedSmartComponents'\r\nimport { useStore } from '../templates/Store/Store'\r\nimport { FunctionalityActions , DigitalTwinActions, AssociatedSmartComponentActions, MonitoredVariableActions, MonitoredEventActions} from '../../redux/actions'\r\nimport { RequestResponseState } from '../../services/api/api'\r\nimport { TextField, Grid, Button, Box, Dialog, DialogTitle, CircularProgress , Select, InputLabel, MenuItem, DialogContent, DialogActions, DialogContentText, FormControl } from '@material-ui/core'\r\nimport { createFunctionality, createMonitoredEvent, createMonitoredVariable, deleteMonitoredEvent, updateFunctionality } from '../../services/api/digital-twin'\r\nimport { deleteFunctionality} from '../../services/api/digital-twin'\r\nimport { useDialogStyles } from '../FunctionBlockCategories/List/style'\r\nimport { CheckCircle, Error } from '@material-ui/icons'\r\nimport { useFunctionBlockStyles } from '../FunctionBlocks/FunctionBlock/style'\r\nimport { Redirect } from 'react-router-dom'\r\n\r\nconst NEW_FUNCTIONALITY_RE = /[a-zA-Z0-9]{3,}/\r\nconst FUNCTION_BLOCK_RE = /[a-zA-Z0-9]{3,}/\r\nconst VARIABLE_RE = /[a-zA-Z0-9]{3,}/\r\nconst EVENT_RE = /[a-zA-Z0-9]{3,}/\r\n\r\nlet functionalityId = -1\r\nlet idMonitoredVariable = -1\r\nlet idMonitoredEvent = -1\r\nconst funcUserId = 1\r\n\r\ninterface MonitoredEventsWithNumber extends MonitoredEvent {\r\n    currentNumber: {\r\n        key: string | undefined\r\n        data: number\r\n    }\r\n}\r\n\r\nconst EditFunctionalityDialog = (props: {func: Functionality, onGood: (newFunc: Functionality) => void, onError: () => void, onCancel: () => void}) => {\r\n\r\n  const [newFuncName, setNewFuncName] : [string,Function] = useState(props.func.funcName)\r\n\r\n  const classes = useDialogStyles()\r\n\r\n  const [sending, setSending] : [boolean, Function] = useState(false)\r\n\r\n  const [result, setResult] : [{done: boolean, good?: boolean, message?: string},Function] = useState({done:false})\r\n\r\n  const [newSamplingTime,setNewSamplingTime] : [string,Function] = useState('')\r\n\r\n  const useStyles = makeStyles((theme) => ({\r\n    formControl: {\r\n      margin: theme.spacing(1),\r\n      minWidth: 120,\r\n    },\r\n    selectEmpty: {\r\n      marginTop: theme.spacing(2),\r\n    },\r\n  }));\r\n  \r\n\r\n  const action = () => {\r\n\r\n      if(props.func.funcId) {\r\n\r\n          if(!result.done) {\r\n\r\n              setSending(true)\r\n  \r\n              updateFunctionality(props.func)\r\n\r\n                  .then((response: RequestResponseState) => {\r\n                      setResult({done:true, good: true, message: response.msg})\r\n                  })\r\n\r\n                  .catch((error: RequestResponseState) => {\r\n                      setResult({done: true, good: false, message: error.msg})\r\n                  })\r\n\r\n                  .finally(() => setSending(false))\r\n\r\n          }\r\n\r\n          else {\r\n\r\n              if(result.good)\r\n                  props.onGood({...props.func, funcName: newFuncName})\r\n              \r\n              else\r\n                  props.onError()\r\n\r\n          }\r\n\r\n      }\r\n\r\n  }\r\n\r\n  return (\r\n        <div>\r\n            <Dialog open={true}  aria-labelledby=\"form-dialog-title\">\r\n            <DialogTitle id=\"form-dialog-title\">Subscribe</DialogTitle>\r\n                <DialogContent>\r\n                    <DialogContentText>\r\n                    To subscribe to this website, please enter your email address here. We will send updates\r\n                    occasionally.\r\n                    </DialogContentText>\r\n                    <TextField \r\n                        disabled={sending}\r\n                        value={newFuncName}\r\n                        onChange={(event) => setNewFuncName(event.target.value)}\r\n                    />   \r\n                    <Grid item xs={4}>\r\n                        <InputLabel id=\"functionality-sampling-time\">Sampling Time</InputLabel>\r\n                            <Select\r\n                            labelId=\"sampling-time-select-label\"\r\n                            id=\"sampling-time-select\"\r\n                            value={age}\r\n                            onChange={handleChange}\r\n                            >\r\n                            <MenuItem value={10}>Ten</MenuItem>\r\n                            <MenuItem value={15}>Fifteen</MenuItem>\r\n                            <MenuItem value={20}>Twenty</MenuItem>\r\n                            <MenuItem value={30}>Thirty</MenuItem>\r\n                            <MenuItem value={40}>Fourty</MenuItem>\r\n                            <MenuItem value={50}>Fifty</MenuItem>\r\n                            <MenuItem value={60}>Sixty</MenuItem>\r\n                            </Select>\r\n                        <InputLabel id={`digital-twin-label-${newSamplingTime}`}>Sampling Time</InputLabel>\r\n                            <Select labelId={`digital-twin-label-${newSamplingTime}`} value={digitalTwinChoice} onChange={handleDigitalTwinChoice}>\r\n                            {(digitalTwins || []).map((digitalTwin: any) => {return <MenuItem key={digitalTwin.dtId} value={digitalTwin.dtName}>{digitalTwin.dtName}</MenuItem>})}\r\n                            </Select>\r\n                    </Grid>\r\n                </DialogContent>\r\n                {/* <DialogActions>\r\n                    <Button onClick={handleClose} color=\"primary\">\r\n                    Cancel\r\n                    </Button>\r\n                    <Button onClick={handleClose} color=\"primary\">\r\n                    Subscribe\r\n                    </Button>\r\n                </DialogActions> */}\r\n            </Dialog>\r\n    </div>\r\n    //   <Dialog open={true}>\r\n    //       <DialogTitle>Edit Functionality</DialogTitle>\r\n    //       <Box className={classes.box}>\r\n    //         {\r\n    //             !result.done \r\n    //             ?\r\n    //                 <TextField \r\n    //                     disabled={sending}\r\n    //                     value={newFuncName}\r\n    //                     onChange={(event) => setNewFuncName(event.target.value)}\r\n    //                 />    \r\n    //             :   \r\n    //                 <Grid container justify=\"center\">\r\n    //                     <Grid item>\r\n    //                     {\r\n    //                         result.good \r\n    //                         ?   <CheckCircle color=\"primary\" />\r\n    //                             :   <Error color=\"error\" />\r\n    //                     }\r\n    //                     </Grid>\r\n    //                         <Grid item>\r\n    //                             <Box className={result.good ? classes.good : classes.error} textAlign=\"center\">{result.message}</Box>\r\n    //                         </Grid>\r\n    //                 </Grid> \r\n    //         }\r\n    //       </Box>\r\n    //       <Grid className={classes.buttons} container direction=\"row\" justify=\"space-between\">\r\n    //           <Grid item>\r\n    //               {sending \r\n    //                   ? <CircularProgress color=\"primary\" />\r\n    //                   : <Button onClick={action}>Ok</Button>\r\n    //               }\r\n    //           </Grid>\r\n    //           <Grid item>\r\n    //               <Button disabled={sending} onClick={props.onCancel}>Cancel</Button>\r\n    //           </Grid>\r\n    //       </Grid>\r\n    //   </Dialog>\r\n  )\r\n\r\n}\r\n\r\nconst AddFunctionalityDetails = (props: {func: Functionality, onGood: (newFunc: Functionality) => void, onError: () => void, onCancel: () => void}) => {\r\n\r\n    const [newFuncName, setNewFuncName] : [string,Function] = useState(props.func.funcName)\r\n  \r\n    const classes = useDialogStyles()\r\n  \r\n    const [sending, setSending] : [boolean, Function] = useState(false)\r\n  \r\n    const [result, setResult] : [{done: boolean, good?: boolean, message?: string},Function] = useState({done:false})\r\n\r\n    const [fetching,setFetching] = useState(true)\r\n    const {data: associatedSmartComponents, dispatchAction: dispatchAssociatedSmartComponentActions} = useStore('associatedSmartComponents')\r\n    const updateAssociatedSmartComponents = (assScs: AssociatedSmartComponent[]) => dispatchAssociatedSmartComponentActions(AssociatedSmartComponentActions.updateAssociatedSmartComponents(assScs))\r\n    const [error,setError] = useState('')\r\n    \r\n    const [availableSmartComponents, setAvailableSmartComponents] : [AssociatedSmartComponent[] , Function] = useState([])\r\n\r\n    // Recuperar da base de dados os Smart Components Associados ao Digital Twin associado\r\n    useMountEffect(() => {\r\n\r\n    setTimeout(() => {\r\n\r\n    setFetching(true)\r\n    getOrDownloadAssociatedSmartComponents(associatedSmartComponents)\r\n        .then((result: AssociatedSmartComponent[]) =>  updateAssociatedSmartComponents(result))\r\n        .catch((e:RequestResponseState) => setError(e.msg))\r\n        .finally(() => setFetching(false))\r\n    }, 0)\r\n    })\r\n\r\n    let i = 0\r\n\r\n    while( i < associatedSmartComponents.length ) {\r\n        if(associatedSmartComponents[i].scDtId === props.func.funcdtId){\r\n            availableSmartComponents[i] = associatedSmartComponents[i]\r\n        }\r\n        i++\r\n    }\r\n\r\n    // Escolher um AssociatedSmartComponent de dentro dos disponíveis pelo DT respectivo \r\n    const [smartComponentChoice, setSmartComponentChoice] = useState('')\r\n    const [smartComponentIdChoice, setSmartComponentIdChoice] = useState(0)\r\n\r\n    const handleSmartComponentChoice = (event: React.ChangeEvent<{ value: unknown }>) => {\r\n    setSmartComponentChoice(event.target.value as string);\r\n    let j = 0;\r\n    while(j < associatedSmartComponents.length)\r\n    {\r\n        if(associatedSmartComponents[j].scName === (event.target.value as string))\r\n        {\r\n            setSmartComponentIdChoice(associatedSmartComponents[j].scId)\r\n        }\r\n        j++;\r\n    }\r\n    };\r\n\r\n    //Variáveis e funções de apoio à escolha do Function Block\r\n    const [validFunctionBlock, setValidFunctionBlock] : [boolean,Function] = useState(true)\r\n    const [newFb,setNewFb] : [string,Function] = useState('')\r\n    const isFunctionBlockValid = (fb:string) => NEW_FUNCTIONALITY_RE.test(fb)\r\n\r\n    //Variáveis e funções de apoio à escolha da Variable\r\n    const [validVariable, setValidVariable] : [boolean,Function] = useState(true)\r\n    const [newVariable,setNewVariable] : [string,Function] = useState('')\r\n    const isVariableValid = (variable:string) => VARIABLE_RE.test(variable)\r\n\r\n    const buildMonitoredVariable = (funcId: number | undefined) : MonitoredVariable => ({  \r\n        monitoredVariableName: newVariable, fbAssociated: newFb, \r\n        funcIdAssociated: funcId , idMonitoredVariable: idMonitoredVariable,\r\n        scAssociated: smartComponentChoice\r\n    })\r\n\r\n    //Variáveis e funções de apoio à escolha do Event\r\n    const [validEvent, setValidEvent] : [boolean,Function] = useState(true)\r\n    const [newEvent,setNewEvent] : [string,Function] = useState('')\r\n    const isEventValid = (event:string) => EVENT_RE.test(event)\r\n  \r\n    const buildMonitoredEvent = (funcId: number | undefined) : MonitoredEvent => ({  \r\n        monitoredEventName: newEvent, fbAssociated: newFb, \r\n        funcIdAssociated: funcId , idMonitoredEvent: idMonitoredEvent,\r\n        scAssociated: smartComponentChoice\r\n    })\r\n\r\n    //Função de atualização da database com os dados escolhidos \r\n    const action = () => {    \r\n        \r\n        let funcId = props.func.funcId\r\n        const monitoredVariable: MonitoredVariable = buildMonitoredVariable(funcId)\r\n        const monitoredEvent: MonitoredEvent = buildMonitoredEvent(funcId)\r\n\r\n        console.log(monitoredVariable)\r\n        if(props.func.funcId) {\r\n            \r\n            if(!result.done) {\r\n                \r\n                setSending(true)\r\n\r\n                updateFunctionality(props.func)\r\n  \r\n                    .then((response: RequestResponseState) => {\r\n                        setResult({done:true, good: true, message: response.msg})\r\n                    })\r\n                    .catch((error: RequestResponseState) => {\r\n                        setResult({done: true, good: false, message: error.msg})\r\n                    })\r\n  \r\n                if(newVariable!=''){\r\n\r\n                    createMonitoredVariable(monitoredVariable)\r\n                        .then((response: RequestResponseState) => {\r\n                            setResult({done:true, good: true, message: response.msg})\r\n                        })\r\n                        .catch((error: RequestResponseState) => {\r\n                            setResult({done: true, good: false, message: error.msg})\r\n                        })\r\n                }\r\n                \r\n\r\n                if(newEvent!=''){\r\n\r\n                    createMonitoredEvent(monitoredEvent)\r\n                        .then((response: RequestResponseState) => {\r\n                            setResult({done:true, good: true, message: response.msg})\r\n                        })\r\n                        .catch((error: RequestResponseState) => {\r\n                            setResult({done: true, good: false, message: error.msg})\r\n                        })\r\n                }\r\n\r\n\r\n            }\r\n  \r\n            else {\r\n  \r\n                if(result.good){\r\n                    props.onGood({...props.func, funcName: newFuncName})\r\n                    \r\n                }\r\n                else\r\n                    props.onError()\r\n            }\r\n        }\r\n        props.onCancel()\r\n        document.location.reload(true)\r\n    }\r\n\r\n    return (\r\n        <Dialog open={true}>\r\n            <DialogTitle>Add Functionality Details</DialogTitle>\r\n            <Box className={classes.box}>\r\n            <Grid item> \r\n\r\n                <Grid container item xs>\r\n                    <Grid className={classes.box} spacing={3} item container direction=\"column\" alignItems=\"flex-start\">\r\n                        <Grid item xs={12} sm={6}>\r\n                            <InputLabel id={`smart-component-label-${availableSmartComponents}`}>DINASORE</InputLabel>\r\n                            <Select labelId={`smart-component-label-${availableSmartComponents}`} value={smartComponentChoice} onChange={handleSmartComponentChoice}>\r\n                            {(availableSmartComponents || []).map((sc: any) => {return <MenuItem key={sc.scId} value={sc.scName}>{sc.scName}</MenuItem>})}\r\n                            </Select> \r\n                        </Grid>\r\n                        <Grid item xs={12} sm={6}>\r\n                            <TextField\r\n                                label= \"Function Block\"\r\n                                helperText={!validFunctionBlock ? FUNCTION_BLOCK_RE.toString() : ''}\r\n                                error={!validFunctionBlock}\r\n                                required\r\n                                onChange={(event) => {\r\n                                    setNewFb(event.target.value)\r\n                                    if(!validFunctionBlock)\r\n                                        setValidFunctionBlock(isFunctionBlockValid(event.target.value.trim()))\r\n                                    }}\r\n                                fullWidth\r\n                                value={newFb}\r\n                            />\r\n                        </Grid>\r\n                        <Grid item xs={12} sm={6}>\r\n                            <TextField\r\n                                label= \"Variable\"\r\n                                helperText={!validVariable ? VARIABLE_RE.toString() : ''}\r\n                                error={!validVariable}\r\n                                required\r\n                                onChange={(event) => {\r\n                                    setNewVariable(event.target.value)\r\n                                    if(!validVariable)\r\n                                        setValidVariable(isVariableValid(event.target.value.trim()))\r\n                                    }}\r\n                                fullWidth\r\n                                value={newVariable}\r\n                            />\r\n                        </Grid>\r\n                        <Grid item xs={12} sm={6}>\r\n                            <TextField\r\n                                label= \"Event\"\r\n                                helperText={!validEvent ? EVENT_RE.toString() : ''}\r\n                                error={!validEvent}\r\n                                required\r\n                                onChange={(event) => {\r\n                                    setNewEvent(event.target.value)\r\n                                    if(!validEvent)\r\n                                        setValidEvent(isEventValid(event.target.value.trim()))\r\n                                    }}\r\n                                fullWidth\r\n                                value={newEvent}\r\n                            />\r\n                        </Grid>\r\n                    </Grid>\r\n                </Grid>\r\n            </Grid>\r\n            <Grid className={classes.buttons} container direction=\"row\" justify=\"space-between\">\r\n                <Grid item>\r\n                    {sending \r\n                        ? <CircularProgress color=\"primary\" />\r\n                        : <Button onClick={action}>Ok</Button>\r\n                    }\r\n                </Grid>\r\n                <Grid item>\r\n                    <Button disabled={sending} onClick={props.onCancel}>Cancel</Button>\r\n                </Grid>\r\n            </Grid>\r\n         </Box>\r\n        </Dialog>\r\n    )\r\n  \r\n}\r\n\r\nexport const DigitalTwinMonitoring = () => {\r\n    \r\n  const classes = useFunctionBlockStyles()\r\n\r\n  const [fetching,setFetching] = useState(true)\r\n  const [error,setError] = useState('')\r\n  const [newFunc,setNewFunc] : [string,Function] = useState('')\r\n\r\n  const [confirmEditing,setConfirmEditing] : [boolean, Function] = useState(false)\r\n  const [confirmAddFunc,setConfirmAddFunc] : [boolean, Function] = useState(false)\r\n\r\n  const [validNewFunc, setValidNewFunc] : [boolean,Function] = useState(true)\r\n\r\n  const errorFetchingFunctionalityState : ConfirmActionState = {\r\n    label: error,\r\n    state: ConfirmActionStateLabel.error,\r\n    positiveLabel: 'Ok'\r\n  }\r\n\r\n  const [redirectTo, setRedirectTo] : [number, Function] = useState(-1)\r\n\r\n  const {data:functionalities, dispatchAction:dispatchFunctionalityActions} = useStore('functionalities')\r\n  const {data:digitalTwins, dispatchAction:dispatchDigitalTwinActions} = useStore('digitalTwins')\r\n  const {data:monitoredVariables, dispatchAction:dispatchMonitoredVariableActions} = useStore('monitoredVariables')\r\n  const {data:monitoredEvents, dispatchAction:dispatchMonitoredEventActions} = useStore('monitoredEvents')\r\n\r\n  const onCancel = () => setError('')\r\n\r\n  const updateFunctionalities = (funcs: Functionality[]) => dispatchFunctionalityActions(FunctionalityActions.updateFunctionalities(funcs))\r\n  const updateDigitalTwins = (dts: DigitalTwin[]) => dispatchDigitalTwinActions(DigitalTwinActions.updateDigitalTwins(dts))\r\n  const updateMonitoredVariables = (monVars: MonitoredVariable[]) => dispatchMonitoredVariableActions(MonitoredVariableActions.updateMonitoredVariable(monVars))\r\n  const updateMonitoredEvents = (monEvs: MonitoredEvent[]) => dispatchMonitoredEventActions(MonitoredEventActions.updateMonitoredEvent(monEvs))  \r\n  \r\n  const addFunc = () => dispatchFunctionalityActions(FunctionalityActions.addFunctionality({funcId: functionalityId, funcUserId: 1 , funcName: newFunc, funcdtId: 1}))\r\n \r\n  const [editingFunc, setEditingFunc] : [Functionality | null,Function] = useState(null)\r\n  const [addDetailsFunc, setAddDetailsFunc] : [Functionality | null,Function] = useState(null)\r\n\r\n  const indexes = [\r\n    {label: 'Functionality', key: 'funcName'},\r\n    {label: 'Digital Twin', key: 'dtName'},\r\n  ]\r\n\r\n  // Recuperar da base de dados as funcionalidades (Functionality)\r\n  useMountEffect(() => {\r\n\r\n    setTimeout(() => {\r\n\r\n    setFetching(true)\r\n    getOrDownloadFunctionalities(functionalities)\r\n        .then((result: Functionality[]) => updateFunctionalities(result))\r\n        .catch((e:RequestResponseState) => setError(e.msg))\r\n        .finally(() => setFetching(false))\r\n    }, 0)\r\n  })\r\n\r\n  // Recuperar da base de dados os digital twins (DigitalTwin)\r\n  useMountEffect(() => {\r\n\r\n    setTimeout(() => {\r\n\r\n    setFetching(true)\r\n    getOrDownloadDigitalTwins(digitalTwins)\r\n        .then((result: DigitalTwin[]) => updateDigitalTwins(result))\r\n        .catch((e:RequestResponseState) => setError(e.msg))\r\n        .finally(() => setFetching(false))\r\n    }, 0)\r\n  })\r\n\r\n  const isFunctionalityValid = (func:string) => NEW_FUNCTIONALITY_RE.test(func)\r\n\r\n  const validateAndCreate = () => {\r\n\r\n  const validFunc = isFunctionalityValid(newFunc)\r\n\r\n    if(!validFunc)\r\n      setValidNewFunc(false)\r\n    else{\r\n        setConfirmAddFunc(true)\r\n    }\r\n     \r\n    \r\n  }\r\n\r\n  const buildFunctionality = () : Functionality => ({\r\n    funcName: newFunc, funcId: functionalityId,\r\n    funcdtId: digitalTwinIdChoice , funcUserId, funcdtName: digitalTwinChoice,\r\n  })\r\n\r\n  const addNewFunctionalityAction = () : Promise<string> => {\r\n\r\n    const functionality : Functionality = buildFunctionality()\r\n\r\n    return new Promise<string>((res:Function, rej:Function)  => {\r\n\r\n        createFunctionality(functionality)\r\n\r\n            .then((result: RequestResponseState) => {\r\n            functionalityId = result.extra.lastInsertedId\r\n                res('Functionality created')\r\n            })\r\n\r\n            .catch((e:RequestResponseState) => rej(e.msg))\r\n\r\n    })\r\n  }\r\n\r\n  const confirmFunctionalityCreationActionStates = {\r\n    start: {\r\n      label: `Confirm creation of new functionality: ${newFunc} ?`,\r\n      positiveLabel: 'Ok',\r\n      negativeLabel: 'Cancel',\r\n      state: ConfirmActionStateLabel.start\r\n    },\r\n    executing: {\r\n      label: '',\r\n      state: ConfirmActionStateLabel.executing,\r\n    },\r\n    success: {\r\n      label: 'Functionality Created',\r\n      state: ConfirmActionStateLabel.success,\r\n      positiveLabel: 'Ok'\r\n    },\r\n    error: {\r\n      label: 'Error Creating Functionality',\r\n      state: ConfirmActionStateLabel.error,\r\n      positiveLabel: 'Ok'\r\n    },\r\n  }\r\n\r\n  const confirmActionProps : ConfirmActionProps = {\r\n\r\n    title: 'Add Functionality',\r\n    states: confirmFunctionalityCreationActionStates,\r\n    currentState: confirmFunctionalityCreationActionStates.start,\r\n    onCancel: () => setConfirmAddFunc(false),\r\n    onError: () => setConfirmAddFunc(false),\r\n    onSuccess: () => {\r\n        addFunc()\r\n        setNewFunc('')\r\n        document.location.reload(true)\r\n    },\r\n    action: addNewFunctionalityAction,\r\n  }\r\n\r\n  const getDataFunctionality = () => functionalities.map((functionality: Functionality) => {\r\n\r\n    return {\r\n          ...functionality,\r\n    }\r\n  })\r\n\r\n   // Recuperar da base de dados os monitoredEvents (MonitoredEvent)\r\n   useMountEffect(() => {\r\n\r\n    setTimeout(() => {\r\n    \r\n    setFetching(true)\r\n    getOrDownloadMonitoredEvents(monitoredEvents)\r\n        .then((result: MonitoredEvent[]) => updateMonitoredEvents(result))\r\n        .catch((e:RequestResponseState) => setError(e.msg))\r\n        .finally(() => setFetching(false))\r\n    }, 0)\r\n\r\n    })\r\n\r\n    // Recuperar da base de dados as monitoredVariables (MonitoredVariable)\r\n      useMountEffect(() => {\r\n\r\n        setTimeout(() => {\r\n\r\n        setFetching(true)\r\n        getOrDownloadMonitoredVariables(monitoredVariables)\r\n            .then((result: MonitoredVariable[]) => updateMonitoredVariables(result))\r\n            .catch((e:RequestResponseState) => setError(e.msg))\r\n            .finally(() => setFetching(false))\r\n        }, 0)\r\n    })\r\n\r\n  const deleteFunctionalityAction = (func: Functionality) : Promise<any> => {\r\n\r\n    return new Promise(async(res:Function,rej:Function) => {\r\n\r\n        //let monitoredVariablesToDelete = []\r\n        let monitoredEventsToDelete = []\r\n        let i = 0\r\n        \r\n        // while(i < monitoredVariables.length) {\r\n        //     if(monitoredVariables[i].funcIdAssociated === func.funcId){\r\n        //         monitoredVariablesToDelete.push(monitoredVariables[i])\r\n        //     } \r\n        //     i++\r\n        // }   \r\n\r\n        i=0\r\n\r\n        while(i < monitoredEvents.length) {\r\n            if(monitoredEvents[i].funcIdAssociated === func.funcId){\r\n                monitoredEventsToDelete.push(monitoredEvents[i])\r\n            } \r\n            i++\r\n        }  \r\n\r\n        //console.log(monitoredVariablesToDelete)\r\n        console.log(monitoredEventsToDelete)\r\n\r\n        if(!func.funcId) {\r\n            rej('Error')\r\n            return\r\n        }\r\n\r\n        try {\r\n\r\n            const response : RequestResponseState = await deleteFunctionality(func.funcId)\r\n            \r\n            // i=0\r\n            // while(i < monitoredVariablesToDelete.length){\r\n            //     console.log(\"entrei aqui\")\r\n            //     const response1 : RequestResponseState = await deleteMonitoredVariable(monitoredVariablesToDelete[i].idMonitoredVariable)\r\n            //     res(response1)\r\n            //     i++\r\n            // }\r\n\r\n            i=0 \r\n            while(i < monitoredEventsToDelete.length){\r\n                const response1 : RequestResponseState = await deleteMonitoredEvent(monitoredEventsToDelete[i].idMonitoredEvent)\r\n                i++\r\n            }\r\n\r\n            res(response)\r\n          }\r\n\r\n        catch(err) {\r\n            rej(err)\r\n        }\r\n    })\r\n  }\r\n\r\n  //Adicionar Detalhes à Funcionalidade\r\n  const cancelAddDetails = () => setAddDetailsFunc(null);\r\n  const showAddDetails = (func: Functionality) => setAddDetailsFunc(func)\r\n  \r\n  //Editar a Funcionalidade\r\n  const cancelEditing = () => setEditingFunc(null)\r\n  const showEditing = (func: Functionality) => setEditingFunc(func)\r\n\r\n  const onGoodEditing = (editingFunctionality: Functionality) => {\r\n      \r\n    const newFunctionalities = functionalities.map((func: Functionality) => {\r\n\r\n    if(func.funcId === editingFunctionality.funcId)\r\n        return {...func, funcName: editingFunctionality.funcName, funcdtId: editingFunctionality.funcdtId}\r\n    return func\r\n\r\n    })\r\n  \r\n    cancelEditing()\r\n    dispatchFunctionalityActions(FunctionalityActions.updateFunctionalities(newFunctionalities))\r\n  }\r\n\r\n  // Associar um digital twin à nova funcionalidade criada\r\n  const [digitalTwinChoice, setDigitalTwinChoice] = useState('')\r\n  const [digitalTwinIdChoice, setDigitalTwinIdChoice] = useState(0)\r\n\r\n  const handleDigitalTwinChoice = (event: React.ChangeEvent<{ value: unknown }>) => {\r\n    setDigitalTwinChoice(event.target.value as string);\r\n    let i = 0;\r\n    while(i < digitalTwins.length)\r\n    {\r\n        if(digitalTwins[i].dtName === (event.target.value as string))\r\n        {\r\n            setDigitalTwinIdChoice(digitalTwins[i].dtId)\r\n        }\r\n        i++;\r\n    }\r\n   \r\n  };\r\n  \r\n  const redirectToList = (func : Functionality) => {\r\n      setRedirectTo(func.funcId)\r\n  }\r\n  const indexes_test = [\r\n    {label: 'delete', key: 'delete'},\r\n  ]\r\n  \r\n  if(redirectTo !== -1) \r\n  return  <Redirect to={`/functionality-details/${redirectTo}`} push={true}/>\r\n  \r\n  return (\r\n    <Navigator title=\"Digital Twin Monitoring\">\r\n    <> \r\n        {error !== ''\r\n                ? <ConfirmAction title='Fetching Functionalities' currentState={errorFetchingFunctionalityState} states={{error: errorFetchingFunctionalityState}} onCancel={onCancel}/>\r\n                : null \r\n        }\r\n        <LazyComponent loaded={!fetching}>\r\n        <>\r\n            {confirmEditing\r\n                ? <ConfirmAction {...confirmActionProps} /> \r\n                : editingFunc\r\n                ? <EditFunctionalityDialog\r\n                    onGood={onGoodEditing}\r\n                    func={editingFunc}\r\n                    onError={cancelEditing}\r\n                    onCancel={cancelEditing} />\r\n                    : null\r\n            }\r\n            {confirmAddFunc \r\n                ? <ConfirmAction {...confirmActionProps} /> \r\n                : addDetailsFunc\r\n                ?  <AddFunctionalityDetails\r\n                    onGood={onGoodEditing}\r\n                    func={addDetailsFunc}\r\n                    onError={cancelAddDetails}\r\n                    onCancel={cancelAddDetails} />\r\n                    : null\r\n            }\r\n            <Grid container direction=\"column\" spacing={2}>\r\n                <Grid item>\r\n                    <JPTable\r\n                            sortedkey=\"funcName\"\r\n                            data={getDataFunctionality()} \r\n                            updateData={updateFunctionalities} \r\n                            indexes={indexes} \r\n                            tName='Functionality'\r\n                            extra={{\r\n                                delete: {\r\n                                    action: deleteFunctionalityAction,\r\n                                    labelKey: 'funcName',\r\n                                    onSuccessDelete: () => {}\r\n                                },\r\n                                edit: {\r\n                                    action: showEditing\r\n                                },\r\n                                details: {\r\n                                    action: redirectToList\r\n                                },\r\n                                add: {\r\n                                    action: showAddDetails\r\n                                }\r\n                            }} \r\n                    />\r\n                </Grid>\r\n                <Grid item xs>\r\n                    New Functionality\r\n                </Grid>\r\n                <Grid item> \r\n                    <Grid container item xs>\r\n                        <Grid className={classes.box} spacing={1} item container direction=\"row\">\r\n                            <Grid item xs={4}>\r\n                                <TextField\r\n                                    helperText={!validNewFunc ? NEW_FUNCTIONALITY_RE.toString() : ''}\r\n                                    error={!validNewFunc}\r\n                                    label=\"Insert new functionality name\" \r\n                                    required\r\n                                    onChange={(event) => {\r\n                                        setNewFunc(event.target.value)\r\n                                        if(!validNewFunc)\r\n                                            setValidNewFunc(isFunctionalityValid(event.target.value.trim()))\r\n                                    }}\r\n                                    fullWidth\r\n                                    value={newFunc}\r\n                                />\r\n                            </Grid>\r\n                            <Grid item xs={4}>\r\n                                <InputLabel id={`digital-twin-label-${newFunc}`}>Digital Twin</InputLabel>\r\n                                <Select labelId={`digital-twin-label-${newFunc}`} value={digitalTwinChoice} onChange={handleDigitalTwinChoice}>\r\n                                {(digitalTwins || []).map((digitalTwin: any) => {return <MenuItem key={digitalTwin.dtId} value={digitalTwin.dtName}>{digitalTwin.dtName}</MenuItem>})}\r\n                                </Select>\r\n                            </Grid>\r\n                            <Grid container justify=\"flex-end\" spacing={1}>\r\n                                <Grid item>\r\n                                    <Button\r\n                                    color=\"primary\"\r\n                                    variant=\"contained\"\r\n                                    onClick={validateAndCreate}\r\n                                    >\r\n                                    Add Functionality\r\n                                    </Button>\r\n                                </Grid>\r\n                            </Grid>\r\n                        </Grid>\r\n                    </Grid>\r\n                </Grid>\r\n            </Grid>\r\n        </>\r\n        </LazyComponent>\r\n    </>\r\n    </Navigator>\r\n )\r\n}\r\n"]},"metadata":{},"sourceType":"module"}